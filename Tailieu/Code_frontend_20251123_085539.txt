
================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\.env
================================================================================
REACT_APP_API_BASE_URL=http://127.0.0.1:8000/api/v1

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\package.json
================================================================================
{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@testing-library/jest-dom": "^5.17.0",
    "@testing-library/react": "^13.4.0",
    "@testing-library/user-event": "^13.5.0",
    "axios": "^1.7.2",
    "framer-motion": "^12.23.24",
    "jspdf": "^3.0.4",
    "jwt-decode": "^4.0.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.24.1",
    "react-scripts": "5.0.1",
    "react-toastify": "^11.0.5",
    "recharts": "^2.12.7",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}


================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\public\index.html
================================================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div> </body>
</html>

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\App.js
================================================================================
// frontend/src/App.js
import React from 'react';
import { Routes, Route } from 'react-router-dom';
import { ToastContainer } from 'react-toastify';
import 'react-toastify/dist/ReactToastify.css';

import ProtectedRoute from './components/ProtectedRoute';
import Layout from './components/Layout';
import Login from './pages/Login';
import Dashboard from './pages/Dashboard';
import EmployeeList from './pages/EmployeeList';
import EmployeeDetail from './pages/EmployeeDetail';
import AdminManagement from './pages/AdminManagement'; // Quản lý tổ chức
import PayrollManagement from './pages/PayrollManagement';
import Reports from './pages/Reports';
import UserManagement from './pages/UserManagement';

// --- IMPORT MỚI ---
import ShareholderManagement from './pages/ShareholderManagement';
import SystemAdmin from './pages/SystemAdmin';
import LeaveApproval from './pages/LeaveApproval';
import MyAttendance from './pages/MyAttendance';
import MyPayslips from './pages/MyPayslips';

const ROLES = {
    ADMIN: 'Admin',
    HR: 'HR Manager',
    PAYROLL: 'Payroll Manager',
    EMPLOYEE: 'Employee'
};

function App() {
    return (
        <>
            <ToastContainer theme="colored" />
            <Routes>
                <Route path="/login" element={<Login />} />
                <Route path="/" element={<ProtectedRoute><Layout /></ProtectedRoute>}>
                    <Route index element={<Dashboard />} />
                    
                    {/* Các route cũ */}
                    <Route path="employees" element={<ProtectedRoute allowedRoles={[ROLES.ADMIN, ROLES.HR]}><EmployeeList /></ProtectedRoute>} />
                    <Route path="employees/:id" element={<ProtectedRoute><EmployeeDetail /></ProtectedRoute>} />
                    <Route path="management" element={<ProtectedRoute allowedRoles={[ROLES.ADMIN, ROLES.HR]}><AdminManagement /></ProtectedRoute>} />
                    <Route path="payroll" element={<ProtectedRoute allowedRoles={[ROLES.ADMIN, ROLES.PAYROLL]}><PayrollManagement /></ProtectedRoute>} />
                    <Route path="reports" element={<ProtectedRoute allowedRoles={[ROLES.HR, ROLES.PAYROLL]}><Reports /></ProtectedRoute>} />
                    <Route path="user-management" element={<ProtectedRoute allowedRoles={[ROLES.ADMIN]}><UserManagement /></ProtectedRoute>} />

                    {/* --- ROUTE MỚI --- */}
                    <Route path="shareholders" element={<ProtectedRoute allowedRoles={[ROLES.ADMIN, ROLES.HR, ROLES.PAYROLL]}><ShareholderManagement /></ProtectedRoute>} />
                    <Route path="system-admin" element={<ProtectedRoute allowedRoles={[ROLES.ADMIN]}><SystemAdmin /></ProtectedRoute>} />
                    <Route path="leave-approval" element={<ProtectedRoute allowedRoles={[ROLES.HR]}><LeaveApproval /></ProtectedRoute>} />
                    
                    {/* Employee Portal */}
                    <Route path="my-attendance" element={<ProtectedRoute allowedRoles={[ROLES.EMPLOYEE]}><MyAttendance /></ProtectedRoute>} />
                    <Route path="my-payslips" element={<ProtectedRoute allowedRoles={[ROLES.EMPLOYEE]}><MyPayslips /></ProtectedRoute>} />
                </Route>
                <Route path="*" element={<h2>404 Not Found</h2>} />
            </Routes>
        </>
    );
}

export default App;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\index.js
================================================================================
import React from 'react';
import ReactDOM from 'react-dom/client'; // Đảm bảo đã sửa import này
import App from './App';
import { BrowserRouter } from 'react-router-dom';
import { AuthProvider } from './context/AuthContext';

const rootElement = document.getElementById('root'); // <-- Lấy phần tử
const root = ReactDOM.createRoot(rootElement); // <-- Sử dụng phần tử đó

root.render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <App />
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>
);

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\AddEmployeeModal.js
================================================================================
// frontend/src/components/AddEmployeeModal.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { motion } from 'framer-motion'; // <-- Thêm import

const AddEmployeeModal = ({ isOpen, onClose, onSuccess }) => {
  const [formData, setFormData] = useState({
    FullName: '',
    Email: '',
    DateOfBirth: '',
    HireDate: '',
    DepartmentID: '',
    PositionID: '',
    Status: 'Đang làm việc',
    Gender: '',
    PhoneNumber: '',
    password: '',
  });
  const [departments, setDepartments] = useState([]);
  const [positions, setPositions] = useState([]);
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const fetchData = async () => {
      if (isOpen) {
        setLoading(true);
        setError('');
        try {
          const [deptRes, posRes] = await Promise.all([
            api.get('/departments/'),
            api.get('/positions/')
          ]);
          setDepartments(deptRes.data);
          setPositions(posRes.data);
          if (deptRes.data.length > 0) {
            setFormData(prev => ({ ...prev, DepartmentID: deptRes.data[0].DepartmentID }));
          }
          if (posRes.data.length > 0) {
            setFormData(prev => ({ ...prev, PositionID: posRes.data[0].PositionID }));
          }
        } catch (err) {
          console.error('Failed to fetch departments/positions', err);
          setError('Không thể tải danh sách phòng ban/chức vụ.');
        } finally {
          setLoading(false);
        }
      }
    };
    fetchData();
  }, [isOpen]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prevData) => ({
      ...prevData,
      [name]: value,
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);
    if (!formData.FullName || !formData.Email || !formData.DateOfBirth || !formData.HireDate || !formData.DepartmentID || !formData.PositionID || !formData.password) {
      setError('Vui lòng điền đầy đủ các trường bắt buộc.');
      setLoading(false);
      return;
    }

    try {
      await api.post('/employees/', formData);
      onSuccess();
      setFormData({
        FullName: '', Email: '', DateOfBirth: '', HireDate: '',
        DepartmentID: departments.length > 0 ? departments[0].DepartmentID : '',
        PositionID: positions.length > 0 ? positions[0].PositionID : '',
        Status: 'Đang làm việc', Gender: '', PhoneNumber: '', password: ''
      });
    } catch (err) {
      console.error('Failed to add employee', err);
      setError(err.response?.data?.detail || 'Thêm nhân viên thất bại. Vui lòng thử lại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) {
    return null;
  }

  return (
    // --- BỌC HIỆU ỨNG FADE CHO OVERLAY ---
    <motion.div
      style={styles.overlay}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      onClick={onClose} // Cho phép đóng khi click bên ngoài
    >
      {/* --- BỌC HIỆU ỨNG FADE + SCALE CHO MODAL --- */}
      <motion.div
        style={styles.modal}
        initial={{ opacity: 0, scale: 0.9, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: -20 }}
        transition={{ duration: 0.2 }}
        onClick={(e) => e.stopPropagation()} // Ngăn click bên trong modal
      >
        <h2 style={styles.header}>Thêm Nhân viên mới</h2>
        {error && <p style={styles.errorText}>{error}</p>}
        
        <form onSubmit={handleSubmit}>
          {/* --- SỬA LẠI GRID ĐỂ ĐẸP HƠN --- */}
          <div style={styles.formGrid}>
            <div style={styles.formGroup}>
              <label style={styles.label}>Họ tên (*):</label>
              <input type="text" name="FullName" value={formData.FullName} onChange={handleChange} required style={styles.input} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Email (*):</label>
              <input type="email" name="Email" value={formData.Email} onChange={handleChange} required style={styles.input} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Ngày sinh (*):</label>
              <input type="date" name="DateOfBirth" value={formData.DateOfBirth} onChange={handleChange} required style={styles.input} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Ngày vào làm (*):</label>
              <input type="date" name="HireDate" value={formData.HireDate} onChange={handleChange} required style={styles.input} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Giới tính:</label>
              <select name="Gender" value={formData.Gender} onChange={handleChange} style={styles.input}>
                <option value="">Chọn giới tính</option>
                <option value="Male">Nam</option>
                <option value="Female">Nữ</option>
                <option value="Other">Khác</option>
              </select>
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>SĐT:</label>
              <input type="tel" name="PhoneNumber" value={formData.PhoneNumber} onChange={handleChange} style={styles.input} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Phòng ban (*):</label>
              <select name="DepartmentID" value={formData.DepartmentID} onChange={handleChange} required disabled={loading} style={styles.input}>
                {departments.length === 0 && !loading && <option value="">Không có phòng ban</option>}
                {departments.map(dept => (
                  <option key={dept.DepartmentID} value={dept.DepartmentID}>{dept.DepartmentName}</option>
                ))}
              </select>
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Chức vụ (*):</label>
              <select name="PositionID" value={formData.PositionID} onChange={handleChange} required disabled={loading} style={styles.input}>
                {positions.length === 0 && !loading && <option value="">Không có chức vụ</option>}
                {positions.map(pos => (
                  <option key={pos.PositionID} value={pos.PositionID}>{pos.PositionName}</option>
                ))}
              </select>
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Trạng thái (*):</label>
              <select name="Status" value={formData.Status} onChange={handleChange} required style={styles.input}>
                <option value="Đang làm việc">Đang làm việc</option>
                <option value="Nghỉ phép">Nghỉ phép</option>
                <option value="Thử việc">Thử việc</option>
                <option value="Thực tập">Thực tập</option>
              </select>
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Mật khẩu (*):</label>
              <input type="password" name="password" value={formData.password} onChange={handleChange} required style={styles.input} />
              <small> (Tài khoản sẽ dùng mật khẩu này để đăng nhập)</small>
            </div>
          </div>

          <div style={styles.buttonGroup}>
            <button type="button" onClick={onClose} disabled={loading} style={{...styles.button, ...styles.cancelButton}}>
              Hủy
            </button>
            <button type="submit" disabled={loading} style={{...styles.button, ...styles.submitButton}}>
              {loading ? 'Đang thêm...' : 'Thêm'}
            </button>
          </div>
        </form>
      </motion.div>
    </motion.div>
  );
};

// --- CẬP NHẬT CSS STYLES ---
const styles = {
  overlay: {
    position: 'fixed',
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.5)',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    zIndex: 1000,
  },
  modal: {
    backgroundColor: '#fff',
    padding: '20px 25px',
    borderRadius: '8px',
    width: '100%',
    maxWidth: '700px', // Tăng chiều rộng cho form 2 cột
    maxHeight: '90vh',
    overflowY: 'auto',
    boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
  },
  header: {
    marginTop: 0,
    marginBottom: '20px',
    borderBottom: '1px solid #eee',
    paddingBottom: '10px',
  },
  formGrid: {
    display: 'grid',
    gridTemplateColumns: '1fr 1fr', // Chia 2 cột
    gap: '15px 20px', // Khoảng cách giữa các ô
  },
  formGroup: {
    marginBottom: '5px',
    display: 'flex',
    flexDirection: 'column',
  },
  label: {
    fontWeight: 'bold',
    marginBottom: '5px',
    fontSize: '0.9em',
  },
  input: {
    width: '100%',
    padding: '8px 10px',
    border: '1px solid #ccc',
    borderRadius: '4px',
    boxSizing: 'border-box', // Đảm bảo padding không làm vỡ layout
  },
  errorText: {
    color: '#D8000C',
    backgroundColor: '#FFD2D2',
    padding: '10px',
    borderRadius: '4px',
    marginBottom: '15px',
  },
  buttonGroup: {
    marginTop: '20px',
    textAlign: 'right',
    borderTop: '1px solid #eee',
    paddingTop: '15px',
  },
  button: {
    padding: '8px 15px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontWeight: 'bold',
    marginLeft: '10px',
  },
  submitButton: {
    backgroundColor: '#28a745', // Green
    color: 'white',
  },
  cancelButton: {
    backgroundColor: '#f0f0f0',
    color: '#333',
    border: '1px solid #ccc',
  }
};

export default AddEmployeeModal;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\DepartmentModal.js
================================================================================
// frontend/src/components/DepartmentModal.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { motion } from 'framer-motion';

const DepartmentModal = ({ isOpen, onClose, onSuccess, departmentData }) => {
  const [name, setName] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const isEditMode = !!departmentData;

  useEffect(() => {
    if (isEditMode) setName(departmentData.DepartmentName || '');
    else setName('');
    setError('');
  }, [isOpen, departmentData, isEditMode]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!name.trim()) {
      setError('Tên phòng ban không được để trống.');
      return;
    }
    setLoading(true);
    setError('');
    try {
      if (isEditMode) {
        await api.put(`/departments/${departmentData.DepartmentID}`, { DepartmentName: name });
      } else {
        await api.post('/departments/', { DepartmentName: name });
      }
      onSuccess();
    } catch (err) {
      setError(err.response?.data?.detail || 'Lưu thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <motion.div
      style={styles.overlay}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      onClick={onClose}
    >
      <motion.div
        style={styles.modal}
        initial={{ opacity: 0, scale: 0.9, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: -20 }}
        transition={{ duration: 0.2 }}
        onClick={(e) => e.stopPropagation()}
      >
        <h2 style={styles.header}>{isEditMode ? 'Sửa Phòng ban' : 'Thêm Phòng ban mới'}</h2>
        {isEditMode && <p style={styles.subHeader}>ID: {departmentData.DepartmentID}</p>}
        {error && <p style={styles.errorText}>{error}</p>}
        
        <form onSubmit={handleSubmit}>
          <div style={styles.formGroup}>
            <label style={styles.label}>Tên Phòng ban:</label>
            <input 
              type="text" 
              value={name} 
              onChange={(e) => setName(e.target.value)} 
              disabled={loading} 
              style={styles.input} 
              required 
            />
          </div>
          <div style={styles.buttonGroup}>
            <button type="button" onClick={onClose} disabled={loading} style={{...styles.button, ...styles.cancelButton}}>
              Hủy
            </button>
            <button type="submit" disabled={loading} style={{...styles.button, ...styles.submitButton}}>
              {loading ? 'Đang lưu...' : (isEditMode ? 'Lưu thay đổi' : 'Thêm mới')}
            </button>
          </div>
        </form>
      </motion.div>
    </motion.div>
  );
};

// --- STYLES ---
const styles = {
    overlay: {
        position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
        backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
        justifyContent: 'center', alignItems: 'center', zIndex: 1000,
    },
    modal: {
        backgroundColor: '#fff', padding: '20px 25px', borderRadius: '8px',
        width: '100%', maxWidth: '450px',
        boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
    },
    header: {
        marginTop: 0,
        marginBottom: '10px', // <-- SỬA Ở ĐÂY
    },
    subHeader: {
        fontSize: '0.9em',
        color: '#666',
        marginTop: '-5px', // <-- SỬA Ở ĐÂY
        marginBottom: '20px',
    },
    formGroup: {
        marginBottom: '15px',
        display: 'flex',
        flexDirection: 'column',
    },
    label: {
        fontWeight: 'bold',
        marginBottom: '5px',
        fontSize: '0.9em',
    },
    input: {
        width: '100%',
        padding: '8px 10px',
        border: '1px solid #ccc',
        borderRadius: '4px',
        boxSizing: 'border-box',
    },
    errorText: {
        color: '#D8000C',
        backgroundColor: '#FFD2D2',
        padding: '10px',
        borderRadius: '4px',
        marginBottom: '15px',
    },
    buttonGroup: {
        marginTop: '20px',
        textAlign: 'right',
        borderTop: '1px solid #eee',
        paddingTop: '15px',
    },
    button: {
        padding: '8px 15px',
        border: 'none',
        borderRadius: '4px',
        cursor: 'pointer',
        fontWeight: 'bold',
        marginLeft: '10px',
    },
    submitButton: {
        backgroundColor: '#007bff', // Blue
        color: 'white',
    },
    cancelButton: {
        backgroundColor: '#f0f0f0',
        color: '#333',
        border: '1px solid #ccc',
    }
};

export default DepartmentModal;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\EditEmployeeModal.js
================================================================================
// frontend/src/components/EditEmployeeModal.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { motion } from 'framer-motion'; // <-- Thêm import

const EditEmployeeModal = ({ isOpen, onClose, onSuccess, employeeData }) => {
  const [formData, setFormData] = useState({
    FullName: '',
    DepartmentID: '',
    PositionID: '',
    Status: '',
    PhoneNumber: '',
  });
  const [departments, setDepartments] = useState([]);
  const [positions, setPositions] = useState([]);
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const fetchDataAndPopulateForm = async () => {
      if (isOpen && employeeData) {
        setLoading(true);
        setError('');
        try {
          const [deptRes, posRes] = await Promise.all([
            api.get('/departments/'),
            api.get('/positions/')
          ]);
          setDepartments(deptRes.data);
          setPositions(posRes.data);
          setFormData({
            FullName: employeeData.FullName || '',
            DepartmentID: employeeData.department?.DepartmentID || '',
            PositionID: employeeData.position?.PositionID || '',
            Status: employeeData.Status || '',
            PhoneNumber: employeeData.PhoneNumber || '',
          });
        } catch (err) {
          console.error('Failed to fetch departments/positions for edit', err);
          setError('Không thể tải dữ liệu cần thiết để sửa.');
        } finally {
          setLoading(false);
        }
      }
    };
    fetchDataAndPopulateForm();
  }, [isOpen, employeeData]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prevData) => ({
      ...prevData,
      [name]: value,
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    const updateData = {
      FullName: formData.FullName,
      Status: formData.Status,
      PhoneNumber: formData.PhoneNumber || null,
      DepartmentID: parseInt(formData.DepartmentID, 10),
      PositionID: parseInt(formData.PositionID, 10),
    };
    if (isNaN(updateData.DepartmentID) || isNaN(updateData.PositionID)) {
      setError('Phòng ban hoặc Chức vụ không hợp lệ.');
      return;
    }

    setLoading(true);
    try {
      await api.put(`/employees/${employeeData.EmployeeID}`, updateData);
      onSuccess();
    } catch (err) {
      console.error('Failed to update employee', err);
      setError(err.response?.data?.detail || 'Cập nhật nhân viên thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) {
    return null;
  }

  return (
    <motion.div
      style={styles.overlay}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      onClick={onClose}
    >
      <motion.div
        style={styles.modal}
        initial={{ opacity: 0, scale: 0.9, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: -20 }}
        transition={{ duration: 0.2 }}
        onClick={(e) => e.stopPropagation()}
      >
        <h2 style={styles.header}>Sửa thông tin Nhân viên (ID: {employeeData?.EmployeeID})</h2>
        {error && <p style={styles.errorText}>{error}</p>}

        {loading && !error ? <p>Đang tải dữ liệu...</p> : (
          <form onSubmit={handleSubmit}>
            <div style={styles.formGroup}>
              <label style={styles.label}>Họ tên:</label>
              <input type="text" name="FullName" value={formData.FullName} onChange={handleChange} style={styles.input} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Email:</label>
              <input type="email" value={employeeData.Email || ''} disabled style={{...styles.input, ...styles.inputDisabled}} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>SĐT:</label>
              <input type="tel" name="PhoneNumber" value={formData.PhoneNumber} onChange={handleChange} style={styles.input} />
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Phòng ban:</label>
              <select name="DepartmentID" value={formData.DepartmentID} onChange={handleChange} required style={styles.input}>
                {departments.map(dept => (
                  <option key={dept.DepartmentID} value={dept.DepartmentID}>{dept.DepartmentName}</option>
                ))}
              </select>
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Chức vụ:</label>
              <select name="PositionID" value={formData.PositionID} onChange={handleChange} required style={styles.input}>
                {positions.map(pos => (
                  <option key={pos.PositionID} value={pos.PositionID}>{pos.PositionName}</option>
                ))}
              </select>
            </div>
            <div style={styles.formGroup}>
              <label style={styles.label}>Trạng thái:</label>
              <select name="Status" value={formData.Status} onChange={handleChange} required style={styles.input}>
                <option value="Đang làm việc">Đang làm việc</option>
                <option value="Nghỉ phép">Nghỉ phép</option>
                <option value="Thử việc">Thử việc</option>
                <option value="Thực tập">Thực tập</option>
              </select>
            </div>

            <div style={styles.buttonGroup}>
              <button type="button" onClick={onClose} disabled={loading} style={{...styles.button, ...styles.cancelButton}}>
                Hủy
              </button>
              <button type="submit" disabled={loading} style={{...styles.button, ...styles.submitButton}}>
                {loading ? 'Đang lưu...' : 'Lưu thay đổi'}
              </button>
            </div>
          </form>
        )}
      </motion.div>
    </motion.div>
  );
};

// --- STYLES (Tương tự AddModal, nhưng đơn giản hơn) ---
const styles = {
  overlay: {
    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
    justifyContent: 'center', alignItems: 'center', zIndex: 1000,
  },
  modal: {
    backgroundColor: '#fff', padding: '20px 25px', borderRadius: '8px',
    width: '100%', maxWidth: '500px', // Modal này nhỏ hơn
    maxHeight: '90vh', overflowY: 'auto',
    boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
  },
  header: {
    marginTop: 0, marginBottom: '20px',
    borderBottom: '1px solid #eee', paddingBottom: '10px',
  },
  formGroup: {
    marginBottom: '15px', // Tăng khoảng cách
    display: 'flex',
    flexDirection: 'column',
  },
  label: {
    fontWeight: 'bold',
    marginBottom: '5px',
    fontSize: '0.9em',
  },
  input: {
    width: '100%',
    padding: '8px 10px',
    border: '1px solid #ccc',
    borderRadius: '4px',
    boxSizing: 'border-box',
  },
  inputDisabled: {
    backgroundColor: '#f4f4f4',
    color: '#777',
  },
  errorText: {
    color: '#D8000C',
    backgroundColor: '#FFD2D2',
    padding: '10px',
    borderRadius: '4px',
    marginBottom: '15px',
  },
  buttonGroup: {
    marginTop: '20px',
    textAlign: 'right',
    borderTop: '1px solid #eee',
    paddingTop: '15px',
  },
  button: {
    padding: '8px 15px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontWeight: 'bold',
    marginLeft: '10px',
  },
  submitButton: {
    backgroundColor: '#007bff', // Blue
    color: 'white',
  },
  cancelButton: {
    backgroundColor: '#f0f0f0',
    color: '#333',
    border: '1px solid #ccc',
  }
};

export default EditEmployeeModal;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\EditSalaryModal.js
================================================================================
// frontend/src/components/EditSalaryModal.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { motion } from 'framer-motion';

const EditSalaryModal = ({ isOpen, onClose, onSuccess, salaryData }) => {
  const [formData, setFormData] = useState({
    BaseSalary: 0,
    Bonus: 0,
    Deductions: 0,
  });
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (salaryData) {
      setFormData({
        BaseSalary: salaryData.BaseSalary || 0,
        Bonus: salaryData.Bonus || 0,
        Deductions: salaryData.Deductions || 0,
      });
      setError('');
    }
  }, [salaryData]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prevData) => ({
      ...prevData,
      [name]: value,
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);
    const updateData = {
      BaseSalary: parseFloat(formData.BaseSalary),
      Bonus: parseFloat(formData.Bonus),
      Deductions: parseFloat(formData.Deductions),
    };
    try {
      await api.put(`/payroll/salaries/${salaryData.SalaryID}`, updateData);
      onSuccess();
    } catch (err) {
      console.error('Failed to update salary', err);
      setError(err.response?.data?.detail || 'Cập nhật lương thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen || !salaryData) {
    return null;
  }

  return (
    <motion.div
      style={styles.overlay}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      onClick={onClose}
    >
      <motion.div
        style={styles.modal}
        initial={{ opacity: 0, scale: 0.9, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: -20 }}
        transition={{ duration: 0.2 }}
        onClick={(e) => e.stopPropagation()}
      >
        <h2 style={styles.header}>Sửa Lương (ID: {salaryData.SalaryID})</h2>
        <p style={styles.subHeader}>Tháng: {salaryData.SalaryMonth}</p>

        {error && <p style={styles.errorText}>{error}</p>}
        
        <form onSubmit={handleSubmit}>
          <div style={styles.formGroup}>
            <label style={styles.label}>Lương cơ bản:</label>
            <input type="number" step="0.01" name="BaseSalary" value={formData.BaseSalary} onChange={handleChange} required style={styles.input} />
          </div>
          <div style={styles.formGroup}>
            <label style={styles.label}>Thưởng:</label>
            <input type="number" step="0.01" name="Bonus" value={formData.Bonus} onChange={handleChange} style={styles.input} />
          </div>
          <div style={styles.formGroup}>
            <label style={styles.label}>Khấu trừ:</label>
            <input type="number" step="0.01" name="Deductions" value={formData.Deductions} onChange={handleChange} style={styles.input} />
          </div>

          <div style={styles.buttonGroup}>
            <button type="button" onClick={onClose} disabled={loading} style={{...styles.button, ...styles.cancelButton}}>
              Hủy
            </button>
            <button type="submit" disabled={loading} style={{...styles.button, ...styles.submitButton}}>
              {loading ? 'Đang lưu...' : 'Lưu thay đổi'}
            </button>
          </div>
        </form>
      </motion.div>
    </motion.div>
  );
};

// --- STYLES NÂNG CẤP ---
const styles = {
  overlay: {
    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
    justifyContent: 'center', alignItems: 'center', zIndex: 1000,
  },
  modal: {
    backgroundColor: '#fff', padding: '20px 25px', borderRadius: '8px',
    width: '100%', maxWidth: '450px',
    boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
  },
  header: {
    marginTop: 0,
    marginBottom: '10px', // <-- SỬA Ở ĐÂY
  },
  subHeader: {
    fontSize: '0.9em',
    color: '#666',
    marginTop: '-5px', // <-- SỬA Ở ĐÂY
    marginBottom: '20px',
  },
  formGroup: {
    marginBottom: '15px',
    display: 'flex',
    flexDirection: 'column',
  },
  label: {
    fontWeight: 'bold',
    marginBottom: '5px',
    fontSize: '0.9em',
  },
  input: {
    width: '100%',
    padding: '8px 10px',
    border: '1px solid #ccc',
    borderRadius: '4px',
    boxSizing: 'border-box',
  },
  errorText: {
    color: '#D8000C',
    backgroundColor: '#FFD2D2',
    padding: '10px',
    borderRadius: '4px',
    marginBottom: '15px',
  },
  buttonGroup: {
    marginTop: '20px',
    textAlign: 'right',
    borderTop: '1px solid #eee',
    paddingTop: '15px',
  },
  button: {
    padding: '8px 15px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontWeight: 'bold',
    marginLeft: '10px',
  },
  submitButton: {
    backgroundColor: '#007bff', // Blue
    color: 'white',
  },
  cancelButton: {
    backgroundColor: '#f0f0f0',
    color: '#333',
    border: '1px solid #ccc',
  }
};

export default EditSalaryModal;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\Layout.js
================================================================================
import React, { useState, useEffect } from 'react';
// Use NavLink for active styling
import { NavLink, Outlet, useNavigate, useLocation } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';
import NotificationsBell from '../components/NotificationsBell';
import { motion, AnimatePresence } from 'framer-motion';

// --- Icons ---
// Icons from Version 2 (Base)
const UserAvatarIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="8" r="5"></circle>
        <path d="M20 21a8 8 0 1 0-16 0"></path>
    </svg>
);
const SunIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
);
const MoonIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
);

// Icons from Version 1 (Upgrade)
const MenuIcon = () => ( // Icon for sidebar toggle
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
);
const LogoutIcon = () => ( // Icon for logout
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
    </svg>
);

// --- Placeholders for Nav Icons (Replace <svg ... /> with actual SVG code) ---
const DashboardIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>;
const UsersIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
const EmployeesIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>;
const OrgIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 2H6a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h4v0a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"></path><path d="M18 15h-4a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2z"></path><path d="M6 15h.01"></path><path d="M6 18h.01"></path><path d="M14 15h.01"></path><path d="M14 18h.01"></path><path d="M10 9v.01"></path><path d="M18 9v.01"></path><path d="M14 22v-3a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v3"></path><path d="M14 9V6a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v3"></path></svg>;
const PayrollIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>;
const ReportsIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15.2 2H8.8A1.8 1.8 0 0 0 7 3.8v16.4A1.8 1.8 0 0 0 8.8 22h6.4a1.8 1.8 0 0 0 1.8-1.8V3.8A1.8 1.8 0 0 0 15.2 2z"></path><path d="M8 12h8"></path><path d="M8 16h8"></path><path d="M11 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"></path></svg>;
const ProfileIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;

// --- New Icons for Updated Functions ---
const ShareholderIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
const SystemIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;
const CheckCircleIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
// --- End Icons ---


const Layout = () => {
    const { user, logout } = useAuth();
    const navigate = useNavigate();
    const location = useLocation(); // Needed for Framer Motion key

    // --- State ---
    const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);
    const [isDarkMode, setIsDarkMode] = useState(() => {
        const savedTheme = localStorage.getItem('theme');
        // Default to light mode if no preference saved or system preference is light
        return savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches);
    });

    // --- Handlers ---
    const toggleSidebar = () => setIsSidebarCollapsed(prev => !prev);
    const toggleTheme = () => {
        setIsDarkMode(prevMode => {
            const newMode = !prevMode;
            localStorage.setItem('theme', newMode ? 'dark' : 'light');
            return newMode;
        });
    };
    const handleLogout = () => {
        // Add confirmation dialog
        if (window.confirm("Bạn có chắc chắn muốn đăng xuất?")) {
             logout();
             navigate('/login');
        }
    };

    // --- Effects ---
    // Apply theme class to body
    useEffect(() => {
        document.body.className = isDarkMode ? 'theme-dark' : 'theme-light';
    }, [isDarkMode]);

    // Inject dynamic CSS styles
    useEffect(() => {
        const styleId = 'layout-dynamic-styles';
        let styleSheet = document.getElementById(styleId);
        if (!styleSheet) {
            styleSheet = document.createElement("style");
            styleSheet.id = styleId;
            styleSheet.type = "text/css";
            document.head.appendChild(styleSheet);
        }
        styleSheet.innerText = customLayoutStyles; // CSS string defined below
        // Optional cleanup: remove style on component unmount
        // return () => { if (styleSheet) document.head.removeChild(styleSheet); };
    }, []); // Run only once

    // --- Role Checks ---
    const isAdmin = user?.role === 'Admin';
    const isHrManager = user?.role === 'HR Manager';
    const isPayrollManager = user?.role === 'Payroll Manager';
    const isEmployee = user?.role === 'Employee';

    // --- Dynamic Styles ---
    // Function to apply active style to NavLink
    const getNavLinkStyle = ({ isActive }) => ({
        ...styles.navLinkBase,
        ...(isActive ? styles.navLinkActive : styles.navLinkInactive),
        justifyContent: isSidebarCollapsed ? 'center' : 'flex-start', // Center icon when collapsed
    });

    // Sidebar width based on state
    const sidebarWidth = isSidebarCollapsed ? '80px' : '250px';
    const dynamicSidebarStyle = {
        ...styles.sidebar,
        width: sidebarWidth,
    };
    const dynamicMainContentStyle = {
        ...styles.mainContentWrapper,
        marginLeft: sidebarWidth,
    };

    // --- Framer Motion Variants ---
    const pageVariants = {
        initial: { opacity: 0, y: 15 }, // Slide up slightly
        in: { opacity: 1, y: 0 },
        out: { opacity: 0, y: -15 } // Slide up slightly
    };
    const pageTransition = { type: "tween", ease: "easeInOut", duration: 0.3 };

    return (
        <div style={styles.layoutContainer} className={isDarkMode ? 'theme-dark' : 'theme-light'}>
            {/* --- Sidebar --- */}
            <motion.nav
                style={dynamicSidebarStyle}
                animate={{ width: sidebarWidth }}
                transition={{ duration: 0.3, ease: "easeInOut" }}
            >
                 {/* Sidebar Header with Toggle */}
                 <div style={styles.sidebarHeader}>
                     {!isSidebarCollapsed && <h3 style={styles.sidebarTitle}>HRM Dashboard</h3>}
                     <button onClick={toggleSidebar} style={styles.sidebarToggle} title={isSidebarCollapsed ? "Mở rộng" : "Thu gọn"}>
                         <MenuIcon />
                     </button>
                 </div>

                <ul style={styles.navList}>
                    {/* Use NavLink for automatic active class handling */}
                    <li><NavLink to="/" style={getNavLinkStyle} end>
                        <DashboardIcon /> {!isSidebarCollapsed && <span>Dashboard</span>}
                    </NavLink></li>

                    {/* --- NHÓM ADMIN --- */}
                    {isAdmin && (
                        <>
                            <li><NavLink to="/employees" style={getNavLinkStyle}>
                               <EmployeesIcon /> {!isSidebarCollapsed && <span>Quản lý Nhân sự</span>}
                            </NavLink></li>
                            
                            {/* [FIX] Thêm mục Quản lý Tổ chức vào menu Admin */}
                            <li><NavLink to="/management" style={getNavLinkStyle}>
                                <OrgIcon/> {!isSidebarCollapsed && <span>Quản lý Tổ chức</span>}
                            </NavLink></li>

                            <li><NavLink to="/payroll" style={getNavLinkStyle}>
                                <PayrollIcon/> {!isSidebarCollapsed && <span>Quản lý Lương</span>}
                            </NavLink></li>
                            <li><NavLink to="/shareholders" style={getNavLinkStyle}>
                                <ShareholderIcon/> {!isSidebarCollapsed && <span>QL Cổ đông</span>}
                            </NavLink></li>
                            <li style={styles.adminLinkSeparator}><NavLink to="/system-admin" style={getNavLinkStyle}>
                                <SystemIcon /> {!isSidebarCollapsed && <span>Quản trị Hệ thống</span>}
                            </NavLink></li>
                            <li><NavLink to="/user-management" style={getNavLinkStyle}>
                               <UsersIcon /> {!isSidebarCollapsed && <span>Quản lý Tài khoản</span>}
                            </NavLink></li>
                        </>
                    )}

                    {/* --- NHÓM HR MANAGER --- */}
                    {(isHrManager) && (
                        <>
                            <li><NavLink to="/employees" style={getNavLinkStyle}>
                               <EmployeesIcon /> {!isSidebarCollapsed && <span>Quản lý Nhân viên</span>}
                            </NavLink></li>
                            <li><NavLink to="/management" style={getNavLinkStyle}>
                                <OrgIcon/> {!isSidebarCollapsed && <span>Quản lý Tổ chức</span>}
                            </NavLink></li>
                            <li><NavLink to="/leave-approval" style={getNavLinkStyle}>
                                <div style={{display: 'flex', alignItems: 'center', gap: isSidebarCollapsed ? 0 : '12px'}}>
                                    <CheckCircleIcon />
                                    {!isSidebarCollapsed && (
                                        <span style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', width: '100%'}}>
                                            Duyệt Nghỉ phép
                                            <span style={styles.notificationDot}>3</span>
                                        </span>
                                    )}
                                </div>
                            </NavLink></li>
                            <li><NavLink to="/shareholders" style={getNavLinkStyle}>
                                <ShareholderIcon/> {!isSidebarCollapsed && <span>Quản lý Cổ đông</span>}
                            </NavLink></li>
                            <li><NavLink to="/reports" style={getNavLinkStyle}>
                                <ReportsIcon/> {!isSidebarCollapsed && <span>Báo cáo</span>}
                            </NavLink></li>
                        </>
                    )}

                    {/* --- NHÓM PAYROLL MANAGER --- */}
                    {(isPayrollManager) && (
                        <>
                            <li><NavLink to="/payroll" style={getNavLinkStyle}>
                                <PayrollIcon/> {!isSidebarCollapsed && <span>Quản lý Bảng lương</span>}
                            </NavLink></li>
                            <li><NavLink to="/shareholders" style={getNavLinkStyle}>
                                <ShareholderIcon/> {!isSidebarCollapsed && <span>Quản lý Cổ tức</span>}
                            </NavLink></li>
                            <li><NavLink to="/reports" style={getNavLinkStyle}>
                                <ReportsIcon/> {!isSidebarCollapsed && <span>Báo cáo</span>}
                            </NavLink></li>
                        </>
                    )}

                    {/* --- NHÓM EMPLOYEE --- */}
                    {isEmployee && user?.emp_id && (
                        <>
                            <li><NavLink to={`/employees/${user.emp_id}`} style={getNavLinkStyle}>
                               <ProfileIcon/> {!isSidebarCollapsed && <span>Hồ sơ của tôi</span>}
                            </NavLink></li>
                            <li><NavLink to="/my-attendance" style={getNavLinkStyle}>
                                <CheckCircleIcon /> {!isSidebarCollapsed && <span>Chấm công & Phép</span>}
                            </NavLink></li>
                            <li><NavLink to="/my-payslips" style={getNavLinkStyle}>
                                <PayrollIcon /> {!isSidebarCollapsed && <span>Phiếu lương</span>}
                            </NavLink></li>
                        </>
                    )}
                </ul>
            </motion.nav>

            {/* --- Main Content Area --- */}
            <motion.div
                style={dynamicMainContentStyle}
                animate={{ marginLeft: sidebarWidth }}
                transition={{ duration: 0.3, ease: "easeInOut" }}
            >
                {/* --- Header --- */}
                <header style={styles.header}>
                    <div></div>
                    <div style={styles.headerRight}>
                        <NotificationsBell />
                        <button onClick={toggleTheme} style={styles.themeToggleButton} title="Chuyển chế độ Sáng/Tối">
                            {isDarkMode ? <SunIcon /> : <MoonIcon />}
                        </button>
                        <div style={styles.userMenu}>
                             <UserAvatarIcon />
                            <span style={styles.userEmail}>{user?.email}</span>
                            <span style={styles.userRole}>({user?.role})</span>
                        </div>
                        <button onClick={handleLogout} style={styles.logoutButton} className="logout-button" title="Đăng xuất">
                           <LogoutIcon />
                        </button>
                    </div>
                </header>

                {/* --- Page Content with Animation --- */}
                <main style={styles.contentArea}>
                    <AnimatePresence mode="wait">
                         <motion.div
                            key={location.pathname} // Re-renders on path change
                            initial="initial"
                            animate="in"
                            exit="out"
                            variants={pageVariants}
                            transition={pageTransition}
                         >
                            <Outlet /> {/* Renders the matched child route */}
                         </motion.div>
                    </AnimatePresence>
                </main>
            </motion.div>
        </div>
    );
};

// --- Enhanced Styles using CSS Variables ---
const styles = {
    layoutContainer: {
        display: 'flex',
        minHeight: '100vh',
        backgroundColor: 'var(--bg-color)', // Use variable
    },
    sidebar: {
        // width is dynamic
        borderRight: '1px solid var(--border-color)',
        background: 'var(--sidebar-bg)',
        padding: '0', // Remove padding, handle internally
        boxShadow: '2px 0 8px rgba(0,0,0,0.08)',
        position: 'fixed', // Keep fixed
        top: 0,
        left: 0,
        height: '100%',
        overflowY: 'auto',
        overflowX: 'hidden', // Hide horizontal scrollbar
        zIndex: 100, // Ensure sidebar is on top
        display: 'flex',
        flexDirection: 'column',
    },
     sidebarHeader: {
         display: 'flex',
         alignItems: 'center',
         justifyContent: 'space-between', // Space between title and button
         padding: '15px', // Consistent padding
         height: '60px', // Match header height
         borderBottom: '1px solid var(--border-color)',
         flexShrink: 0, // Prevent header from shrinking
     },
    sidebarTitle: {
        fontSize: '1.3rem', // Slightly smaller
        color: 'var(--primary-color)',
        margin: 0,
        whiteSpace: 'nowrap', // Prevent title wrapping
        overflow: 'hidden',
        textOverflow: 'ellipsis',
    },
     sidebarToggle: {
         background: 'none',
         border: 'none',
         cursor: 'pointer',
         padding: '5px',
         display: 'flex',
         color: 'var(--text-color-secondary)',
         borderRadius: '4px',
     },
    navList: {
        listStyleType: 'none',
        padding: '15px', // Add padding around the list itself
        margin: 0,
        flexGrow: 1, // Allow list to fill remaining space
        overflowY: 'auto', // Scroll if needed
    },
    // Base styles for all NavLinks
    navLinkBase: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px', // Space between icon and text
        padding: '10px 15px', // Adjusted padding
        marginBottom: '4px', // Tighter spacing
        textDecoration: 'none',
        borderRadius: '6px', // Slightly more rounded
        whiteSpace: 'nowrap', // Prevent text wrapping
        overflow: 'hidden',
        textOverflow: 'ellipsis',
        transition: 'background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease',
    },
    // Styles for inactive links
    navLinkInactive: {
        color: 'var(--text-color-secondary)', // Dimmer color for inactive
        backgroundColor: 'transparent',
        fontWeight: 'normal',
    },
    // Styles for the active link
    navLinkActive: {
        color: '#fff', // White text on active
        backgroundColor: 'var(--primary-color)',
        fontWeight: '500', // Medium weight for active
        boxShadow: '0 2px 5px rgba(24, 144, 255, 0.2)', // Subtle shadow for active
    },
     adminLinkSeparator: { // Optional separator style
         marginTop: '15px',
         paddingTop: '15px',
         borderTop: '1px solid var(--border-color-lighter)', // Use a lighter border
     },
    notificationDot: {
        backgroundColor: '#ff4d4f',
        color: '#fff',
        borderRadius: '10px',
        padding: '0 6px',
        fontSize: '0.75rem',
        fontWeight: 'bold',
        marginLeft: 'auto', // Push to right
    },
    mainContentWrapper: {
        flex: 1,
        // marginLeft is dynamic
        display: 'flex',
        flexDirection: 'column',
        overflow: 'hidden', // Prevent layout shifts during transition
    },
    header: {
        display: 'flex',
        justifyContent: 'space-between', // Push left/right content apart
        alignItems: 'center',
        padding: '0 25px', // Vertical padding handled by height
        borderBottom: '1px solid var(--border-color)',
        backgroundColor: 'var(--header-bg)',
        height: '60px', // Fixed header height
        boxShadow: '0 2px 5px rgba(0,0,0,0.05)',
        flexShrink: 0, // Prevent header shrinking
        zIndex: 50,
    },
    headerRight: {
        display: 'flex',
        alignItems: 'center',
        gap: '15px', // Space between items in the right header
    },
    themeToggleButton: {
        background: 'none',
        border: 'none',
        cursor: 'pointer',
        padding: '6px', // Slightly larger click area
        borderRadius: '50%',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'var(--text-color-secondary)',
    },
    userMenu: {
        display: 'flex',
        alignItems: 'center',
        gap: '8px', // Use gap for spacing
        padding: '5px 10px',
        borderRadius: '6px',
        cursor: 'default', // Not clickable for now
    },
     userEmail: {
         fontSize: '0.9rem',
         color: 'var(--text-color)', // Use main text color
         fontWeight: 500,
         marginRight: '5px',
     },
     userRole: {
         fontSize: '0.8rem',
         color: 'var(--text-color-secondary)',
         fontStyle: 'italic',
     },
    logoutButton: {
        padding: '6px', // Padding for icon button
        border: 'none', // Borderless button
        borderRadius: '50%', // Circular button
        cursor: 'pointer',
        backgroundColor: 'transparent', // Transparent background
        color: 'var(--text-color-secondary)', // Icon color matches theme toggle
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        transition: 'background-color 0.2s ease, color 0.2s ease',
    },
    contentArea: {
        flex: 1, // Take remaining space
        padding: '25px 30px', // More padding
        overflowY: 'auto', // Allow content scrolling independently
        backgroundColor: 'var(--bg-color)',
        position: 'relative', // Needed for Framer Motion positioning
    },
};

// --- Dynamic CSS (Includes Theme Variables and Hover Effects) ---
const customLayoutStyles = `
    /* Define Theme Variables */
    body.theme-light, :root.theme-light { /* Added :root for broader scope */
        --bg-color: #f4f7f9; /* Lighter grey */
        --sidebar-bg: #ffffff;
        --header-bg: #ffffff;
        --card-bg: #ffffff;
        --modal-bg: #ffffff;
        --text-color: #343a40; /* Darker text */
        --text-color-secondary: #6c757d; /* Grey text */
        --border-color: #dee2e6; /* Lighter border */
        --border-color-lighter: #e9ecef;
        --table-border-color: #dee2e6;
        --table-row-border-color: #e9ecef;
        --table-header-bg: #f8f9fa; /* Very light grey */
        --button-bg: #e9ecef;
        --button-text: #343a40;
        --input-bg: #ffffff;
        --input-border-color: #ced4da;
        --primary-color: #0d6efd; /* Standard Bootstrap blue */
        --hover-bg: #f8f9fa; /* Background for hover states */
        color-scheme: light;
    }
    body.theme-dark, :root.theme-dark {
        --bg-color: #121212; /* Very dark grey */
        --sidebar-bg: #1e1e1e; /* Slightly lighter dark */
        --header-bg: #1e1e1e;
        --card-bg: #1e1e1e;
        --modal-bg: #1e1e1e;
        --text-color: #e0e0e0; /* Off-white */
        --text-color-secondary: #a0a0a0; /* Lighter grey */
        --border-color: #333333; /* Darker border */
        --border-color-lighter: #2a2a2a;
        --table-border-color: #444444;
        --table-row-border-color: #333333;
        --table-header-bg: #2a2a2a;
        --button-bg: #333333;
        --button-text: #e0e0e0;
        --input-bg: #2a2a2a;
        --input-border-color: #444444;
        --primary-color: #3b82f6; /* Brighter blue for dark mode */
        --hover-bg: #2a2a2a;
        color-scheme: dark;
    }

    /* Apply smooth transition globally */
    body, * { /* Apply to all elements for consistency */
         transition: background-color 0.25s ease, color 0.25s ease, border-color 0.25s ease, box-shadow 0.25s ease;
    }
    /* Remove default margins/paddings */
    body, h1, h2, h3, h4, h5, h6, p, ul, ol { margin: 0; padding: 0; }
    ul, ol { list-style: none; }

    /* Apply variables to general elements */
    body { background-color: var(--bg-color); color: var(--text-color); font-size: 14px; }
    h1, h2, h3, h4, h5, h6 { color: var(--text-color); margin-bottom: 0.5em; /* Add some default spacing back */}
    p { color: var(--text-color); margin-bottom: 1em; }
    a { color: var(--primary-color); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Theme specific input/select styling */
    input, select, textarea {
       background-color: var(--input-bg);
       border: 1px solid var(--input-border-color);
       color: var(--text-color);
       border-radius: 4px;
       padding: 8px 12px;
    }
    input::placeholder, textarea::placeholder {
       color: var(--text-color-secondary);
       opacity: 0.7;
    }
    input:focus, select:focus, textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(var(--primary-color-rgb, 13, 110, 253), 0.25); /* Use RGB for shadow */
        outline: none;
    }
     /* Define primary color RGB for box-shadow */
    :root { --primary-color-rgb: 13, 110, 253; }
    :root.theme-dark { --primary-color-rgb: 59, 130, 246; }

    input:disabled, select:disabled, textarea:disabled {
        background-color: var(--button-bg) !important; /* Use button bg for disabled */
        color: var(--text-color-secondary) !important;
        cursor: not-allowed;
        opacity: 0.65;
    }

    /* Scrollbars */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-color); }
    ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-color-secondary); }

    /* NavLink Hover Effect */
    nav ul li a:hover { /* Apply hover to base style */
        background-color: var(--hover-bg) !important;
        color: var(--primary-color) !important; /* Make text primary color on hover */
        text-decoration: none; /* Remove underline from NavLink */
    }
     /* Ensure active state overrides hover background */
    nav ul li a[style*="background-color: var(--primary-color)"]:hover {
       background-color: var(--primary-color) !important; /* Keep primary color */
       color: #fff !important; /* Keep white text */
    }


    /* Button Hover Effects */
    button.logout-button:hover,
    button[title="Chuyển chế độ Sáng/Tối"]:hover,
    button[title="Mở rộng"]:hover,
    button[title="Thu gọn"]:hover {
        background-color: var(--hover-bg) !important;
        color: var(--text-color); /* Make icon darker on hover */
    }
`;
export default Layout;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\NotificationsBell.js
================================================================================
// frontend/src/components/NotificationsBell.js
import React, { useState, useEffect, useRef, useCallback } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';

// Icon Chuông SVG (có thể thay bằng icon từ thư viện)
const BellIcon = ({ hasUnread }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
    {/* Chấm đỏ nhỏ hơn */}
    {hasUnread && <circle cx="19.5" cy="5.5" r="3" fill="#ff4d4f" stroke="#fff" strokeWidth="1"/>}
  </svg>
);

const NotificationsBell = () => {
    const { user } = useAuth();
    const [notifications, setNotifications] = useState([]);
    const [unreadCount, setUnreadCount] = useState(0);
    const [isOpen, setIsOpen] = useState(false);
    const [loading, setLoading] = useState(false);
    const dropdownRef = useRef(null); // Để đóng dropdown khi click ra ngoài

    // Hàm fetch, dùng useCallback để ổn định
    const fetchNotifications = useCallback(async (includeRead = false) => {
        if (!user) return;
        setLoading(true);
        try {
            // Lấy cả count và list chưa đọc (hoặc cả đã đọc nếu includeRead=true)
            const countRes = await api.get('/notifications/unread-count');
            setUnreadCount(countRes.data);

            const listRes = await api.get('/notifications/', { params: { limit: 10, include_read: includeRead } });
            setNotifications(listRes.data);

        } catch (error) {
            console.error("Failed to fetch notifications", error);
            // Có thể thêm state lỗi để hiển thị
        } finally {
            setLoading(false);
        }
    }, [user]); // Chỉ phụ thuộc vào user

    // Fetch lần đầu và đặt interval
    useEffect(() => {
        if (user) {
            fetchNotifications();
            const intervalId = setInterval(() => fetchNotifications(), 60000); // Poll mỗi phút
            return () => clearInterval(intervalId);
        }
    }, [fetchNotifications, user]); // Gọi lại fetchNotifications nếu nó thay đổi (do user thay đổi)

    // Đóng dropdown khi click ra ngoài
    useEffect(() => {
        const handleClickOutside = (event) => {
            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                setIsOpen(false);
            }
        };
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
    }, []);

    const handleToggleDropdown = () => {
        setIsOpen(!isOpen);
        // Nếu mở ra, fetch lại để cập nhật (có thể fetch cả đã đọc)
        if (!isOpen) {
             fetchNotifications(true); // Lấy cả thông báo đã đọc
        }
    };

    const handleMarkAsRead = async (notificationId) => {
        // Đánh dấu ở backend
        try {
            await api.put(`/notifications/${notificationId}/read`);
            // Cập nhật UI ngay lập tức
            setNotifications(prev => prev.map(n =>
                n.id === notificationId ? { ...n, is_read: true } : n
            ));
            // Giảm count nếu nó chưa đọc
            const wasUnread = notifications.find(n => n.id === notificationId)?.is_read === false;
            if (wasUnread) {
                 setUnreadCount(prev => Math.max(0, prev - 1));
            }
        } catch (error) {
            console.error("Failed to mark as read", error);
        }
    };

     const handleMarkAllRead = async () => {
        try {
            await api.put(`/notifications/read-all`);
            setNotifications(prev => prev.map(n => ({ ...n, is_read: true })));
            setUnreadCount(0);
        } catch (error) {
            console.error("Failed to mark all as read", error);
        }
    };

    if (!user) return null;

    return (
        <div style={styles.bellContainer} ref={dropdownRef}>
            <button onClick={handleToggleDropdown} style={styles.bellButton} title="Thông báo">
                <BellIcon hasUnread={unreadCount > 0} />
                {unreadCount > 0 && <span style={styles.badge}>{unreadCount > 9 ? '9+' : unreadCount}</span>}
            </button>

            {isOpen && (
                <div style={styles.dropdown}>
                    <div style={styles.dropdownHeader}>
                        <span>Thông báo</span>
                        {unreadCount > 0 && (
                            <button onClick={handleMarkAllRead} style={styles.markAllReadButton}>
                                Đánh dấu tất cả đã đọc
                            </button>
                        )}
                    </div>
                    <div style={styles.dropdownContent}>
                        {loading && <p style={styles.dropdownItem}>Đang tải...</p>}
                        {!loading && notifications.length === 0 && (
                            <p style={styles.dropdownItem}>Không có thông báo nào.</p>
                        )}
                        {!loading && notifications.map((notification) => (
                            <div
                                key={notification.id}
                                style={notification.is_read ? styles.dropdownItemRead : styles.dropdownItem}
                            >
                                <p style={{ margin: '0 0 5px 0' }}>{notification.message}</p>
                                <div style={styles.itemFooter}>
                                    <small style={{ color: '#888' }}>
                                        {new Date(notification.created_at).toLocaleString('vi-VN')}
                                    </small>
                                    {!notification.is_read && (
                                        <button
                                            onClick={() => handleMarkAsRead(notification.id)}
                                            style={styles.markReadButton}
                                            title="Đánh dấu đã đọc"
                                        >
                                            ✔️
                                        </button>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                    {/* Có thể thêm link Xem tất cả ở đây */}
                </div>
            )}
        </div>
    );
};

// --- CSS Styles ---
const styles = {
    bellContainer: { position: 'relative', marginLeft: '15px', },
    bellButton: { background: 'none', border: 'none', cursor: 'pointer', padding: '5px', position: 'relative', color: '#333', },
    badge: {
        position: 'absolute', top: '0px', right: '0px', background: '#ff4d4f',
        color: 'white', borderRadius: '50%', padding: '1px 5px', fontSize: '0.7em',
        fontWeight: 'bold', minWidth: '16px', height: '16px', display: 'flex',
        justifyContent: 'center', alignItems: 'center', lineHeight: '1'
    },
    dropdown: {
        position: 'absolute', top: 'calc(100% + 5px)', right: 0, width: '380px',
        backgroundColor: 'white', boxShadow: '0 5px 15px rgba(0,0,0,0.2)',
        borderRadius: '4px', zIndex: 1100, border: '1px solid #ddd',
    },
    dropdownHeader: {
        padding: '12px 15px', borderBottom: '1px solid #eee', fontWeight: 'bold',
        display: 'flex', justifyContent: 'space-between', alignItems: 'center',
    },
    dropdownContent: { maxHeight: '350px', overflowY: 'auto' }, // Thêm cuộn
    dropdownItem: { padding: '12px 15px', borderBottom: '1px solid #eee', fontSize: '0.9em', cursor: 'default', '&:last-child': { borderBottom: 'none' } },
    dropdownItemRead: { padding: '12px 15px', borderBottom: '1px solid #eee', fontSize: '0.9em', backgroundColor: '#f9f9f9', color: '#777', '&:last-child': { borderBottom: 'none' } },
    itemFooter: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '5px' },
    markReadButton: { background: 'none', border: 'none', color: '#1890ff', cursor: 'pointer', fontSize: '1.1em', padding: '0', },
    markAllReadButton: { background: 'none', border: 'none', color: '#1890ff', cursor: 'pointer', fontSize: '0.8em', padding: '0', fontWeight: 'normal', },
};

export default NotificationsBell;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\PositionModal.js
================================================================================
// frontend/src/components/PositionModal.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { motion } from 'framer-motion';

const PositionModal = ({ isOpen, onClose, onSuccess, positionData }) => {
  const [name, setName] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const isEditMode = !!positionData;

  useEffect(() => {
    if (isEditMode) setName(positionData.PositionName || '');
    else setName('');
    setError('');
  }, [isOpen, positionData, isEditMode]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!name.trim()) {
      setError('Tên chức vụ không được để trống.');
      return;
    }
    setLoading(true);
    setError('');
    try {
      if (isEditMode) {
        await api.put(`/positions/${positionData.PositionID}`, { PositionName: name });
      } else {
        await api.post('/positions/', { PositionName: name });
      }
      onSuccess();
    } catch (err) {
      setError(err.response?.data?.detail || 'Lưu thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <motion.div
      style={styles.overlay}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      onClick={onClose}
    >
      <motion.div
        style={styles.modal}
        initial={{ opacity: 0, scale: 0.9, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: -20 }}
        transition={{ duration: 0.2 }}
        onClick={(e) => e.stopPropagation()}
      >
        <h2 style={styles.header}>{isEditMode ? 'Sửa Chức vụ' : 'Thêm Chức vụ mới'}</h2>
        {isEditMode && <p style={styles.subHeader}>ID: {positionData.PositionID}</p>}
        {error && <p style={styles.errorText}>{error}</p>}
        
        <form onSubmit={handleSubmit}>
          <div style={styles.formGroup}>
            <label style={styles.label}>Tên Chức vụ:</label>
            <input 
              type="text" 
              value={name} 
              onChange={(e) => setName(e.target.value)} 
              disabled={loading} 
              style={styles.input} 
              required 
            />
          </div>
          <div style={styles.buttonGroup}>
            <button type="button" onClick={onClose} disabled={loading} style={{...styles.button, ...styles.cancelButton}}>
              Hủy
            </button>
            <button type="submit" disabled={loading} style={{...styles.button, ...styles.submitButton}}>
              {loading ? 'Đang lưu...' : (isEditMode ? 'Lưu thay đổi' : 'Thêm mới')}
            </button>
          </div>
        </form>
      </motion.div>
    </motion.div>
  );
};

// --- STYLES (Giống hệt DepartmentModal) ---
const styles = {
    overlay: {
        position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
        backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
        justifyContent: 'center', alignItems: 'center', zIndex: 1000,
    },
    modal: {
        backgroundColor: '#fff', padding: '20px 25px', borderRadius: '8px',
        width: '100%', maxWidth: '450px',
        boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
    },
    header: {
        marginTop: 0,
        marginBottom: '10px', // <-- SỬA Ở ĐÂY
    },
    subHeader: {
        fontSize: '0.9em',
        color: '#666',
        marginTop: '-5px', // <-- SỬA Ở ĐÂY
        marginBottom: '20px',
    },
    formGroup: {
        marginBottom: '15px',
        display: 'flex',
        flexDirection: 'column',
    },
    label: {
        fontWeight: 'bold',
        marginBottom: '5px',
        fontSize: '0.9em',
    },
    input: {
        width: '100%',
        padding: '8px 10px',
        border: '1px solid #ccc',
        borderRadius: '4px',
        boxSizing: 'border-box',
    },
    errorText: {
        color: '#D8000C',
        backgroundColor: '#FFD2D2',
        padding: '10px',
        borderRadius: '4px',
        marginBottom: '15px',
    },
    buttonGroup: {
        marginTop: '20px',
        textAlign: 'right',
        borderTop: '1px solid #eee',
        paddingTop: '15px',
    },
    button: {
        padding: '8px 15px',
        border: 'none',
        borderRadius: '4px',
        cursor: 'pointer',
        fontWeight: 'bold',
        marginLeft: '10px',
    },
    submitButton: {
        backgroundColor: '#007bff', // Blue
        color: 'white',
    },
    cancelButton: {
        backgroundColor: '#f0f0f0',
        color: '#333',
        border: '1px solid #ccc',
    }
};

export default PositionModal;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\ProtectedRoute.js
================================================================================
import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

// Component này bảo vệ 1 route
const ProtectedRoute = ({ children, allowedRoles }) => {
  const { user } = useAuth();
  const location = useLocation();

  // 1. Kiểm tra đã đăng nhập chưa
  if (!user) {
    // Nếu chưa, đá về trang login
    return <Navigate to="/login" state={{ from: location }} replace />;
  }
  
  // 2. Kiểm tra có yêu cầu vai trò (role) không
  if (allowedRoles && !allowedRoles.includes(user.role)) {
    // Nếu có, nhưng user không có vai trò đó, đá về trang "Unauthorized"
    // (Bạn có thể tạo trang /unauthorized)
    console.warn(`User role '${user.role}' not in allowedRoles:`, allowedRoles);
    return <Navigate to="/" replace />; // Tạm thời đá về Dashboard
  }

  // Nếu ổn, cho phép truy cập
  return children;
};

export default ProtectedRoute;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\ResetPasswordModal.js
================================================================================
// frontend/src/components/ResetPasswordModal.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { motion } from 'framer-motion'; // <-- Thêm import

const ResetPasswordModal = ({ isOpen, onClose, onSuccess, userData }) => {
  const [newPassword, setNewPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  useEffect(() => {
    if (isOpen) {
      setNewPassword('');
      setError('');
    }
  }, [isOpen]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (newPassword.trim().length < 6) {
      setError('Mật khẩu mới phải có ít nhất 6 ký tự.');
      return;
    }
    setLoading(true);
    setError('');
    try {
      await api.put(`/users/${userData.id}/password`, { new_password: newPassword });
      onSuccess();
    } catch (err) {
      setError(err.response?.data?.detail || 'Đặt lại mật khẩu thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen || !userData) return null;

  return (
    <motion.div
      style={styles.overlay}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      onClick={onClose}
    >
      <motion.div
        style={styles.modal}
        initial={{ opacity: 0, scale: 0.9, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: -20 }}
        transition={{ duration: 0.2 }}
        onClick={(e) => e.stopPropagation()}
      >
        <h2 style={styles.header}>Đặt lại mật khẩu cho:</h2>
        <p style={styles.emailText}>{userData.email}</p>

        {error && <p style={styles.errorText}>{error}</p>}

        <form onSubmit={handleSubmit}>
          <div style={styles.formGroup}>
            <label style={styles.label}>Mật khẩu mới:</label>
            <input
              type="password"
              value={newPassword}
              onChange={(e) => setNewPassword(e.target.value)}
              disabled={loading}
              required
              style={styles.input}
              placeholder="Nhập mật khẩu mới (ít nhất 6 ký tự)"
            />
          </div>
          <div style={styles.buttonGroup}>
            <button type="button" onClick={onClose} disabled={loading} style={{...styles.button, ...styles.cancelButton}}>
              Hủy
            </button>
            <button type="submit" disabled={loading} style={{...styles.button, ...styles.submitButton}}>
              {loading ? 'Đang lưu...' : 'Đặt lại mật khẩu'}
            </button>
          </div>
        </form>
      </motion.div>
    </motion.div>
  );
};

// --- STYLES (Giống hệt SetRoleModal) ---
const styles = {
  overlay: {
    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
    justifyContent: 'center', alignItems: 'center', zIndex: 1000,
  },
  modal: {
    backgroundColor: '#fff', padding: '20px 25px', borderRadius: '8px',
    width: '100%', maxWidth: '450px',
    boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
  },
  header: {
    marginTop: 0,
    marginBottom: '5px',
  },
  emailText: {
    fontSize: '1.1em',
    fontWeight: 'bold',
    color: '#007bff',
    marginTop: '-10px',
    marginBottom: '20px',
    wordBreak: 'break-all',
  },
  formGroup: {
    marginBottom: '15px',
    display: 'flex',
    flexDirection: 'column',
  },
  label: {
    fontWeight: 'bold',
    marginBottom: '5px',
    fontSize: '0.9em',
  },
  input: {
    width: '100%',
    padding: '8px 10px',
    border: '1px solid #ccc',
    borderRadius: '4px',
    boxSizing: 'border-box',
  },
  errorText: {
    color: '#D8000C',
    backgroundColor: '#FFD2D2',
    padding: '10px',
    borderRadius: '4px',
    marginBottom: '15px',
  },
  buttonGroup: {
    marginTop: '20px',
    textAlign: 'right',
    borderTop: '1px solid #eee',
    paddingTop: '15px',
  },
  button: {
    padding: '8px 15px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontWeight: 'bold',
    marginLeft: '10px',
  },
  submitButton: {
    backgroundColor: '#ffc107', // Warning/Yellow
    color: '#333',
  },
  cancelButton: {
    backgroundColor: '#f0f0f0',
    color: '#333',
    border: '1px solid #ccc',
  }
};

export default ResetPasswordModal;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\SetRoleModal.js
================================================================================
// frontend/src/components/SetRoleModal.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { motion } from 'framer-motion'; // <-- Thêm import

const ROLES = ["Admin", "HR Manager", "Payroll Manager", "Employee"];

const SetRoleModal = ({ isOpen, onClose, onSuccess, userData }) => {
  const [selectedRole, setSelectedRole] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  useEffect(() => {
    if (userData) {
      setSelectedRole(userData.role);
      setError('');
    }
  }, [userData]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!selectedRole) {
      setError('Vui lòng chọn một vai trò.');
      return;
    }
    setLoading(true);
    setError('');
    try {
      await api.put(`/users/${userData.id}/role`, { role: selectedRole });
      onSuccess();
    } catch (err) {
      setError(err.response?.data?.detail || 'Cập nhật vai trò thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen || !userData) return null;

  return (
    <motion.div
      style={styles.overlay}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      onClick={onClose}
    >
      <motion.div
        style={styles.modal}
        initial={{ opacity: 0, scale: 0.9, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.9, y: -20 }}
        transition={{ duration: 0.2 }}
        onClick={(e) => e.stopPropagation()}
      >
        <h2 style={styles.header}>Đặt vai trò cho:</h2>
        <p style={styles.emailText}>{userData.email}</p>
        
        {error && <p style={styles.errorText}>{error}</p>}
        
        <form onSubmit={handleSubmit}>
          <div style={styles.formGroup}>
            <label style={styles.label}>Vai trò mới:</label>
            <select
              value={selectedRole}
              onChange={(e) => setSelectedRole(e.target.value)}
              disabled={loading}
              required
              style={styles.input}
            >
              {ROLES.map(role => (
                <option key={role} value={role}>{role}</option>
              ))}
            </select>
          </div>
          <div style={styles.buttonGroup}>
            <button type="button" onClick={onClose} disabled={loading} style={{...styles.button, ...styles.cancelButton}}>
              Hủy
            </button>
            <button type="submit" disabled={loading} style={{...styles.button, ...styles.submitButton}}>
              {loading ? 'Đang lưu...' : 'Lưu thay đổi'}
            </button>
          </div>
        </form>
      </motion.div>
    </motion.div>
  );
};

// --- STYLES ---
const styles = {
  overlay: {
    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
    justifyContent: 'center', alignItems: 'center', zIndex: 1000,
  },
  modal: {
    backgroundColor: '#fff', padding: '20px 25px', borderRadius: '8px',
    width: '100%', maxWidth: '450px',
    boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
  },
  header: {
    marginTop: 0,
    marginBottom: '5px',
  },
  emailText: {
    fontSize: '1.1em',
    fontWeight: 'bold',
    color: '#007bff',
    marginTop: '-10px',
    marginBottom: '20px',
    wordBreak: 'break-all',
  },
  formGroup: {
    marginBottom: '15px',
    display: 'flex',
    flexDirection: 'column',
  },
  label: {
    fontWeight: 'bold',
    marginBottom: '5px',
    fontSize: '0.9em',
  },
  input: {
    width: '100%',
    padding: '8px 10px',
    border: '1px solid #ccc',
    borderRadius: '4px',
    boxSizing: 'border-box',
    background: '#fff',
  },
  errorText: {
    color: '#D8000C',
    backgroundColor: '#FFD2D2',
    padding: '10px',
    borderRadius: '4px',
    marginBottom: '15px',
  },
  buttonGroup: {
    marginTop: '20px',
    textAlign: 'right',
    borderTop: '1px solid #eee',
    paddingTop: '15px',
  },
  button: {
    padding: '8px 15px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontWeight: 'bold',
    marginLeft: '10px',
  },
  submitButton: {
    backgroundColor: '#007bff', // Blue
    color: 'white',
  },
  cancelButton: {
    backgroundColor: '#f0f0f0',
    color: '#333',
    border: '1px solid #ccc',
  }
};

export default SetRoleModal;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\charts\AvgSalaryChart.js
================================================================================
// frontend/src/components/charts/AvgSalaryChart.js
import React from 'react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

const AvgSalaryChart = ({ data, barColor, textColor }) => {
  // [FIX] Dữ liệu nhận vào là Mảng [{name: '...', value: ...}]
  // Không cần chuyển đổi Object.keys nữa
  
  const formatYAxis = (tickItem) => {
    if (tickItem >= 1000000) return `${tickItem / 1000000}M`;
    if (tickItem >= 1000) return `${tickItem / 1000}k`;
    return tickItem;
  };

  return (
    <div style={{ height: 300 }}>
      <h4 style={{textAlign:'center', color: textColor || '#888', marginBottom:'15px'}}>
        Lương trung bình theo Phòng ban
      </h4>
      <ResponsiveContainer width="100%" height="100%">
        <AreaChart
          data={data} // Truyền trực tiếp data
          margin={{ top: 10, right: 30, left: 0, bottom: 0 }}
        >
          <defs>
            <linearGradient id="colorSalary" x1="0" y1="0" x2="0" y2="1">
              <stop offset="5%" stopColor={barColor || "#8884d8"} stopOpacity={0.8}/>
              <stop offset="95%" stopColor={barColor || "#8884d8"} stopOpacity={0}/>
            </linearGradient>
          </defs>
          <CartesianGrid strokeDasharray="3 3" stroke="#444" vertical={false} />
          <XAxis 
            dataKey="name" 
            stroke={textColor || "#ccc"} 
            tick={{fontSize: 11}} 
            interval={0}
            angle={-15}  
            textAnchor="end"
            height={50}
          />
          <YAxis 
            stroke={textColor || "#ccc"} 
            tickFormatter={formatYAxis}
            width={40}
            tick={{fontSize: 12}}
          />
          <Tooltip 
            contentStyle={{backgroundColor: '#333', border: '1px solid #555', color: '#fff'}}
            formatter={(value) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value)}
            labelStyle={{color: '#ccc'}}
          />
          <Area 
            type="monotone" 
            dataKey="value" 
            stroke={barColor || "#8884d8"} 
            fillOpacity={1} 
            fill="url(#colorSalary)" 
            name="Lương TB"
          />
        </AreaChart>
      </ResponsiveContainer>
    </div>
  );
};

export default AvgSalaryChart;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\charts\CostStructureChart.js
================================================================================
// frontend/src/components/charts/CostStructureChart.js
import React from 'react';
import { PieChart, Pie, Cell, Tooltip, Legend, ResponsiveContainer } from 'recharts';

const CostStructureChart = ({ salary, bonus, dividend }) => {
  const data = [
    { name: 'Lương CB', value: salary },
    { name: 'Thưởng', value: bonus },
    { name: 'Cổ tức', value: dividend },
  ];

  // Màu sắc: Lương (Xanh), Cổ tức (Tím), Thưởng (Vàng)
  const COLORS = ['#0088FE', '#8884d8', '#FFBB28'];

  // [FIX] Định nghĩa hàm này và SỬ DỤNG nó trong Tooltip bên dưới
  const formatCurrency = (value) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);

  return (
    <div style={{ height: 300 }}>
      <h4 style={{textAlign:'center', color:'var(--text-color)', marginBottom:'10px'}}>Tỷ lệ Chi phí Nhân sự</h4>
      <ResponsiveContainer width="100%" height="100%">
        <PieChart>
          <Pie
            data={data}
            cx="50%" cy="50%"
            innerRadius={60}
            outerRadius={80}
            paddingAngle={5}
            dataKey="value"
          >
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
            ))}
          </Pie>
          {/* [FIX] Gọi hàm formatCurrency tại đây */}
          <Tooltip formatter={(val) => formatCurrency(val)} />
          <Legend />
        </PieChart>
      </ResponsiveContainer>
    </div>
  );
};

export default CostStructureChart;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\charts\EmployeeDeptChart.js
================================================================================
// frontend/src/components/charts/EmployeeDeptChart.js
import React from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from 'recharts';

const EmployeeDeptChart = ({ data, barColor, textColor }) => {
  const chartData = Array.isArray(data) ? data : Object.keys(data).map(key => ({
    name: key,
    value: data[key]
  }));

  return (
    <div style={{ height: 300 }}>
      <h4 style={{textAlign:'center', color: textColor || '#888', marginBottom:'15px'}}>
        Phân phối Nhân viên
      </h4>
      <ResponsiveContainer width="100%" height="100%">
        <LineChart
          data={chartData}
          margin={{ top: 5, right: 30, left: 20, bottom: 5 }}
        >
          <CartesianGrid strokeDasharray="3 3" stroke="#444" vertical={false} />
          <XAxis 
            dataKey="name" 
            stroke={textColor || "#ccc"}
            tick={{fontSize: 12}}
            angle={-45}
            textAnchor="end"
            height={60} 
          />
          <YAxis stroke={textColor || "#ccc"} allowDecimals={false} />
          <Tooltip 
            contentStyle={{backgroundColor: '#333', border: '1px solid #555', color: '#fff'}}
            labelStyle={{color: '#ccc'}}
          />
          <Legend />
          <Line 
            type="monotone" 
            dataKey="value" 
            name="Số lượng"
            stroke={barColor || "#82ca9d"} 
            strokeWidth={3}
            activeDot={{ r: 8 }} 
            dot={{r: 4}}
          />
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
};

export default EmployeeDeptChart;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\charts\SalaryTrendChart.js
================================================================================
import React from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';

const SalaryTrendChart = ({ data }) => {
  // Định dạng tiền tệ cho trục Y và Tooltip
  const formatCurrency = (value) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND', maximumSignificantDigits: 3 }).format(value);

  return (
    <div style={{ height: 300 }}>
      <h4 style={{textAlign:'center', color:'var(--text-color-secondary)', marginBottom:'10px'}}>Xu hướng Quỹ lương (6 tháng)</h4>
      <ResponsiveContainer width="100%" height="100%">
        <LineChart
          data={data}
          margin={{ top: 5, right: 30, left: 20, bottom: 5 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="name" />
          <YAxis tickFormatter={(value) => new Intl.NumberFormat('vi-VN', { notation: "compact", compactDisplay: "short" }).format(value)}/>
          <Tooltip formatter={(value) => formatCurrency(value)} contentStyle={{backgroundColor:'var(--card-bg)', borderColor:'var(--border-color)', color:'var(--text-color)'}}/>
          <Legend />
          <Line type="monotone" dataKey="value" name="Tổng lương" stroke="#8884d8" activeDot={{ r: 8 }} strokeWidth={2} />
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
};

export default SalaryTrendChart;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\components\charts\StatusChart.js
================================================================================
// frontend/src/components/charts/StatusChart.js
import React from 'react';
import { PieChart, Pie, Cell, Tooltip, Legend, ResponsiveContainer } from 'recharts';

const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];

const StatusChart = ({ data }) => {
  if (!data || data.length === 0) return <div style={{textAlign:'center', paddingTop:'50px'}}>Chưa có dữ liệu</div>;

  return (
    <div style={{ height: 300 }}>
      <h4 style={{textAlign:'center', color:'var(--text-color-secondary)', marginBottom:'10px'}}>Trạng thái Nhân viên</h4>
      <ResponsiveContainer width="100%" height="100%">
        <PieChart>
          <Pie
            data={data}
            cx="50%" cy="50%"
            innerRadius={60} outerRadius={80}
            fill="#8884d8"
            paddingAngle={5}
            dataKey="value"
            label
          >
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
            ))}
          </Pie>
          <Tooltip contentStyle={{backgroundColor:'var(--card-bg)', borderColor:'var(--border-color)', color:'var(--text-color)'}} />
          <Legend />
        </PieChart>
      </ResponsiveContainer>
    </div>
  );
};
export default StatusChart;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\context\AuthContext.js
================================================================================
import React, { createContext, useState, useContext } from 'react';
import * as authService from '../services/authService';

const AuthContext = createContext(null);

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(authService.getCurrentUser());

  const handleLogin = async (email, password) => {
    try {
      const loggedInUser = await authService.login(email, password);
      setUser(loggedInUser);
      return loggedInUser;
    } catch (error) {
      setUser(null);
      throw error;
    }
  };

  const handleLogout = () => {
    authService.logout();
    setUser(null);
  };

  const value = {
    user,
    login: handleLogin,
    logout: handleLogout,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};

export const useAuth = () => {
  return useContext(AuthContext);
};

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\AdminManagement.js
================================================================================
// frontend/src/pages/AdminManagement.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { motion, AnimatePresence } from 'framer-motion';
import { toast } from 'react-toastify';

import DepartmentModal from '../components/DepartmentModal';
import PositionModal from '../components/PositionModal';

// --- Skeleton Row ---
const SkeletonRow = ({ columns }) => (
    <tr>
        {Array.from({ length: columns }).map((_, index) => (
            <td key={index} style={styles.tableCell}>
                <div style={styles.skeletonCell}></div>
            </td>
        ))}
    </tr>
);

function AdminManagement() {
    // State cho Phòng ban
    const [departments, setDepartments] = useState([]);
    const [loadingDepts, setLoadingDepts] = useState(true);
    const [isDeptModalOpen, setIsDeptModalOpen] = useState(false);
    const [currentDept, setCurrentDept] = useState(null);
    const [deptSearch, setDeptSearch] = useState('');

    // State cho Chức vụ
    const [positions, setPositions] = useState([]);
    const [loadingPos, setLoadingPos] = useState(true);
    const [isPosModalOpen, setIsPosModalOpen] = useState(false);
    const [currentPos, setCurrentPos] = useState(null);
    const [posSearch, setPosSearch] = useState('');

    const { user } = useAuth();
    // Chỉ Admin và HR Manager được quyền sửa đổi
    const canEdit = user?.role === 'Admin' || user?.role === 'HR Manager';
    
    // --- FETCH DATA ---
    const fetchDepartments = async () => {
        setLoadingDepts(true);
        try {
            const response = await api.get('/departments/');
            setDepartments(response.data);
        } catch (error) {
            toast.error('Không thể tải danh sách phòng ban.');
        }
        setLoadingDepts(false);
    };

    const fetchPositions = async () => {
        setLoadingPos(true);
        try {
            const response = await api.get('/positions/');
            setPositions(response.data);
        } catch (error) {
            toast.error('Không thể tải danh sách chức vụ.');
        }
        setLoadingPos(false);
    };

    useEffect(() => {
        fetchDepartments();
        fetchPositions();
    }, []);

    // --- HANDLERS: DEPARTMENT ---
    const handleOpenDeptModal = (dept = null) => { setCurrentDept(dept); setIsDeptModalOpen(true); };
    const handleCloseDeptModal = () => { setIsDeptModalOpen(false); setCurrentDept(null); };
    
    const handleDeptSuccess = () => {
        handleCloseDeptModal();
        toast.success(currentDept ? "Cập nhật phòng ban thành công!" : "Thêm phòng ban mới thành công!");
        fetchDepartments();
    };

    const handleDeleteDept = async (deptId, deptName) => {
        if (window.confirm(`[CẢNH BÁO] Bạn có chắc muốn xóa phòng ban "${deptName}"?\nHệ thống sẽ kiểm tra xem còn nhân viên nào thuộc phòng này không.`)) {
            try {
                await api.delete(`/departments/${deptId}`);
                toast.success("Đã xóa phòng ban và ghi nhật ký hệ thống.");
                fetchDepartments();
            } catch (err) {
                // Hiển thị lỗi ràng buộc dữ liệu từ Backend trả về
                const errorMsg = err.response?.data?.detail || 'Không thể xóa phòng ban này.';
                toast.error(`Lỗi: ${errorMsg}`);
            }
        }
    };

    // --- HANDLERS: POSITION ---
    const handleOpenPosModal = (pos = null) => { setCurrentPos(pos); setIsPosModalOpen(true); };
    const handleClosePosModal = () => { setIsPosModalOpen(false); setCurrentPos(null); };
    
    const handlePosSuccess = () => {
        handleClosePosModal();
        toast.success(currentPos ? "Cập nhật chức vụ thành công!" : "Thêm chức vụ mới thành công!");
        fetchPositions();
    };

    const handleDeletePos = async (posId, posName) => {
        if (window.confirm(`[CẢNH BÁO] Bạn có chắc muốn xóa chức vụ "${posName}"?\nHệ thống sẽ kiểm tra xem còn nhân viên nào giữ chức vụ này không.`)) {
            try {
                await api.delete(`/positions/${posId}`);
                toast.success("Đã xóa chức vụ và ghi nhật ký hệ thống.");
                fetchPositions();
            } catch (err) {
                const errorMsg = err.response?.data?.detail || 'Không thể xóa chức vụ này.';
                toast.error(`Lỗi: ${errorMsg}`);
            }
        }
    };

    // Filtering
    const filteredDepartments = departments.filter(dept =>
        dept.DepartmentName.toLowerCase().includes(deptSearch.toLowerCase())
    );
    const filteredPositions = positions.filter(pos =>
        pos.PositionName.toLowerCase().includes(posSearch.toLowerCase())
    );

    return (
        <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            style={{ padding: '20px', color: 'var(--text-color)' }}
        >
            <h2 style={{ color: 'var(--text-color)', marginBottom: '20px' }}>Quản lý Cơ cấu Tổ chức</h2>
            
            <div style={styles.container}>
                
                {/* === KHỐI 1: QUẢN LÝ PHÒNG BAN === */}
                <div style={styles.section}>
                    <div style={styles.sectionHeader}>
                        <h3 style={{ margin: 0, display:'flex', alignItems:'center', gap:'10px' }}>
                            🏢 Phòng ban
                        </h3>
                        {canEdit && (
                            <button onClick={() => handleOpenDeptModal(null)} style={styles.addButton}>
                                + Thêm mới
                            </button>
                        )}
                    </div>

                    <input
                        type="text"
                        placeholder="🔍 Tìm phòng ban..."
                        value={deptSearch}
                        onChange={(e) => setDeptSearch(e.target.value)}
                        style={styles.searchBox}
                    />
                    
                    <div style={styles.tableContainer}>
                        <table style={styles.table}>
                            <thead>
                                <tr>
                                    <th style={styles.th}>ID</th>
                                    <th style={styles.th}>Tên Phòng ban</th>
                                    {canEdit && <th style={{width: '120px', ...styles.th}}>Hành động</th>}
                                </tr>
                            </thead>
                            <tbody>
                                {loadingDepts ? (
                                    Array.from({ length: 5 }).map((_, i) => <SkeletonRow key={i} columns={canEdit ? 3 : 2} />)
                                ) : filteredDepartments.length > 0 ? (
                                    filteredDepartments.map(dept => (
                                        <tr key={dept.DepartmentID}>
                                            <td style={styles.tableCell}><strong>{dept.DepartmentID}</strong></td>
                                            <td style={styles.tableCell}>{dept.DepartmentName}</td>
                                            {canEdit && (
                                                <td style={styles.tableCell}>
                                                    <button onClick={() => handleOpenDeptModal(dept)} className="action-button edit-button" title="Sửa">✏️</button>
                                                    <button onClick={() => handleDeleteDept(dept.DepartmentID, dept.DepartmentName)} className="action-button delete-button" title="Xóa">🗑️</button>
                                                </td>
                                            )}
                                        </tr>
                                    ))
                                ) : (
                                    <tr><td colSpan={canEdit ? 3 : 2} style={styles.emptyCell}>Không tìm thấy dữ liệu.</td></tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>

                {/* === KHỐI 2: QUẢN LÝ CHỨC VỤ === */}
                <div style={styles.section}>
                    <div style={styles.sectionHeader}>
                        <h3 style={{ margin: 0, display:'flex', alignItems:'center', gap:'10px' }}>
                            💼 Chức vụ
                        </h3>
                        {canEdit && (
                            <button onClick={() => handleOpenPosModal(null)} style={styles.addButton}>
                                + Thêm mới
                            </button>
                        )}
                    </div>

                    <input
                        type="text"
                        placeholder="🔍 Tìm chức vụ..."
                        value={posSearch}
                        onChange={(e) => setPosSearch(e.target.value)}
                        style={styles.searchBox}
                    />

                    <div style={styles.tableContainer}>
                        <table style={styles.table}>
                            <thead>
                                <tr>
                                    <th style={styles.th}>ID</th>
                                    <th style={styles.th}>Tên Chức vụ</th>
                                    {canEdit && <th style={{width: '120px', ...styles.th}}>Hành động</th>}
                                </tr>
                            </thead>
                            <tbody>
                                {loadingPos ? (
                                    Array.from({ length: 5 }).map((_, i) => <SkeletonRow key={i} columns={canEdit ? 3 : 2} />)
                                ) : filteredPositions.length > 0 ? (
                                    filteredPositions.map(pos => (
                                        <tr key={pos.PositionID}>
                                            <td style={styles.tableCell}><strong>{pos.PositionID}</strong></td>
                                            <td style={styles.tableCell}>{pos.PositionName}</td>
                                            {canEdit && (
                                                <td style={styles.tableCell}>
                                                    <button onClick={() => handleOpenPosModal(pos)} className="action-button edit-button" title="Sửa">✏️</button>
                                                    <button onClick={() => handleDeletePos(pos.PositionID, pos.PositionName)} className="action-button delete-button" title="Xóa">🗑️</button>
                                                </td>
                                            )}
                                        </tr>
                                    ))
                                ) : (
                                    <tr><td colSpan={canEdit ? 3 : 2} style={styles.emptyCell}>Không tìm thấy dữ liệu.</td></tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>

                {/* === MODALS === */}
                <AnimatePresence>
                    {isDeptModalOpen && (
                        <DepartmentModal
                            isOpen={isDeptModalOpen}
                            onClose={handleCloseDeptModal}
                            onSuccess={handleDeptSuccess}
                            departmentData={currentDept}
                        />
                    )}
                    {isPosModalOpen && (
                        <PositionModal
                            isOpen={isPosModalOpen}
                            onClose={handleClosePosModal}
                            onSuccess={handlePosSuccess}
                            positionData={currentPos}
                        />
                    )}
                </AnimatePresence>
            </div>
        </motion.div>
    );
}

// --- STYLES ---
const styles = {
    container: {
        display: 'flex',
        flexWrap: 'wrap',
        gap: '25px', // Tăng khoảng cách giữa 2 cột
    },
    section: {
        flex: 1,
        minWidth: '450px', // Đảm bảo không bị quá nhỏ trên màn hình bé
        backgroundColor: 'var(--card-bg)',
        border: '1px solid var(--border-color)',
        padding: '20px',
        borderRadius: '10px', // Bo góc mềm mại hơn
        boxShadow: '0 4px 6px rgba(0,0,0,0.02)',
    },
    sectionHeader: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        borderBottom: '1px solid var(--border-color)',
        paddingBottom: '15px',
        marginBottom: '20px',
    },
    addButton: {
        padding: '8px 15px',
        cursor: 'pointer',
        backgroundColor: '#0d6efd', // Màu xanh chuẩn bootstrap
        color: 'white',
        border: 'none',
        borderRadius: '6px',
        fontSize: '0.9em',
        fontWeight: '600',
        transition: 'background 0.2s',
        boxShadow: '0 2px 4px rgba(13, 110, 253, 0.2)'
    },
    searchBox: {
        marginBottom: '15px',
        padding: '10px 12px',
        width: '100%',
        border: '1px solid var(--input-border-color)',
        backgroundColor: 'var(--input-bg)',
        color: 'var(--text-color)',
        borderRadius: '6px',
        boxSizing: 'border-box',
        transition: 'border-color 0.2s',
    },
    tableContainer: {
        overflowX: 'auto',
        borderRadius: '6px',
        border: '1px solid var(--border-color)', // Viền bao quanh bảng
    },
    table: {
        width: '100%',
        borderCollapse: 'collapse',
        fontSize: '0.95em',
    },
    th: {
        padding: '12px 15px',
        borderBottom: '2px solid var(--border-color)',
        backgroundColor: 'var(--table-header-bg)',
        color: 'var(--text-color)',
        textAlign: 'left',
        fontWeight: '600',
        whiteSpace: 'nowrap',
    },
    tableCell: {
        padding: '12px 15px',
        borderBottom: '1px solid var(--table-row-border-color)',
        verticalAlign: 'middle',
        color: 'var(--text-color)',
    },
    emptyCell: {
        textAlign: 'center',
        padding: '30px',
        color: 'var(--text-color-secondary)',
        fontStyle: 'italic',
    },
    skeletonCell: {
        height: '20px',
        backgroundColor: '#e0e0e0',
        borderRadius: '4px',
        animation: 'pulse 1.5s infinite ease-in-out',
    }
};

export default AdminManagement;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\Dashboard.js
================================================================================
// frontend/src/pages/Dashboard.js
import React, { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { motion } from 'framer-motion';
import { toast } from 'react-toastify';

// Charts
import EmployeeDeptChart from '../components/charts/EmployeeDeptChart';
import AvgSalaryChart from '../components/charts/AvgSalaryChart';
import StatusChart from '../components/charts/StatusChart';
import SalaryTrendChart from '../components/charts/SalaryTrendChart';

// --- Icons ---
const UserIcon = () => <span>👥</span>;
const MoneyIcon = () => <span>💰</span>;
const DividendIcon = () => <span>💎</span>;
const AlertIcon = () => <span>🔔</span>;

// Skeleton Loading
const SkeletonCard = () => <div style={{background:'#e0e0e0', height:'120px', borderRadius:'8px', animation:'pulse 1.5s infinite'}}></div>;
const SkeletonChart = () => <div style={{background:'#e0e0e0', height:'350px', borderRadius:'8px', animation:'pulse 1.5s infinite'}}></div>;

function Dashboard() {
    const { user } = useAuth();
    const [data, setData] = useState(null);
    const [alerts, setAlerts] = useState([]);
    const [loading, setLoading] = useState(true);
    const isDarkMode = document.body.classList.contains('theme-dark');

    useEffect(() => {
        const fetchDashboardData = async () => {
            setLoading(true);
            try {
                const summaryRes = await api.get('/reports/dashboard-summary');
                setData(summaryRes.data);
                
                const alertRes = await api.get('/notifications/', { params: { limit: 5 } });
                setAlerts(alertRes.data);
            } catch (err) {
                console.error("Dashboard Error:", err);
            } finally {
                setLoading(false);
            }
        };
        fetchDashboardData();
    }, []);

    const barColor1 = isDarkMode ? '#6A7FAB' : '#8884d8';
    const barColor2 = isDarkMode ? '#77BFA3' : '#82ca9d';
    const textColor = isDarkMode ? '#a0a0a0' : '#666';

    const fmtMoney = (val) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(val);

    if (loading) {
        return (
            <div style={{padding:'20px'}}>
                <div style={{marginBottom:'20px'}}><SkeletonCard /></div>
                <div style={{display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'20px'}}>
                    <SkeletonCard /><SkeletonCard /><SkeletonCard />
                </div>
                 <div style={{marginTop:'20px', display:'grid', gridTemplateColumns:'1fr 1fr', gap:'20px'}}>
                    <SkeletonChart /><SkeletonChart />
                </div>
            </div>
        );
    }

    if (!data) return <div style={{padding:'20px', textAlign:'center'}}>Không có dữ liệu.</div>;

    // Destructure an toàn
    const { 
        hr_metrics = {}, 
        payroll_metrics = {}, 
        financial_metrics = {} 
    } = data || {};

    // [FIX] Đảm bảo dữ liệu luôn là mảng (Array) và KHÔNG dùng .reduce() khi truyền vào chart
    const deptData = hr_metrics?.department_distribution || [];
    const salaryData = payroll_metrics?.avg_salary_by_dept || [];
    const statusData = hr_metrics?.status_distribution || [];
    const trendData = payroll_metrics?.salary_trend || [];

    return (
        <motion.div 
            initial={{ opacity: 0 }} animate={{ opacity: 1 }} 
            style={{ padding: '20px', color: 'var(--text-color)' }}
        >
            <div style={styles.welcomeMessage}>
                 <h2 style={{ color: 'var(--text-color)', margin: 0 }}>Chào mừng quay trở lại, {user?.email}!</h2>
                 <p style={{ color: 'var(--text-color-secondary)', marginTop: '5px' }}>Tổng quan hệ thống nhân sự và lương.</p>
            </div>

            {/* 1. KEY METRICS CARDS */}
            <div style={styles.gridCards}>
                <Link to="/employees" style={{ textDecoration: 'none' }}>
                    <div style={styles.card}>
                        <div style={styles.cardIcon}><UserIcon /></div>
                        <div>
                            <div style={styles.cardTitle}>Tổng Nhân sự</div>
                            <div style={styles.cardValue}>{hr_metrics?.total_employees || 0}</div>
                            <div style={styles.cardSub}>{hr_metrics?.shareholder_count || 0} là Cổ đông</div>
                        </div>
                    </div>
                </Link>

                <Link to="/payroll" style={{ textDecoration: 'none' }}>
                    <div style={styles.card}>
                        <div style={{...styles.cardIcon, background:'#e6f7ff', color:'#1890ff'}}><MoneyIcon /></div>
                        <div>
                            <div style={styles.cardTitle}>Quỹ Lương (Tháng này)</div>
                            <div style={styles.cardValue}>{fmtMoney(payroll_metrics?.total_salary_budget || 0)}</div>
                            <div style={styles.cardSub}>Dữ liệu từ PAYROLL</div>
                        </div>
                    </div>
                </Link>

                <Link to="/shareholders" style={{ textDecoration: 'none' }}>
                    <div style={styles.card}>
                        <div style={{...styles.cardIcon, background:'#f9f0ff', color:'#722ed1'}}><DividendIcon /></div>
                        <div>
                            <div style={styles.cardTitle}>Tổng Cổ tức đã chi</div>
                            <div style={styles.cardValue}>{fmtMoney(financial_metrics?.total_dividends || 0)}</div>
                            <div style={styles.cardSub}>Dữ liệu từ HUMAN_2025</div>
                        </div>
                    </div>
                </Link>
            </div>

            {/* 2. CHARTS & ANALYSIS */}
            <div style={styles.gridCharts}>
                {/* Biểu đồ Xu hướng lương (Full width) */}
                {trendData.length > 0 && (
                    <div style={{...styles.chartCard, gridColumn: '1 / -1'}}> 
                        <SalaryTrendChart data={trendData} />
                    </div>
                )}

                <div style={styles.chartCard}>
                    {/* [FIX] Truyền trực tiếp mảng deptData */}
                    <EmployeeDeptChart 
                        data={deptData} 
                        barColor={barColor1} 
                        textColor={textColor}
                    />
                </div>

                <div style={styles.chartCard}>
                    {/* [FIX] Truyền trực tiếp mảng salaryData -> Sửa lỗi biểu đồ trắng */}
                    <AvgSalaryChart 
                        data={salaryData} 
                        barColor={barColor2} 
                        textColor={textColor}
                    />
                </div>

                <div style={styles.chartCard}>
                    <StatusChart data={statusData} />
                </div>
            </div>

            {/* 3. ALERTS CENTER */}
            <div style={{marginTop: '30px'}}>
                <h3 style={{display:'flex', alignItems:'center', gap:'10px', color:'var(--text-color)'}}>
                    <AlertIcon /> Trung tâm Cảnh báo & Sự kiện
                </h3>
                <div style={styles.alertContainer}>
                    {alerts.length > 0 ? alerts.map(alert => (
                        <div key={alert.id} style={styles.alertItem}>
                            <div style={{fontWeight:'bold', color: getAlertColor(alert.type)}}>{getAlertTitle(alert.type)}</div>
                            <div style={{color:'var(--text-color)'}}>{alert.message}</div>
                            <div style={{fontSize:'0.8em', color:'var(--text-color-secondary)', marginTop:'5px'}}>
                                {new Date(alert.created_at).toLocaleString()}
                            </div>
                        </div>
                    )) : (
                        <div style={{padding:'20px', textAlign:'center', color:'var(--text-color-secondary)'}}>Không có cảnh báo mới.</div>
                    )}
                </div>
            </div>
        </motion.div>
    );
}

// Helpers
const getAlertColor = (type) => {
    if (type === 'leave_warning' || type === 'salary_alert') return '#ff4d4f';
    if (type && type.includes('anniversary')) return '#faad14';
    return '#1890ff';
};

const getAlertTitle = (type) => {
    if (type === 'leave_warning') return '⚠️ Cảnh báo Nghỉ phép';
    if (type === 'salary_alert') return '💰 Cảnh báo Lương';
    if (type && type.includes('anniversary')) return '🎉 Sự kiện Nhân sự';
    return 'Thông báo';
};

const styles = {
    welcomeMessage: { marginBottom: '25px', borderBottom: '1px solid var(--border-color)', paddingBottom: '15px' },
    gridCards: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '20px', marginBottom: '30px' },
    card: { background: 'var(--card-bg)', padding: '20px', borderRadius: '10px', boxShadow: '0 4px 12px rgba(0,0,0,0.05)', display: 'flex', alignItems: 'center', gap: '20px', border: '1px solid var(--border-color)', transition: 'transform 0.2s', cursor: 'pointer' },
    cardIcon: { width: '50px', height: '50px', borderRadius: '12px', background: '#e6fffb', color: '#13c2c2', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '1.5rem' },
    cardTitle: { color: 'var(--text-color-secondary)', fontSize: '0.9rem', fontWeight: '600' },
    cardValue: { fontSize: '1.6rem', fontWeight: 'bold', color: 'var(--text-color)', margin: '5px 0' },
    cardSub: { fontSize: '0.8rem', color: 'var(--text-color-secondary)' },
    
    gridCharts: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(350px, 1fr))', gap: '20px' },
    chartCard: { background: 'var(--card-bg)', padding: '20px', borderRadius: '10px', border: '1px solid var(--border-color)', height: '350px', boxShadow: '0 2px 8px rgba(0,0,0,0.03)' },
    
    alertContainer: { background: 'var(--card-bg)', borderRadius: '10px', border: '1px solid var(--border-color)', overflow: 'hidden', boxShadow: '0 2px 8px rgba(0,0,0,0.03)' },
    alertItem: { padding: '15px', borderBottom: '1px solid var(--border-color)', borderLeft: '4px solid transparent', transition: '0.2s' },
};

export default Dashboard;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\Departments.js
================================================================================
// frontend/src/pages/Departments.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';

// Component Modal dùng chung cho Thêm/Sửa
const DepartmentModal = ({ isOpen, onClose, onSuccess, departmentData }) => {
  const [name, setName] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const isEditMode = !!departmentData;

  useEffect(() => {
    setName(isEditMode ? departmentData.DepartmentName : '');
    setError('');
  }, [isOpen, departmentData, isEditMode]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!name.trim()) { setError('Tên phòng ban không được để trống.'); return; }
    setLoading(true); setError('');
    try {
      if (isEditMode) {
        await api.put(`/departments/${departmentData.DepartmentID}`, { DepartmentName: name });
      } else {
        await api.post('/departments/', { DepartmentName: name });
      }
      onSuccess();
    } catch (err) {
      setError(err.response?.data?.detail || 'Lưu thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div style={styles.overlay}>
      <div style={styles.modal}>
        <h2>{isEditMode ? 'Sửa Phòng ban' : 'Thêm Phòng ban mới'}</h2>
        {error && <p style={{ color: 'red' }}>{error}</p>}
        <form onSubmit={handleSubmit}>
          <div style={styles.formGroup}>
            <label>Tên Phòng ban:</label>
            <input type="text" value={name} onChange={(e) => setName(e.target.value)} disabled={loading} style={{ width: '95%', padding: '8px' }} required />
          </div>
          <div style={styles.buttonGroup}>
            <button type="submit" disabled={loading}>{loading ? 'Đang lưu...' : (isEditMode ? 'Lưu thay đổi' : 'Thêm mới')}</button>
            <button type="button" onClick={onClose} disabled={loading} style={{ marginLeft: '10px' }}>Hủy</button>
          </div>
        </form>
      </div>
    </div>
  );
};

// Component trang chính
function Departments() {
  const [departments, setDepartments] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const { user } = useAuth();
  const isAdmin = user?.role === 'Admin';

  const [isModalOpen, setIsModalOpen] = useState(false);
  const [currentItem, setCurrentItem] = useState(null);

  const fetchData = async () => {
    setLoading(true); setError('');
    try {
      const response = await api.get('/departments/');
      setDepartments(response.data);
    } catch (err) {
      setError('Không thể tải danh sách phòng ban.');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => { fetchData(); }, []);

  const handleOpenModal = (dept = null) => { setCurrentItem(dept); setIsModalOpen(true); };
  const handleCloseModal = () => { setIsModalOpen(false); setCurrentItem(null); };
  const handleSuccess = () => { handleCloseModal(); fetchData(); };

  const handleDelete = async (deptId, deptName) => {
    if (window.confirm(`Bạn có chắc muốn xóa phòng ban "${deptName}" không?`)) {
      setError('');
      try {
        await api.delete(`/departments/${deptId}`);
        fetchData();
      } catch (err) {
        setError(err.response?.data?.detail || 'Xóa thất bại. Phòng ban có thể đang được gán cho nhân viên.');
      }
    }
  };

  if (loading && departments.length === 0) return <p>Đang tải...</p>;

  return (
    <div>
      <h2>Quản lý Phòng ban</h2>
      {error && <p style={{ color: 'red', border: '1px solid red', padding: '10px' }}>{error}</p>}
      {isAdmin && <button onClick={() => handleOpenModal(null)} style={{ margin: '10px 0' }}>Thêm Phòng ban mới</button>}
      <table border="1" cellPadding="10" style={{ width: '100%', borderCollapse: 'collapse' }}>
        <thead>
          <tr>
            <th>ID</th>
            <th>Tên Phòng ban</th>
            {isAdmin && <th>Hành động</th>}
          </tr>
        </thead>
        <tbody>
          {departments.map(dept => (
            <tr key={dept.DepartmentID}>
              <td>{dept.DepartmentID}</td>
              <td>{dept.DepartmentName}</td>
              {isAdmin && (
                <td>
                  <button onClick={() => handleOpenModal(dept)} style={{ marginRight: '5px' }}>Sửa</button>
                  <button onClick={() => handleDelete(dept.DepartmentID, dept.DepartmentName)} style={{ color: 'red' }}>Xóa</button>
                </td>
              )}
            </tr>
          ))}
          {departments.length === 0 && !loading && (
             <tr><td colSpan={isAdmin ? 3 : 2} style={{textAlign: 'center'}}>Không có phòng ban nào.</td></tr>
          )}
        </tbody>
      </table>
      <DepartmentModal isOpen={isModalOpen} onClose={handleCloseModal} onSuccess={handleSuccess} departmentData={currentItem} />
    </div>
  );
}

const styles = {
  overlay: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 1000 },
  modal: { backgroundColor: '#fff', padding: '25px', borderRadius: '8px', minWidth: '400px', boxShadow: '0 4px 10px rgba(0,0,0,0.1)' },
  formGroup: { marginBottom: '15px' },
  buttonGroup: { marginTop: '20px', textAlign: 'right' }
};

export default Departments;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\EmployeeDetail.js
================================================================================
// frontend/src/pages/EmployeeDetail.js
import React, { useState, useEffect, useCallback } from 'react';
import { useParams, Link, useNavigate } from 'react-router-dom';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { AnimatePresence } from 'framer-motion';
import { toast } from 'react-toastify';

// Import các modal
import EditEmployeeModal from '../components/EditEmployeeModal';
import SetRoleModal from '../components/SetRoleModal';
import ResetPasswordModal from '../components/ResetPasswordModal';

// --- Skeleton Component ---
const SkeletonProfile = () => (
    // Đã thêm padding 20px cho Skeleton để nhất quán
    <div style={styles.skeletonContainer}>
        <div style={styles.skeletonCard}>
            <div style={{ ...styles.skeletonItem, height: '60px', width: '60px', borderRadius: '50%', margin: '0 auto 15px auto' }} className="skeletonItem"></div>
            <div style={{ ...styles.skeletonItem, height: '24px', width: '70%', margin: '0 auto 10px auto' }} className="skeletonItem"></div>
            <div style={{ ...styles.skeletonItem, height: '18px', width: '50%', margin: '0 auto 20px auto' }} className="skeletonItem"></div>
            <div style={{ ...styles.skeletonItem, height: '16px', width: '90%', margin: '0 auto 5px auto' }} className="skeletonItem"></div>
            <div style={{ ...styles.skeletonItem, height: '16px', width: '90%', margin: '0 auto 20px auto' }} className="skeletonItem"></div>
            <div style={{ ...styles.skeletonItem, height: '30px', width: '100%', margin: '5px auto' }} className="skeletonItem"></div>
        </div>
        <div style={styles.skeletonDetails}>
            <div style={styles.skeletonInfoCard}>
                <div style={{ ...styles.skeletonItem, height: '20px', width: '40%', marginBottom: '20px' }} className="skeletonItem"></div>
                <div style={{ ...styles.skeletonItem, height: '16px', width: '90%', marginBottom: '10px' }} className="skeletonItem"></div>
                <div style={{ ...styles.skeletonItem, height: '16px', width: '80%', marginBottom: '10px' }} className="skeletonItem"></div>
                <div style={{ ...styles.skeletonItem, height: '16px', width: '85%', marginBottom: '10px' }} className="skeletonItem"></div>
            </div>
            <div style={styles.skeletonInfoCard}>
                <div style={{ ...styles.skeletonItem, height: '20px', width: '50%', marginBottom: '20px' }} className="skeletonItem"></div>
                <div style={{ ...styles.skeletonItem, height: '40px', width: '100%', marginBottom: '10px' }} className="skeletonItem"></div>
                <div style={{ ...styles.skeletonItem, height: '40px', width: '100%', marginBottom: '10px' }} className="skeletonItem"></div>
            </div>
        </div>
    </div>
);


function EmployeeDetail() {
    const [profile, setProfile] = useState(null);
    const [loading, setLoading] = useState(true);
    const { id } = useParams();
    const navigate = useNavigate();
    const { user: currentUser } = useAuth();
    const isAdmin = currentUser?.role === 'Admin';
    const isHrManager = currentUser?.role === 'HR Manager';

    // State quản lý Modals
    const [isEditModalOpen, setIsEditModalOpen] = useState(false);
    const [isRoleModalOpen, setIsRoleModalOpen] = useState(false);
    const [isPasswordModalOpen, setIsPasswordModalOpen] = useState(false);

    const fetchProfile = useCallback(async () => {
        setLoading(true);
        try {
            const response = await api.get(`/employees/${id}`);
            setProfile(response.data);
        } catch (error) {
            console.error('Failed to fetch employee profile', error);
            toast.error("Không thể tải hồ sơ nhân viên.");
            if (error.response?.status === 403) {
                navigate("/");
            }
        }
        setLoading(false);
    }, [id, navigate]);

    useEffect(() => {
        fetchProfile();
    }, [id, fetchProfile]);

    // --- Modal Handlers ---
    const handleOpenEditModal = () => setIsEditModalOpen(true);
    const handleCloseEditModal = () => setIsEditModalOpen(false);
    const handleUpdateSuccess = () => {
        handleCloseEditModal();
        toast.success("Cập nhật thông tin (HR) thành công!");
        fetchProfile();
    };

    const handleOpenRoleModal = () => setIsRoleModalOpen(true);
    const handleCloseRoleModal = () => setIsRoleModalOpen(false);
    const handleRoleUpdateSuccess = () => {
        handleCloseRoleModal();
        toast.success("Cập nhật vai trò thành công!");
        fetchProfile();
    };

    const handleOpenPasswordModal = () => setIsPasswordModalOpen(true);
    const handleClosePasswordModal = () => setIsPasswordModalOpen(false);
    const handlePasswordResetSuccess = () => {
        handleClosePasswordModal();
        toast.success(`Đã đặt lại mật khẩu cho ${profile?.Email}.`);
    };

    // --- Render Logic ---
    if (loading) return <SkeletonProfile />;
    if (!profile) return <p>Không tìm thấy nhân viên.</p>;

    const userDataForModal = profile.auth_user_id ? {
        id: profile.auth_user_id,
        email: profile.Email,
        role: profile.role
    } : null;

    return (
        <div style={styles.pageContainer}>
            <Link to="/employees" style={styles.backLink}>{"<"} Quay lại Danh sách</Link>

            <div style={styles.layoutGrid}>
                {/* === CỘT TRÁI: PROFILE CARD & ACTIONS === */}
                <div style={styles.profileCard}>
                    <h2 style={{ marginTop: 0, color: 'var(--text-color)' }}>{profile.FullName}</h2>
                    <p style={styles.profilePosition}>{profile.position?.PositionName || 'Chưa có chức vụ'}</p>

                    <div style={styles.profileInfoItem}>
                        <span style={styles.infoLabel}>Email (Tài khoản):</span>
                        <span>{profile.Email}</span>
                    </div>
                    <div style={styles.profileInfoItem}>
                        <span style={styles.infoLabel}>Vai trò (Auth):</span>
                        <span style={styles.roleBadge}>{profile.role || 'Chưa có TK'}</span>
                    </div>
                    <div style={styles.profileInfoItem}>
                        <span style={styles.infoLabel}>SĐT:</span>
                        <span>{profile.PhoneNumber || 'Chưa cập nhật'}</span>
                    </div>

                    <hr style={styles.divider} />

                    <h4 style={{ color: 'var(--text-color)' }}>Hành động</h4>
                    <div style={styles.actionButtonsContainer}>
                        {(isAdmin || isHrManager) && (
                            <button onClick={handleOpenEditModal} className="action-button-profile edit-button-profile">
                                Sửa thông tin (HR)
                            </button>
                        )}
                        {isAdmin && userDataForModal && currentUser?.email !== profile.Email && (
                            <>
                                <button onClick={handleOpenRoleModal} className="action-button-profile role-button-profile">
                                    Đặt vai trò (Auth)
                                </button>
                                <button onClick={handleOpenPasswordModal} className="action-button-profile password-button-profile">
                                    Đặt lại mật khẩu
                                </button>
                            </>
                        )}
                        {isAdmin && !userDataForModal && (
                            <p style={styles.annotation}>(Nhân viên chưa có tài khoản Auth)</p>
                        )}
                    </div>
                </div>

                {/* === CỘT PHẢI: DETAILS (HR & PAYROLL) === */}
                <div style={styles.detailsContainer}>
                    <div style={styles.infoCard}>
                        <h3 style={{ color: 'var(--text-color)' }}>Thông tin Hành chính (HR DB)</h3>
                        <div style={styles.infoGrid}>
                            <div><strong>Phòng ban:</strong> {profile.department?.DepartmentName}</div>
                            <div><strong>Trạng thái:</strong> {profile.Status}</div>
                            <div><strong>Ngày vào làm:</strong> {profile.HireDate}</div>
                            <div><strong>Ngày sinh:</strong> {profile.DateOfBirth}</div>
                            <div><strong>Giới tính:</strong> {profile.Gender}</div>
                            <div><strong>ID (HR):</strong> {profile.EmployeeID}</div>
                        </div>
                    </div>

                    <div style={styles.infoCard}>
                        <h3 style={{ color: 'var(--text-color)' }}>Lịch sử Lương (Payroll DB)</h3>
                        <div style={styles.tableWrapper}>
                            <table style={styles.table}>
                                <thead>
                                    <tr>
                                        <th style={styles.th}>Tháng</th>
                                        <th style={styles.th}>Lương CB</th>
                                        <th style={styles.th}>Thưởng</th>
                                        <th style={styles.th}>Khấu trừ</th>
                                        <th style={styles.th}>Thực nhận</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {profile.salaries.map(s => (
                                        <tr key={s.SalaryID}>
                                            <td style={styles.td}>{s.SalaryMonth}</td>
                                            <td style={styles.td}>{s.BaseSalary}</td>
                                            <td style={styles.td}>{s.Bonus}</td>
                                            <td style={styles.td}>{s.Deductions}</td>
                                            <td style={styles.td}><strong>{s.NetSalary}</strong></td>
                                        </tr>
                                    ))}
                                    {profile.salaries.length === 0 && (
                                        <tr><td colSpan={5} style={{ ...styles.td, textAlign: 'center' }}>Không có dữ liệu lương.</td></tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style={styles.infoCard}>
                        <h3 style={{ color: 'var(--text-color)' }}>Lịch sử Chấm công (Payroll DB)</h3>
                        <div style={styles.tableWrapper}>
                            <table style={styles.table}>
                                <thead>
                                    <tr>
                                        <th style={styles.th}>Tháng</th>
                                        <th style={styles.th}>Ngày làm việc</th>
                                        <th style={styles.th}>Vắng mặt</th>
                                        <th style={styles.th}>Nghỉ phép</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {profile.attendances.map(a => (
                                        <tr key={a.AttendanceID}>
                                            <td style={styles.td}>{a.AttendanceMonth}</td>
                                            <td style={styles.td}>{a.WorkDays}</td>
                                            <td style={styles.td}>{a.AbsentDays}</td>
                                            <td style={styles.td}>{a.LeaveDays}</td>
                                        </tr>
                                    ))}
                                    {profile.attendances.length === 0 && (
                                        <tr><td colSpan={4} style={{ ...styles.td, textAlign: 'center' }}>Không có dữ liệu chấm công.</td></tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            {/* === MODALS === */}
            <AnimatePresence>
                {isEditModalOpen && (
                    <EditEmployeeModal
                        isOpen={isEditModalOpen}
                        onClose={handleCloseEditModal}
                        onSuccess={handleUpdateSuccess}
                        employeeData={profile}
                    />
                )}
                {isRoleModalOpen && userDataForModal && (
                    <SetRoleModal
                        isOpen={isRoleModalOpen}
                        onClose={handleCloseRoleModal}
                        onSuccess={handleRoleUpdateSuccess}
                        userData={userDataForModal}
                    />
                )}
                {isPasswordModalOpen && userDataForModal && (
                    <ResetPasswordModal
                        isOpen={isPasswordModalOpen}
                        onClose={handleClosePasswordModal}
                        onSuccess={handlePasswordResetSuccess}
                        userData={userDataForModal}
                    />
                )}
            </AnimatePresence>
        </div>
    );
}

// --- STYLES ĐÃ CẬP NHẬT ---
const styles = {
    pageContainer: {
        padding: '20px', // FIX: Thêm padding 20px giống Dashboard.js
        color: 'var(--text-color)'
    },
    backLink: {
        display: 'inline-block',
        marginBottom: '15px',
        color: 'var(--primary-color)',
        textDecoration: 'none',
        fontWeight: 'bold',
    },
    layoutGrid: {
        display: 'flex',
        flexDirection: 'row',
        gap: '20px',
        flexWrap: 'wrap',
    },
    // Cột trái
    profileCard: {
        flex: 1,
        minWidth: '300px',
        padding: '20px',
        backgroundColor: 'var(--card-bg)',
        border: '1px solid var(--border-color)',
        borderRadius: '8px',
        boxShadow: '0 2px 4px rgba(0,0,0,0.05)',
        alignSelf: 'flex-start',
    },
    profilePosition: {
        fontSize: '1.1em',
        color: 'var(--text-color-secondary)',
        marginTop: '-10px',
    },
    profileInfoItem: {
        display: 'flex',
        justifyContent: 'space-between',
        marginBottom: '10px',
        fontSize: '0.9em',
    },
    infoLabel: {
        fontWeight: 'bold',
        color: 'var(--text-color)',
    },
    roleBadge: {
        padding: '2px 8px',
        backgroundColor: '#e6f7ff',
        border: '1px solid #91d5ff',
        borderRadius: '10px',
        color: '#096dd9',
        fontWeight: 'bold',
    },
    divider: {
        border: 'none',
        borderTop: '1px solid var(--table-row-border-color)',
        margin: '20px 0',
    },
    actionButtonsContainer: {
        display: 'flex',
        flexDirection: 'column',
        gap: '10px',
    },
    annotation: { fontSize: '0.8em', color: 'var(--text-color-secondary)', fontStyle: 'italic' },
    // Cột phải
    detailsContainer: {
        flex: 2,
        minWidth: '400px',
        display: 'flex',
        flexDirection: 'column',
        gap: '20px',
    },
    infoCard: {
        padding: '20px',
        backgroundColor: 'var(--card-bg)',
        border: '1px solid var(--border-color)',
        borderRadius: '8px',
        boxShadow: '0 2px 4px rgba(0,0,0,0.05)',
    },
    infoGrid: {
        display: 'grid',
        gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
        gap: '10px',
        color: 'var(--text-color)',
    },
    tableWrapper: {
        overflowX: 'auto',
    },
    table: {
        width: '100%',
        borderCollapse: 'collapse',
        color: 'var(--text-color)',
    },
    th: {
        padding: '10px',
        textAlign: 'left',
        backgroundColor: 'var(--table-header-bg)',
        borderBottom: '2px solid var(--table-border-color)',
        color: 'var(--text-color)',
    },
    td: {
        padding: '10px',
        borderBottom: '1px solid var(--table-row-border-color)',
        color: 'var(--text-color)',
    },

    // Skeleton Styles
    skeletonContainer: {
        display: 'flex',
        gap: '20px',
        padding: '20px', // FIX: Thêm padding 20px
        flexWrap: 'wrap', // Thêm wrap cho responsive
    },
    skeletonCard: {
        flex: 1, minWidth: '300px', padding: '20px',
        backgroundColor: 'var(--card-bg)',
        border: '1px solid var(--border-color)',
        borderRadius: '8px',
        alignSelf: 'flex-start',
    },
    skeletonDetails: {
        flex: 2, minWidth: '400px', display: 'flex', flexDirection: 'column', gap: '20px',
    },
    skeletonInfoCard: {
        padding: '20px',
        backgroundColor: 'var(--card-bg)',
        border: '1px solid var(--border-color)',
        borderRadius: '8px',
    },
    skeletonItem: {
        backgroundColor: '#e0e0e0',
        borderRadius: '4px',
        animation: 'pulse 1.5s infinite ease-in-out',
    }
};

// CSS Động (Thêm dark mode cho skeleton)
(function () {
    const styleId = 'employee-detail-styles';
    if (!document.getElementById(styleId)) {
        const styleSheet = document.createElement("style");
        styleSheet.id = styleId;
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes pulse {
                0% { background-color: #e0e0e0; }
                50% { background-color: #f0f0f0; }
                100% { background-color: #e0e0e0; }
            }
             /* Dark mode skeleton adjustment */
             body.theme-dark .skeletonItem {
                 background-color: #333;
                 opacity: 0.5;
                 animation-name: pulse-dark;
             }
             @keyframes pulse-dark {
                 0% { background-color: #333; opacity: 0.5; }
                 50% { background-color: #444; opacity: 0.7; }
                 100% { background-color: #333; opacity: 0.5; }
             }

             /* Profile Card Action Buttons */
             .action-button-profile {
                 padding: 8px 12px; border: 1px solid var(--border-color);
                 border-radius: 4px; cursor: pointer; font-weight: bold;
                 transition: background-color 0.2s, border-color 0.2s;
                 background-color: var(--button-bg); color: var(--button-text);
                 text-align: center;
             }
             /* Giữ màu semantic */
             .edit-button-profile { background-color: #fffbe6; border-color: #ffe58f; color: #d46b08; }
             .role-button-profile { background-color: #f6ffed; border-color: #b7eb8f; color: #389e0d; }
             .password-button-profile { background-color: #fff0f6; border-color: #ffadd2; color: #c41d7f; }

             .edit-button-profile:hover { background-color: #ffe58f !important; }
             .role-button-profile:hover { background-color: #d9f7be !important; }
             .password-button-profile:hover { background-color: #ffadd2 !important; }
        `;
        document.head.appendChild(styleSheet);
    }
})();

export default EmployeeDetail;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\EmployeeList.js
================================================================================
// frontend/src/pages/EmployeeList.js
import React, { useState, useEffect, useCallback, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import api from '../services/api';
import AddEmployeeModal from '../components/AddEmployeeModal';
import EditEmployeeModal from '../components/EditEmployeeModal';
import { useAuth } from '../context/AuthContext';
import { toast } from 'react-toastify';
import { AnimatePresence, motion } from 'framer-motion';

const STATUS_OPTIONS = ["Đang làm việc", "Nghỉ phép", "Thử việc", "Thực tập", "Đã nghỉ việc"];

// --- Skeleton Row Component ---
const SkeletonRow = ({ columns }) => (
    <tr>
        {Array.from({ length: columns }).map((_, index) => (
            <td key={index} style={styles.tableCell}>
                <div style={styles.skeletonCell}></div>
            </td>
        ))}
    </tr>
);

function EmployeeList() {
    const [employees, setEmployees] = useState([]);
    const [loading, setLoading] = useState(true);
    const navigate = useNavigate();
    const { user: currentUser } = useAuth();
    
    // Filter States
    const [searchTerm, setSearchTerm] = useState('');
    const [filters, setFilters] = useState({ departmentId: '', positionId: '', status: '' });
    const [departments, setDepartments] = useState([]);
    const [positions, setPositions] = useState([]);
    
    // Modal States
    const [isAddModalOpen, setIsAddModalOpen] = useState(false);
    const [isEditModalOpen, setIsEditModalOpen] = useState(false);
    const [employeeToEdit, setEmployeeToEdit] = useState(null);

    const isAdmin = currentUser?.role === 'Admin';
    const isHrManager = currentUser?.role === 'HR Manager';

    // --- FETCH DATA ---
    const fetchEmployees = useCallback(async (currentSearchTerm = searchTerm, currentFilters = filters) => {
        setLoading(true);
        try {
            const params = {
                search: currentSearchTerm,
                department_id: currentFilters.departmentId || undefined,
                position_id: currentFilters.positionId || undefined,
                status: currentFilters.status || undefined,
            };
            const response = await api.get('/employees/', { params });
            setEmployees(response.data);
        } catch (err) {
            console.error('Failed to fetch employees', err);
            toast.error('Không thể tải danh sách nhân viên.');
        } finally {
            setLoading(false);
        }
    }, []);

    // Load Initial Filter Data (Dept/Pos)
    useEffect(() => {
        const fetchFilterData = async () => {
             setLoading(true);
            try {
                const [deptRes, posRes] = await Promise.all([
                    api.get('/departments/'),
                    api.get('/positions/')
                ]);
                setDepartments(deptRes.data);
                setPositions(posRes.data);
                await fetchEmployees('', { departmentId: '', positionId: '', status: '' });
            } catch (err) {
                toast.error("Không thể tải dữ liệu bộ lọc.");
                setLoading(false);
            }
        };
        fetchFilterData();
    }, []);

    // Debounce Search
    const debounceTimeout = useRef(null);
    useEffect(() => {
        if (debounceTimeout.current) clearTimeout(debounceTimeout.current);
        debounceTimeout.current = setTimeout(() => {
            fetchEmployees(searchTerm, filters);
        }, 500);
        return () => clearTimeout(debounceTimeout.current);
    }, [searchTerm, filters, fetchEmployees]);

    // --- HANDLERS ---
    const handleFilterChange = (e) => {
        const { name, value } = e.target;
        setFilters(prev => ({ ...prev, [name]: value }));
    };

    const handleClearFilters = () => {
        setSearchTerm('');
        setFilters({ departmentId: '', positionId: '', status: '' });
    };

    const handleViewDetails = (id) => navigate(`/employees/${id}`);

    // --- ADD EMPLOYEE ---
    const handleAddSuccess = () => { 
        setIsAddModalOpen(false);
        toast.success("Thêm nhân viên thành công! (Đã ghi Nhật ký hoạt động)"); 
        fetchEmployees(searchTerm, filters); 
    };

    // --- EDIT EMPLOYEE ---
    const handleEditSuccess = () => { 
        setIsEditModalOpen(false); setEmployeeToEdit(null);
        toast.success("Cập nhật hồ sơ thành công! (Đã ghi Nhật ký hoạt động)"); 
        fetchEmployees(searchTerm, filters); 
    };

    // --- DELETE EMPLOYEE (Với ràng buộc dữ liệu) ---
    const handleDeleteEmployee = async (employeeId, employeeName) => {
        if (window.confirm(`Xác nhận xóa nhân viên "${employeeName}" (ID: ${employeeId})?\n\nHệ thống sẽ kiểm tra ràng buộc dữ liệu (Lương, Cổ tức) trước khi xóa.`)) {
            const toastId = toast.loading("Đang kiểm tra ràng buộc và xóa...");
            try {
                await api.delete(`/employees/${employeeId}`);
                toast.update(toastId, { render: "Đã xóa và ghi log thành công!", type: "success", isLoading: false, autoClose: 2000 });
                fetchEmployees(searchTerm, filters);
            } catch (err) {
                console.error('Delete failed', err);
                // Hiển thị lỗi chi tiết từ Backend (VD: Không thể xóa vì có cổ tức)
                const errorMsg = err.response?.data?.detail || "Xóa thất bại.";
                toast.update(toastId, { render: `LỖI: ${errorMsg}`, type: "error", isLoading: false, autoClose: 5000 });
            }
        }
    };

    // Helper để tô màu badge
    const getRoleBadgeStyle = (role) => {
        if (role === 'Admin') return { background: '#e6f4ff', color: '#0958d9', border: '1px solid #91caff' };
        if (role === 'HR Manager') return { background: '#f6ffed', color: '#389e0d', border: '1px solid #b7eb8f' };
        if (role === 'Payroll Manager') return { background: '#fff0f6', color: '#c41d7f', border: '1px solid #ffadd2' };
        return { background: '#f5f5f5', color: '#595959', border: '1px solid #d9d9d9' };
    };

    return (
        <motion.div 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }}
            style={{ padding: '20px', color: 'var(--text-color)' }}
        >
            <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'20px'}}>
                <h2 style={{ margin: 0 }}>Quản lý Hồ sơ Nhân viên</h2>
                {(isAdmin || isHrManager) && (
                    <button onClick={() => setIsAddModalOpen(true)} style={styles.addButton} disabled={loading}>
                        + Thêm Nhân viên
                    </button>
                )}
            </div>
            
            {/* --- FILTER SECTION --- */}
            <div style={styles.filterForm}>
                 <div style={styles.filterGrid}>
                     <div style={styles.filterItem}>
                         <label style={styles.filterLabel}>Tìm kiếm (ID, Tên)</label>
                         <input type="text" placeholder="Nhập từ khóa..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} style={styles.filterInput} />
                     </div>
                     <div style={styles.filterItem}>
                         <label style={styles.filterLabel}>Phòng ban</label>
                         <select name="departmentId" value={filters.departmentId} onChange={handleFilterChange} style={styles.filterSelect}>
                             <option value="">Tất cả</option>
                             {departments.map(d => <option key={d.DepartmentID} value={d.DepartmentID}>{d.DepartmentName}</option>)}
                         </select>
                     </div>
                     <div style={styles.filterItem}>
                         <label style={styles.filterLabel}>Chức vụ</label>
                         <select name="positionId" value={filters.positionId} onChange={handleFilterChange} style={styles.filterSelect}>
                             <option value="">Tất cả</option>
                             {positions.map(p => <option key={p.PositionID} value={p.PositionID}>{p.PositionName}</option>)}
                         </select>
                     </div>
                     <div style={styles.filterItem}>
                         <label style={styles.filterLabel}>Trạng thái</label>
                         <select name="status" value={filters.status} onChange={handleFilterChange} style={styles.filterSelect}>
                             <option value="">Tất cả</option>
                             {STATUS_OPTIONS.map(s => <option key={s} value={s}>{s}</option>)}
                         </select>
                     </div>
                     <div style={{ ...styles.filterItem, alignSelf: 'flex-end' }}>
                         <button type="button" onClick={handleClearFilters} style={styles.filterButtonClear}>Xóa bộ lọc</button>
                     </div>
                 </div>
            </div>

            {/* --- TABLE SECTION --- */}
            <div style={styles.tableContainer}>
                 <table style={styles.table}>
                    <thead>
                        <tr>
                            <th style={styles.th}>Mã NV</th>
                            <th style={styles.th}>Họ và Tên</th>
                            <th style={styles.th}>Phòng ban / Chức vụ</th>
                            <th style={styles.th}>Vai trò (Auth)</th>
                            <th style={styles.th}>Trạng thái</th>
                            <th style={{...styles.th, textAlign:'center'}}>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        {loading ? (
                            Array.from({ length: 8 }).map((_, index) => <SkeletonRow key={index} columns={6} />)
                        ) : employees.length > 0 ? (
                            employees.map(emp => (
                                <tr key={emp.EmployeeID} style={styles.tr}>
                                    <td style={styles.tableCell}><strong>{emp.EmployeeID}</strong></td>
                                    <td style={styles.tableCell}>
                                        <div>{emp.FullName}</div>
                                        <div style={{fontSize:'0.85em', color:'var(--text-color-secondary)'}}>{emp.Email}</div>
                                    </td>
                                    <td style={styles.tableCell}>
                                        <div style={{fontWeight:'500'}}>{emp.department?.DepartmentName || '-'}</div>
                                        <div style={{fontSize:'0.85em', color:'var(--text-color-secondary)'}}>{emp.position?.PositionName || '-'}</div>
                                    </td>
                                    <td style={styles.tableCell}>
                                        <span style={{...styles.roleBadge, ...getRoleBadgeStyle(emp.role)}}>{emp.role || 'User'}</span>
                                    </td>
                                    <td style={styles.tableCell}>
                                        <span style={emp.Status === 'Đang làm việc' ? styles.statusActive : styles.statusInactive}>
                                            {emp.Status}
                                        </span>
                                    </td>
                                    <td style={styles.tableCellActions}>
                                         <button onClick={() => handleViewDetails(emp.EmployeeID)} className="action-button view-button">Chi tiết</button>
                                        {(isAdmin || isHrManager) && ( 
                                            <button onClick={() => { setEmployeeToEdit(emp); setIsEditModalOpen(true); }} className="action-button edit-button">Sửa</button> 
                                        )}
                                        {isAdmin && (
                                            <button onClick={() => handleDeleteEmployee(emp.EmployeeID, emp.FullName)} className="action-button delete-button">Xóa</button>
                                        )}
                                    </td>
                                </tr>
                            ))
                        ) : (
                            <tr><td colSpan="6" style={{ textAlign: 'center', padding: '30px', color: 'var(--text-color-secondary)' }}>Không tìm thấy nhân viên nào.</td></tr>
                        )}
                    </tbody>
                </table>
            </div>

            {/* Modals */}
            <AnimatePresence>
                {isAddModalOpen && <AddEmployeeModal isOpen={isAddModalOpen} onClose={() => setIsAddModalOpen(false)} onSuccess={handleAddSuccess} />}
                {isEditModalOpen && employeeToEdit && <EditEmployeeModal isOpen={isEditModalOpen} onClose={() => {setIsEditModalOpen(false); setEmployeeToEdit(null)}} onSuccess={handleEditSuccess} employeeData={employeeToEdit} />}
            </AnimatePresence>
        </motion.div>
    );
}

// --- STYLES ---
const styles = {
    filterForm: { marginBottom: '20px', padding: '20px', border: '1px solid var(--border-color)', borderRadius: '8px', background: 'var(--card-bg)', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' },
    filterGrid: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))', gap: '15px' },
    filterItem: { display: 'flex', flexDirection: 'column' },
    filterLabel: { marginBottom: '8px', fontSize: '0.85em', fontWeight: '600', color: 'var(--text-color-secondary)' },
    filterInput: { padding: '10px', border: '1px solid var(--input-border-color)', borderRadius: '6px', width: '100%', boxSizing: 'border-box', backgroundColor: 'var(--input-bg)', color: 'var(--text-color)' },
    filterSelect: { padding: '10px', border: '1px solid var(--input-border-color)', borderRadius: '6px', width: '100%', boxSizing: 'border-box', background: 'var(--input-bg)', color: 'var(--text-color)' },
    filterButtonClear: { padding: '10px 15px', cursor: 'pointer', border: '1px solid var(--border-color)', backgroundColor: 'transparent', color: 'var(--text-color)', borderRadius: '6px', transition: '0.2s', fontWeight: '500' },
    addButton: { padding: '10px 20px', cursor: 'pointer', backgroundColor: '#0d6efd', color: 'white', border: 'none', borderRadius: '6px', fontWeight: '600', boxShadow: '0 2px 4px rgba(13, 110, 253, 0.3)' },
    
    tableContainer: { overflowX: 'auto', backgroundColor: 'var(--card-bg)', border: '1px solid var(--border-color)', borderRadius: '8px', boxShadow: '0 2px 8px rgba(0,0,0,0.05)' },
    table: { width: '100%', borderCollapse: 'collapse', fontSize: '0.95em' },
    th: { padding: '15px', background: 'var(--table-header-bg)', color: 'var(--text-color)', textAlign: 'left', fontWeight: '600', borderBottom: '2px solid var(--border-color)' },
    tr: { borderBottom: '1px solid var(--border-color)' },
    tableCell: { padding: '15px', verticalAlign: 'middle', color: 'var(--text-color)' },
    tableCellActions: { padding: '15px', textAlign: 'center', display:'flex', justifyContent:'center', gap:'8px' },
    
    roleBadge: { padding: '4px 10px', borderRadius: '12px', fontSize: '0.85em', fontWeight: '600', display: 'inline-block' },
    statusActive: { color: '#13c2c2', background: '#e6fffb', padding: '4px 8px', borderRadius: '4px', border: '1px solid #87e8de', fontSize: '0.85em' },
    statusInactive: { color: '#faad14', background: '#fffbe6', padding: '4px 8px', borderRadius: '4px', border: '1px solid #ffe58f', fontSize: '0.85em' },
    
    skeletonCell: { height: '20px', backgroundColor: '#e0e0e0', borderRadius: '4px', animation: 'pulse 1.5s infinite ease-in-out' },
};

// Add Pulse Animation
if (!document.getElementById('pulse-style')) {
    const style = document.createElement('style');
    style.id = 'pulse-style';
    style.innerHTML = `@keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }`;
    document.head.appendChild(style);
}

export default EmployeeList;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\LeaveApproval.js
================================================================================
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { toast } from 'react-toastify';

function LeaveApproval() {
    const [requests, setRequests] = useState([]);

    const fetchRequests = () => {
        api.get('/leave-requests/').then(res => setRequests(res.data)).catch(console.error);
    };

    useEffect(() => { fetchRequests(); }, []);

    const handleStatus = async (id, status) => {
        try {
            await api.put(`/leave-requests/${id}/status`, { Status: status });
            toast.success(`Đã ${status === 'Approved' ? 'duyệt' : 'từ chối'} yêu cầu.`);
            fetchRequests();
        } catch (err) {
            toast.error("Có lỗi xảy ra.");
        }
    };

    const pendingRequests = requests.filter(r => r.Status === 'Pending');
    const historyRequests = requests.filter(r => r.Status !== 'Pending');

    return (
        <div style={{ padding: '20px' }}>
            <h2>Quản lý Nghỉ phép & Chấm công</h2>
            
            <div style={{background:'white', padding:'20px', borderRadius:'8px', marginBottom:'20px', boxShadow:'0 2px 4px rgba(0,0,0,0.05)'}}>
                <h3 style={{marginTop:0}}>Yêu cầu Nghỉ phép Chờ duyệt</h3>
                <table style={{width:'100%', borderCollapse:'collapse'}}>
                    <thead>
                        <tr style={{textAlign:'left', color:'#666', borderBottom:'1px solid #eee'}}>
                            <th style={{padding:'10px'}}>Nhân viên</th>
                            <th style={{padding:'10px'}}>Loại nghỉ</th>
                            <th style={{padding:'10px'}}>Thời gian</th>
                            <th style={{padding:'10px'}}>Lý do</th>
                            <th style={{padding:'10px'}}>Phê duyệt</th>
                        </tr>
                    </thead>
                    <tbody>
                        {pendingRequests.map(req => (
                            <tr key={req.RequestID} style={{borderBottom:'1px solid #eee'}}>
                                <td style={{padding:'10px'}}><strong>{req.EmployeeName}</strong><br/><small>{req.DepartmentName}</small></td>
                                <td>{req.LeaveType}</td>
                                <td>{req.StartDate} - {req.EndDate}</td>
                                <td>{req.Reason}</td>
                                <td>
                                    <button onClick={() => handleStatus(req.RequestID, 'Approved')} style={{padding:'5px 10px', background:'#198754', color:'white', border:'none', borderRadius:'4px', marginRight:'5px', cursor:'pointer'}}>✓ Duyệt</button>
                                    <button onClick={() => handleStatus(req.RequestID, 'Rejected')} style={{padding:'5px 10px', background:'#dc3545', color:'white', border:'none', borderRadius:'4px', cursor:'pointer'}}>✕ Từ chối</button>
                                </td>
                            </tr>
                        ))}
                        {pendingRequests.length === 0 && <tr><td colSpan="5" style={{padding:'20px', textAlign:'center', color:'#999'}}>Không có yêu cầu nào đang chờ.</td></tr>}
                    </tbody>
                </table>
            </div>

            <div style={{background:'white', padding:'20px', borderRadius:'8px', boxShadow:'0 2px 4px rgba(0,0,0,0.05)'}}>
                <h3 style={{marginTop:0}}>Lịch sử Duyệt gần đây</h3>
                <table style={{width:'100%'}}>
                    <tbody>
                        {historyRequests.map(req => (
                            <tr key={req.RequestID} style={{borderBottom:'1px solid #eee'}}>
                                <td style={{padding:'10px'}}>{req.EmployeeName}</td>
                                <td>{req.StartDate}</td>
                                <td><span style={{padding:'3px 8px', borderRadius:'10px', background: req.Status === 'Approved' ? '#d1e7dd' : '#f8d7da', color: req.Status === 'Approved' ? '#0f5132' : '#842029', fontSize:'0.85em'}}>{req.Status}</span></td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </div>
    );
}
export default LeaveApproval;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\Login.js
================================================================================
import React, { useState, useEffect } from 'react';
import { useAuth } from '../context/AuthContext';
import { useNavigate, useLocation } from 'react-router-dom';
import { motion } from 'framer-motion'; // Import motion for animations

// --- Icons (Keep these) ---
const UserIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> <circle cx="12" cy="7" r="4"></circle> </svg>
);
const LockIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect> <path d="M7 11V7a5 5 0 0 1 10 0v4"></path> </svg>
);
// Optional: Add a decorative graphic/icon for the info panel
const InfoGraphicIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1" strokeLinecap="round" strokeLinejoin="round" style={{ opacity: 0.5, marginBottom: '20px' }}>
        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="8.5" cy="7" r="4"></circle>
        <polyline points="17 11 19 13 23 9"></polyline> {/* Added checkmark element */}
        <line x1="17" y1="16" x2="17" y2="17"></line> {/* Subtle details */}
        <line x1="19" y1="16" x2="19" y2="17"></line>
    </svg>
);


function Login() {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [error, setError] = useState('');
    const [loading, setLoading] = useState(false);
    const auth = useAuth();
    const navigate = useNavigate();
    const location = useLocation();

    const from = location.state?.from?.pathname || '/';

    const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);
        try {
            await auth.login(email, password);
            navigate(from, { replace: true });
        } catch (err) {
            setError('Đăng nhập thất bại. Vui lòng kiểm tra lại thông tin.'); // Shorter error
            console.error(err);
        } finally {
            setLoading(false);
        }
    };

    // Inject CSS into <head> (Keep this mechanism for now)
    useEffect(() => {
        const styleId = 'login-page-styles';
        let styleSheet = document.getElementById(styleId);
        if (!styleSheet) {
            styleSheet = document.createElement("style");
            styleSheet.id = styleId;
            styleSheet.type = "text/css";
            document.head.appendChild(styleSheet);
        }
        // Use updated customStyles string
        styleSheet.innerText = customStyles;
    }, []);

    return (
        <div style={styles.container}>
            {/* Animated background element */}
            <div style={styles.backgroundGradient}></div>

            <motion.div // Wrap login box for entry animation
                style={styles.loginBox}
                initial={{ opacity: 0, scale: 0.95, y: 20 }}
                animate={{ opacity: 1, scale: 1, y: 0 }}
                transition={{ duration: 0.5, ease: "easeOut" }}
            >
                {/* --- Info Column (Left) --- */}
                <div style={styles.infoPanel} className="info-panel"> {/* Added class for media query */}
                    <InfoGraphicIcon />
                    <h1 style={styles.infoTitle}>HRM Dashboard</h1>
                    <p style={styles.infoSubtitle}>Giải pháp tích hợp quản lý nhân sự & lương bổng.</p>
                </div>

                {/* --- Form Column (Right) --- */}
                <div style={styles.formPanel}>
                    <h2 style={styles.formTitle}>Đăng nhập</h2> {/* Shorter title */}
                    <form onSubmit={handleSubmit}>
                        <div style={styles.inputGroup}>
                            <span style={styles.inputIcon}><UserIcon /></span>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                                placeholder="Email" // Simpler placeholder
                                style={styles.input}
                                className="login-input"
                                aria-label="Email"
                            />
                        </div>
                        <div style={styles.inputGroup}>
                             <span style={styles.inputIcon}><LockIcon /></span>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                                placeholder="Mật khẩu"
                                style={styles.input}
                                className="login-input"
                                aria-label="Password"
                            />
                        </div>

                        {/* Error Message with subtle animation possibility */}
                        {error && (
                            <motion.p
                                style={styles.errorText}
                                role="alert"
                                initial={{ opacity: 0, y: -10 }}
                                animate={{ opacity: 1, y: 0 }}
                                transition={{ duration: 0.3 }}
                            >
                                {error}
                            </motion.p>
                        )}

                        <button
                            type="submit"
                            disabled={loading}
                            style={loading ? {...styles.button, ...styles.buttonDisabled} : styles.button}
                            className="login-button"
                        >
                            {loading ? (
                                <>
                                    <span style={styles.spinner} aria-hidden="true"></span>
                                    Đang xử lý...
                                </>
                            ) : (
                                'Đăng nhập'
                            )}
                        </button>
                    </form>
                     {/* Optional: Add "Forgot Password?" link later */}
                     {/* <p style={styles.forgotPassword}>Quên mật khẩu?</p> */}
                </div>
            </motion.div>
             <footer style={styles.footer}>
                 Phát triển bởi Lâm Chu Bảo Toàn
                 <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span> {/* Separator */}
                 © 2025 HRM Dashboard
             </footer>
        </div>
    );
}

// --- CSS-in-JS Styles (Refined) ---
const styles = {
    container: {
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        minHeight: '100vh',
        // Background handled by pseudo-element or separate div
        fontFamily: "'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif", // Modern font stack
        position: 'relative',
        overflow: 'hidden',
        padding: '20px', // Add padding for smaller screens
    },
    // Animated background
    backgroundGradient: {
        position: 'absolute',
        top: 0, left: 0, right: 0, bottom: 0,
        background: 'linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab)',
        backgroundSize: '400% 400%',
        animation: 'gradientBG 15s ease infinite',
        zIndex: 0,
    },
    loginBox: {
        display: 'flex',
        width: '850px', // Slightly narrower
        maxWidth: '100%', // Ensure it fits mobile view when stacked
        minHeight: '500px', // Min height
        backgroundColor: 'rgba(255, 255, 255, 0.98)', // Slightly transparent white
        backdropFilter: 'blur(5px)', // Blur background behind box (subtle effect)
        borderRadius: '16px', // More rounded
        boxShadow: '0 15px 40px rgba(0, 0, 0, 0.15)', // Softer, larger shadow
        overflow: 'hidden',
        zIndex: 1,
    },
    infoPanel: {
        flex: 1.2, // Give slightly more space to info panel
        padding: '60px 40px',
        background: 'linear-gradient(145deg, #1A2980 0%, #26D0CE 100%)', // New gradient
        color: 'white',
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        alignItems: 'center', // Center content vertically and horizontally
        textAlign: 'center',
    },
    infoTitle: {
        fontSize: '2.5rem',
        fontWeight: 700, // Bolder
        marginBottom: '10px',
        textShadow: '1px 1px 4px rgba(0,0,0,0.3)',
    },
    infoSubtitle: {
        fontSize: '1.1rem',
        opacity: '0.9',
        lineHeight: 1.6,
        maxWidth: '300px', // Limit width for better readability
    },
    formPanel: {
        flex: 1, // Slightly less space than info panel
        padding: '50px 50px', // Equal padding
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        backgroundColor: '#fff', // Solid white for form area
    },
    formTitle: {
        fontSize: '1.8rem',
        color: '#2d3748', // Darker grey
        fontWeight: 600, // Semi-bold
        marginBottom: '40px',
        textAlign: 'center',
    },
    inputGroup: {
        position: 'relative',
        marginBottom: '20px',
    },
    input: {
        width: '100%',
        padding: '12px 15px 12px 45px', // Adjusted padding
        border: '1px solid #e2e8f0', // Lighter border
        borderRadius: '8px', // More rounding
        fontSize: '1rem',
        color: '#2d3748',
        backgroundColor: '#f7fafc', // Very light input background
        transition: 'border-color 0.2s ease, box-shadow 0.2s ease',
        boxSizing: 'border-box',
    },
    inputIcon: {
        position: 'absolute',
        top: '50%',
        left: '15px',
        transform: 'translateY(-50%)',
        color: '#a0aec0', // Lighter icon color
        pointerEvents: 'none',
        lineHeight: 0, // Ensure icon vertical alignment
    },
    errorText: {
        color: '#e53e3e', // Red error color
        backgroundColor: '#fed7d7', // Light red background
        border: '1px solid #fbb6b6',
        padding: '10px 15px',
        borderRadius: '8px',
        textAlign: 'center',
        marginBottom: '20px',
        fontSize: '0.9rem',
    },
    button: {
        width: '100%',
        padding: '12px',
        border: 'none',
        borderRadius: '8px',
        // Use a gradient for the button
        background: 'linear-gradient(90deg, #1A2980 0%, #26D0CE 100%)',
        color: 'white',
        fontSize: '1.05rem', // Slightly adjusted size
        fontWeight: 600,
        cursor: 'pointer',
        transition: 'opacity 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        marginTop: '15px',
        boxShadow: '0 4px 10px rgba(0, 0, 0, 0.1)',
    },
    buttonDisabled: {
        opacity: 0.6, // Use opacity for disabled state
        cursor: 'not-allowed',
        boxShadow: 'none',
    },
    footer: {
        position: 'absolute',
        bottom: '20px',
        color: '#a0aec0', // Lighter footer text
        fontSize: '0.85rem',
        textAlign: 'center',
        width: '100%',
        zIndex: 0,
    },
    spinner: {
        display: 'inline-block',
        width: '16px',
        height: '16px',
        border: '3px solid rgba(255, 255, 255, 0.3)',
        borderTopColor: '#fff',
        borderRadius: '50%',
        animation: 'spin 0.8s linear infinite',
        marginRight: '10px',
    },
    forgotPassword: { // Style for potential forgot password link
        textAlign: 'right',
        marginTop: '10px',
        fontSize: '0.9rem',
        color: '#4a5568', // Grey link color
        cursor: 'pointer',
    }
};

// --- Dynamic CSS rules (Refined) ---
const customStyles = `
    /* Background Gradient Animation */
    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Input focus effect */
    .login-input:focus {
        border-color: #26D0CE; /* Use accent color */
        background-color: #fff; // White background on focus
        box-shadow: 0 0 0 3px rgba(38, 208, 206, 0.2);
        outline: none;
    }

    /* Button hover/active effects */
    .login-button:hover:not(:disabled) {
        opacity: 0.9;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        /* transform: translateY(-1px); */ /* Optional subtle lift */
    }
    .login-button:active:not(:disabled) {
        opacity: 1;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transform: translateY(1px); /* Press down effect */
    }

    /* Spinner animation */
    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Responsive adjustments */
    @media (max-width: 800px) {
        .login-box {
            flex-direction: column; /* Stack vertically */
            width: auto; /* Adjust width */
            max-width: 450px; /* Max width for stacked form */
            height: auto; /* Auto height */
            margin: 20px; /* Add margin */
        }
        .info-panel {
            display: none; /* Hide info panel on small screens */
        }
        .form-panel {
            padding: 40px 30px; /* Adjust padding */
        }
    }
`;

export default Login;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\MyAttendance.js
================================================================================
// frontend/src/pages/MyAttendance.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { toast } from 'react-toastify';
import { motion } from 'framer-motion';

// Skeleton Loading
const Skeleton = () => <div style={{height:'40px', background:'#eee', margin:'10px 0', borderRadius:'4px'}}></div>;

function MyAttendance() {
    const { user } = useAuth();
    const [attendanceHistory, setAttendanceHistory] = useState([]);
    const [stats, setStats] = useState({ worked: 0, absent: 0, leave: 0 });
    const [loading, setLoading] = useState(true);
    
    // Form đăng ký nghỉ
    const [formData, setFormData] = useState({ LeaveType: 'Phép năm', StartDate: '', EndDate: '', Reason: '' });

    useEffect(() => {
        if (user?.emp_id) {
            fetchAttendanceData(user.emp_id);
        }
    }, [user]);

    const fetchAttendanceData = async (id) => {
        setLoading(true);
        try {
            // Lấy dữ liệu chấm công từ MySQL thông qua API Payroll
            const res = await api.get(`/payroll/${id}/attendance`);
            setAttendanceHistory(res.data);

            // Tính toán thống kê tổng hợp (Client-side aggregation)
            const totalStats = res.data.reduce((acc, curr) => ({
                worked: acc.worked + curr.WorkDays,
                absent: acc.absent + curr.AbsentDays,
                leave: acc.leave + curr.LeaveDays
            }), { worked: 0, absent: 0, leave: 0 });
            
            setStats(totalStats);

        } catch (err) {
            console.error(err);
            toast.error("Không thể tải dữ liệu chấm công.");
        } finally {
            setLoading(false);
        }
    };

    const handleRequestSubmit = async (e) => {
        e.preventDefault();
        try {
            await api.post('/leave-requests/', formData);
            toast.success("Gửi yêu cầu nghỉ phép thành công!");
            setFormData({ LeaveType: 'Phép năm', StartDate: '', EndDate: '', Reason: '' });
        } catch(err) { 
            toast.error("Lỗi gửi yêu cầu."); 
        }
    };

    // Hạn mức nghỉ phép giả định
    const MAX_LEAVE_YEAR = 12;
    const leaveRemaining = MAX_LEAVE_YEAR - stats.leave;

    return (
        <motion.div 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }}
            style={{ padding: '20px', color: 'var(--text-color)' }}
        >
            <h2 style={{ marginBottom: '20px' }}>Quản lý Chấm công & Nghỉ phép</h2>

            {/* --- PHẦN 1: THỐNG KÊ TỔNG QUAN (Dữ liệu MySQL) --- */}
            <div style={styles.statsGrid}>
                <div style={styles.statCard}>
                    <div style={styles.statTitle}>Tổng Ngày công</div>
                    <div style={{...styles.statValue, color:'#0d6efd'}}>{loading ? '...' : stats.worked}</div>
                    <div style={styles.statSub}>Dữ liệu thực tế từ MySQL</div>
                </div>
                <div style={styles.statCard}>
                    <div style={styles.statTitle}>Đã nghỉ phép</div>
                    <div style={{...styles.statValue, color: stats.leave > MAX_LEAVE_YEAR ? 'red' : '#e6a800'}}>
                        {loading ? '...' : `${stats.leave} / ${MAX_LEAVE_YEAR}`}
                    </div>
                    <div style={styles.statSub}>
                        {leaveRemaining < 0 ? 'Đã vượt hạn mức!' : `Còn lại ${leaveRemaining} ngày`}
                    </div>
                </div>
                <div style={styles.statCard}>
                    <div style={styles.statTitle}>Vắng mặt (Không phép)</div>
                    <div style={{...styles.statValue, color:'red'}}>{loading ? '...' : stats.absent}</div>
                    <div style={styles.statSub}>Cần giải trình nếu > 0</div>
                </div>
            </div>

            <div style={{ display: 'flex', gap: '20px', flexWrap: 'wrap' }}>
                {/* --- PHẦN 2: FORM ĐĂNG KÝ --- */}
                <div style={{ flex: 1, minWidth:'300px', background: 'var(--card-bg)', padding: '20px', borderRadius: '8px', border: '1px solid var(--border-color)' }}>
                    <h3 style={{marginTop:0}}>📝 Đăng ký Nghỉ phép</h3>
                    <form onSubmit={handleRequestSubmit}>
                        <div style={{marginBottom:'15px'}}>
                            <label style={styles.label}>Loại nghỉ</label>
                            <select style={styles.input} value={formData.LeaveType} onChange={e=>setFormData({...formData, LeaveType: e.target.value})}>
                                <option>Phép năm (Annual Leave)</option>
                                <option>Nghỉ ốm (Sick Leave)</option>
                                <option>Nghỉ không lương (Unpaid)</option>
                            </select>
                        </div>
                        <div style={{display:'flex', gap:'15px', marginBottom:'15px'}}>
                            <div style={{flex:1}}>
                                <label style={styles.label}>Từ ngày</label>
                                <input type="date" required style={styles.input} value={formData.StartDate} onChange={e=>setFormData({...formData, StartDate: e.target.value})} />
                            </div>
                            <div style={{flex:1}}>
                                <label style={styles.label}>Đến ngày</label>
                                <input type="date" required style={styles.input} value={formData.EndDate} onChange={e=>setFormData({...formData, EndDate: e.target.value})} />
                            </div>
                        </div>
                        <div style={{marginBottom:'15px'}}>
                            <label style={styles.label}>Lý do</label>
                            <textarea required rows="3" style={styles.input} value={formData.Reason} onChange={e=>setFormData({...formData, Reason: e.target.value})} placeholder="Nhập lý do nghỉ..."></textarea>
                        </div>
                        <button type="submit" style={styles.btnSubmit}>Gửi yêu cầu</button>
                    </form>
                </div>

                {/* --- PHẦN 3: LỊCH SỬ CHẤM CÔNG CHI TIẾT --- */}
                <div style={{ flex: 2, minWidth:'400px', background: 'var(--card-bg)', padding: '20px', borderRadius: '8px', border: '1px solid var(--border-color)' }}>
                    <h3 style={{marginTop:0}}>📅 Lịch sử Chấm công (Payroll DB)</h3>
                    <div style={{overflowX:'auto'}}>
                        <table style={{width:'100%', borderCollapse:'collapse', fontSize:'0.9em'}}>
                            <thead>
                                <tr style={{borderBottom:'2px solid var(--border-color)', textAlign:'left'}}>
                                    <th style={styles.th}>Tháng</th>
                                    <th style={styles.th}>Ngày công</th>
                                    <th style={styles.th}>Nghỉ phép</th>
                                    <th style={styles.th}>Vắng</th>
                                    <th style={styles.th}>Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                {loading ? <tr><td colSpan={5}><Skeleton/></td></tr> : 
                                attendanceHistory.length > 0 ? attendanceHistory.map(att => (
                                    <tr key={att.AttendanceID} style={{borderBottom:'1px solid var(--border-color)'}}>
                                        <td style={styles.td}><strong>{att.AttendanceMonth}</strong></td>
                                        <td style={styles.td}>{att.WorkDays}</td>
                                        <td style={styles.td}>{att.LeaveDays}</td>
                                        <td style={{...styles.td, color: att.AbsentDays > 0 ? 'red' : 'inherit'}}>{att.AbsentDays}</td>
                                        <td style={styles.td}>
                                            {att.WorkDays >= 22 
                                                ? <span style={{color:'green', fontWeight:'bold'}}>Đủ công</span> 
                                                : <span style={{color:'orange'}}>Thiếu công</span>}
                                        </td>
                                    </tr>
                                )) : <tr><td colSpan={5} style={{padding:'20px', textAlign:'center'}}>Chưa có dữ liệu.</td></tr>}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </motion.div>
    );
}

const styles = {
    statsGrid: { display: 'flex', gap: '20px', marginBottom: '25px', flexWrap: 'wrap' },
    statCard: { flex: 1, minWidth: '200px', background: 'var(--card-bg)', padding: '20px', borderRadius: '8px', border: '1px solid var(--border-color)', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' },
    statTitle: { color: 'var(--text-color-secondary)', fontSize: '0.9em', fontWeight: 'bold', textTransform: 'uppercase' },
    statValue: { fontSize: '2em', fontWeight: 'bold', margin: '5px 0' },
    statSub: { fontSize: '0.8em', color: '#888' },
    
    label: { display: 'block', marginBottom: '5px', fontWeight: '600', fontSize: '0.9em' },
    input: { width: '100%', padding: '10px', border: '1px solid var(--input-border-color)', borderRadius: '6px', boxSizing: 'border-box', background: 'var(--input-bg)', color: 'var(--text-color)' },
    btnSubmit: { width: '100%', padding: '10px', background: '#0d6efd', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer', fontWeight: 'bold', fontSize: '1em' },
    
    th: { padding: '12px', color: 'var(--text-color)' },
    td: { padding: '12px', color: 'var(--text-color)' }
};

export default MyAttendance;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\MyPayslips.js
================================================================================
// frontend/src/pages/MyPayslips.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { toast } from 'react-toastify';
import { motion } from 'framer-motion';
import jsPDF from 'jspdf'; // Đã cài đặt

function MyPayslips() {
    const { user } = useAuth();
    const [profile, setProfile] = useState(null);
    const [shareholderInfo, setShareholderInfo] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        if (user?.emp_id) {
            fetchData(user.emp_id);
        }
    }, [user]);

    const fetchData = async (id) => {
        setLoading(true);
        try {
            const empRes = await api.get(`/employees/${id}`);
            setProfile(empRes.data);

            const shRes = await api.get('/shareholders/');
            const myShare = shRes.data.find(s => s.EmployeeID === id);
            setShareholderInfo(myShare);

        } catch (err) {
            console.error(err);
            toast.error("Không tải được dữ liệu.");
        } finally {
            setLoading(false);
        }
    };

    const fmt = (val) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(val);

    // --- HÀNH ĐỘNG: XUẤT PDF THỰC TẾ ---
    const handleExportPDF = (salaryRecord) => {
        try {
            const doc = new jsPDF();
            
            // Tiêu đề
            doc.setFontSize(18);
            doc.text("PHIEU LUONG (PAYSLIP)", 105, 20, null, null, "center");
            
            // Thông tin chung
            doc.setFontSize(12);
            doc.text(`Thang/Nam: ${salaryRecord.SalaryMonth}`, 20, 40);
            doc.text(`Nhan vien: ${profile.FullName}`, 20, 50);
            doc.text(`Phong ban: ${profile.department?.DepartmentName || ''}`, 20, 60);

            // Chi tiết lương
            doc.text("------------------------------------------------", 20, 70);
            doc.text(`Luong Co Ban:   ${fmt(salaryRecord.BaseSalary)}`, 20, 80);
            doc.text(`Thuong:         ${fmt(salaryRecord.Bonus)}`, 20, 90);
            doc.text(`Khau tru:       ${fmt(salaryRecord.Deductions)}`, 20, 100);
            doc.text("------------------------------------------------", 20, 110);
            
            // Thực lĩnh
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 255); // Màu xanh
            doc.text(`THUC LINH:      ${fmt(salaryRecord.NetSalary)}`, 20, 125);

            // Lưu file
            doc.save(`Payslip_${profile.FullName}_${salaryRecord.SalaryMonth}.pdf`);
            
            console.log(`[AUDIT] User ${user.email} exported Payslip PDF for ${salaryRecord.SalaryMonth}`);
            toast.success(`Đã tải xuống phiếu lương tháng ${salaryRecord.SalaryMonth}`);
        } catch (error) {
            console.error("PDF Error:", error);
            toast.error("Lỗi khi tạo file PDF");
        }
    };

    // --- HÀNH ĐỘNG: GỬI MAIL ---
    const handleSendMail = async (month) => {
        toast.info(`Đang gửi phiếu lương tháng ${month} vào email của bạn...`);
        setTimeout(() => {
             console.log(`[AUDIT] User ${user.email} requested Payslip Email for ${month}`);
             toast.success("Đã gửi thành công!");
        }, 1000);
    };

    if (loading) return <div style={{padding:'40px', textAlign:'center'}}>Đang tải dữ liệu...</div>;
    if (!profile) return <div style={{padding:'20px'}}>Không tìm thấy thông tin.</div>;

    return (
        <motion.div 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }}
            style={{ padding: '20px', color: 'var(--text-color)' }}
        >
            <h2 style={{marginBottom: '20px'}}>Phiếu lương & Thu nhập của tôi</h2>
            
            {/* INFO CARD */}
            <div style={styles.card}>
                <div style={styles.profileHeader}>
                    <div style={styles.avatar}>
                        {profile.FullName.charAt(0).toUpperCase()}
                    </div>
                    <div>
                        <h3 style={{margin:0, fontSize:'1.3rem'}}>{profile.FullName}</h3>
                        <div style={{color:'var(--text-color-secondary)', marginTop:'5px'}}>
                            <span>{profile.position?.PositionName}</span> • <span>{profile.department?.DepartmentName}</span>
                        </div>
                    </div>
                </div>

                <hr style={{border:'0', borderTop:'1px solid var(--border-color)', margin:'20px 0'}} />

                {/* PHẦN CỔ TỨC */}
                {shareholderInfo && (
                    <div style={styles.dividendSection}>
                        <h4 style={{margin:'0 0 10px 0', color:'#6f42c1'}}>💎 Thông tin Cổ đông</h4>
                        <div style={{display:'flex', gap:'30px', flexWrap:'wrap'}}>
                            <div>
                                <small>Số cổ phần nắm giữ</small>
                                <div style={{fontWeight:'bold', fontSize:'1.1em'}}>{shareholderInfo.Shares.toLocaleString()} CP</div>
                            </div>
                            <div>
                                <small>Tỷ lệ sở hữu</small>
                                <div style={{fontWeight:'bold', fontSize:'1.1em'}}>{shareholderInfo.SharePercentage}%</div>
                            </div>
                            <div>
                                <small>Cổ tức tích lũy/được nhận</small>
                                <div style={{fontWeight:'bold', fontSize:'1.1em', color:'#6f42c1'}}>
                                    {fmt(shareholderInfo.UnpaidDividend)}
                                </div>
                            </div>
                            <div>
                                <small>Trạng thái</small>
                                <div>
                                    <span style={{background:'#d1e7dd', color:'#0f5132', padding:'2px 8px', borderRadius:'10px', fontSize:'0.8em'}}>
                                        {shareholderInfo.Status}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <hr style={{border:'0', borderTop:'1px solid #eee', margin:'20px 0'}} />
                    </div>
                )}

                {/* SALARY TABLE */}
                <h4 style={{margin:'0 0 15px 0'}}>Lịch sử Phiếu lương</h4>
                <div style={{overflowX:'auto'}}>
                    <table style={styles.table}>
                        <thead>
                            <tr style={{background:'var(--table-header-bg)', textAlign:'left'}}>
                                <th style={styles.th}>Tháng</th>
                                <th style={styles.th}>Lương Cơ bản</th>
                                <th style={styles.th}>Thưởng</th>
                                <th style={styles.th}>Khấu trừ</th>
                                <th style={{...styles.th, color:'#0d6efd'}}>Thực lĩnh</th>
                                <th style={styles.th}>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            {profile.salaries.length > 0 ? profile.salaries.map(s => (
                                <tr key={s.SalaryID} style={{borderBottom:'1px solid var(--border-color)'}}>
                                    <td style={styles.td}><strong>{s.SalaryMonth}</strong></td>
                                    <td style={styles.td}>{fmt(s.BaseSalary)}</td>
                                    <td style={{...styles.td, color:'green'}}>{fmt(s.Bonus)}</td>
                                    <td style={{...styles.td, color:'red'}}>{fmt(s.Deductions)}</td>
                                    <td style={{...styles.td, color:'#0d6efd', fontWeight:'bold', fontSize:'1.1em', background:'#f0f5ff'}}>
                                        {fmt(s.NetSalary)}
                                    </td>
                                    <td style={styles.td}>
                                        <button 
                                            onClick={() => handleExportPDF(s)}
                                            style={{...styles.actionBtn, marginRight:'8px'}}
                                            title="Xuất PDF"
                                        >
                                            📄 PDF
                                        </button>
                                        <button 
                                            onClick={() => handleSendMail(s.SalaryMonth)}
                                            style={styles.actionBtn}
                                            title="Gửi về Email"
                                        >
                                            📧 Email
                                        </button>
                                    </td>
                                </tr>
                            )) : (
                                <tr><td colSpan="6" style={{padding:'20px', textAlign:'center'}}>Chưa có lịch sử lương.</td></tr>
                            )}
                        </tbody>
                    </table>
                </div>
            </div>
        </motion.div>
    );
}

const styles = {
    card: { background: 'var(--card-bg)', padding: '30px', borderRadius: '10px', border: '1px solid var(--border-color)', boxShadow: '0 4px 12px rgba(0,0,0,0.05)' },
    profileHeader: { display:'flex', alignItems:'center', gap:'20px' },
    avatar: { width:'60px', height:'60px', background:'linear-gradient(135deg, #0d6efd, #0a58ca)', borderRadius:'50%', display:'flex', alignItems:'center', justifyContent:'center', color:'white', fontSize:'1.8em', fontWeight:'bold', boxShadow:'0 4px 8px rgba(13, 110, 253, 0.3)' },
    dividendSection: { background: '#f9f9ff', padding: '15px', borderRadius: '8px', border: '1px solid #e0e0ff', marginBottom: '20px' },
    table: { width: '100%', borderCollapse: 'collapse', marginTop:'10px' },
    th: { padding: '15px', borderBottom: '2px solid var(--border-color)', color: 'var(--text-color)', fontWeight:'600' },
    td: { padding: '15px', color: 'var(--text-color)', verticalAlign:'middle' },
    actionBtn: { padding:'6px 10px', background:'transparent', border:'1px solid var(--border-color)', borderRadius:'4px', cursor:'pointer', fontSize:'0.85em', transition:'all 0.2s' }
};

// Add spin animation if not exists
if (!document.getElementById('spin-style')) {
    const style = document.createElement('style');
    style.id = 'spin-style';
    style.innerHTML = `@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }`;
    document.head.appendChild(style);
}

export default MyPayslips;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\PayrollManagement.js
================================================================================
// frontend/src/pages/PayrollManagement.js
import React, { useState, useEffect, useCallback, useRef } from 'react';
import api from '../services/api';
import EditSalaryModal from '../components/EditSalaryModal';
import { motion, AnimatePresence } from 'framer-motion';
import { toast } from 'react-toastify';

// --- Skeleton Components ---
const SkeletonSearchRow = () => (
    <tr>
        {Array.from({ length: 5 }).map((_, i) => <td key={i} style={styles.thTd}><div style={styles.skeletonCell}></div></td>)}
    </tr>
);

const SkeletonProfile = () => (
    <div style={styles.profileSection}>
        <h3><div style={{...styles.skeletonCell, height: '30px', width: '50%'}}></div></h3>
        <div style={{...styles.skeletonCell, height: '150px', width: '100%', marginTop:'20px'}}></div>
    </div>
);

function PayrollManagement() {
    // State tìm kiếm & Lọc
    const [searchTerm, setSearchTerm] = useState('');
    const [departmentId, setDepartmentId] = useState('');
    
    // State Lọc Tháng/Năm
    const currentYear = new Date().getFullYear();
    const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1); // Tháng hiện tại
    const [selectedYear, setSelectedYear] = useState(currentYear);

    const [departments, setDepartments] = useState([]);
    const [searchResults, setSearchResults] = useState([]);
    const [loadingSearch, setLoadingSearch] = useState(false);
    
    const [selectedProfile, setSelectedProfile] = useState(null);
    const [loadingProfile, setLoadingProfile] = useState(false);
    
    // State cho dữ liệu bổ sung (Cổ tức)
    const [shareholderInfo, setShareholderInfo] = useState(null);

    const [isModalOpen, setIsModalOpen] = useState(false);
    const [salaryToEdit, setSalaryToEdit] = useState(null);
    const [debouncedSearchTerm, setDebouncedSearchTerm] = useState(searchTerm);

    // --- FETCH DATA ---
    const fetchEmployees = useCallback(async (search = '', deptId = '') => {
        setLoadingSearch(true);
        setSearchResults([]); 
        try {
            const params = { search, department_id: deptId || undefined };
            const response = await api.get('/employees/', { params });
            setSearchResults(response.data);
        } catch (err) {
            toast.error('Tải danh sách nhân viên thất bại.');
        } finally {
            setLoadingSearch(false);
        }
    }, []);

    useEffect(() => {
        const loadInitialData = async () => {
            setLoadingSearch(true);
            try {
                const deptRes = await api.get('/departments/');
                setDepartments(deptRes.data);
                const empRes = await api.get('/employees/');
                setSearchResults(empRes.data);
            } catch (error) {
                toast.error("Không thể tải dữ liệu.");
            } finally { setLoadingSearch(false); }
        };
        loadInitialData();
    }, []);

    // Debounce
    useEffect(() => {
        const handler = setTimeout(() => setDebouncedSearchTerm(searchTerm), 500); 
        return () => clearTimeout(handler);
    }, [searchTerm]);

    const isFirstRun = useRef(true);
    useEffect(() => {
        if (isFirstRun.current) { isFirstRun.current = false; return; }
        fetchEmployees(debouncedSearchTerm, departmentId);
    }, [debouncedSearchTerm, departmentId, fetchEmployees]);

    // --- LOGIC MỚI: LỌC BẢNG LƯƠNG THEO THÁNG/NĂM ---
    const getFilteredSalaries = () => {
        if (!selectedProfile || !selectedProfile.salaries) return [];
        return selectedProfile.salaries.filter(s => {
            const sDate = new Date(s.SalaryMonth);
            const sMonth = sDate.getMonth() + 1;
            const sYear = sDate.getFullYear();
            
            const matchMonth = selectedMonth === 'all' || sMonth === parseInt(selectedMonth);
            const matchYear = sYear === parseInt(selectedYear);
            
            return matchMonth && matchYear;
        });
    };

    const fetchEmployeeProfile = async (employeeId) => {
        setLoadingProfile(true);
        setSelectedProfile(null);
        setShareholderInfo(null); // Reset shareholder info
        try {
            // 1. Lấy thông tin nhân viên (Lương, Chấm công)
            const response = await api.get(`/employees/${employeeId}`);
            setSelectedProfile(response.data);

            // 2. Lấy thông tin cổ tức (Nếu là cổ đông)
            try {
                const shRes = await api.get('/shareholders/');
                const myShare = shRes.data.find(s => s.EmployeeID === employeeId);
                if (myShare) setShareholderInfo(myShare);
            } catch (e) { console.error("Không lấy được thông tin cổ đông"); }

            setSearchResults([]); 
        } catch (err) {
            toast.error('Không thể tải hồ sơ chi tiết.');
        } finally {
            setLoadingProfile(false);
        }
    };

    // --- HANDLERS ---
    const handleClearFilters = () => { 
        setSearchTerm(''); setDepartmentId(''); 
        setSelectedMonth(new Date().getMonth() + 1); 
        setSelectedYear(currentYear); 
    };

    const handleOpenModal = (s) => { setSalaryToEdit(s); setIsModalOpen(true); };
    const handleCloseModal = () => { setIsModalOpen(false); setSalaryToEdit(null); };
    
    const handleUpdateSuccess = () => {
        handleCloseModal();
        toast.success("Cập nhật thành công! (Đã ghi Audit Log)");
        if (selectedProfile) fetchEmployeeProfile(selectedProfile.EmployeeID);
    };

    const handleBackToList = () => { setSelectedProfile(null); fetchEmployees(searchTerm, departmentId); }

    // --- AUDIT LOGS ---
    const logAction = (action, detail) => {
        // Gọi API ghi log thực tế
        console.log(`[AUDIT LOG] ${action}: ${detail}`);
    };

    const handleFinalize = () => {
        logAction('UPDATE', `Chốt bảng lương tháng ${selectedMonth}/${selectedYear}`);
        toast.success(`Đã chốt bảng lương tháng ${selectedMonth}/${selectedYear}!`);
    };

    const handleExport = () => {
        logAction('EXPORT', `Xuất Excel lương tháng ${selectedMonth}/${selectedYear}`);
        toast.info("Đang xuất file Excel...");
    };

    const handleSendPayslip = (salaryId) => {
        logAction('SEND_MAIL', `Gửi phiếu lương ID ${salaryId}`);
        toast.success(`Đã gửi phiếu lương #${salaryId} qua email.`);
    };

    const fmt = (val) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(val);

    return (
        <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            style={{ padding: '20px', color: 'var(--text-color)' }}
        >
            <h2 style={{ color: 'var(--text-color)' }}>Quản lý Bảng lương & Chấm công</h2>

            <AnimatePresence>
                {!selectedProfile && !loadingProfile && (
                    <motion.div
                        style={styles.searchSection}
                        initial={{ opacity: 0, height: 0 }}
                        animate={{ opacity: 1, height: 'auto' }}
                        exit={{ opacity: 0, height: 0 }}
                    >
                        {/* HEADER ACTIONS */}
                        <div style={styles.actionHeader}>
                            <div style={{display:'flex', alignItems:'center', gap:'10px'}}>
                                <h3 style={{margin:0, color:'var(--text-color)'}}>Bảng Lương</h3>
                                <select value={selectedMonth} onChange={e=>setSelectedMonth(e.target.value)} style={styles.dateSelect}>
                                    <option value="all">Tất cả tháng</option>
                                    {Array.from({length:12},(_,i)=>i+1).map(m=><option key={m} value={m}>Tháng {m}</option>)}
                                </select>
                                <select value={selectedYear} onChange={e=>setSelectedYear(e.target.value)} style={styles.dateSelect}>
                                    {[currentYear, currentYear-1, currentYear-2].map(y=><option key={y} value={y}>{y}</option>)}
                                </select>
                            </div>
                            <div style={{display:'flex', gap:'10px'}}>
                                <button onClick={handleFinalize} className="action-button" style={{background:'#0d6efd', color:'white', border:'none'}}>✓ Chốt Lương</button>
                                <button onClick={handleExport} className="action-button" style={{background:'#198754', color:'white', border:'none'}}>⬇ Xuất Excel</button>
                            </div>
                        </div>

                        {/* FILTERS */}
                        <div style={styles.filterGrid}>
                            <div style={styles.filterItem}>
                                <label style={styles.filterLabel}>Tìm kiếm nhân viên</label>
                                <input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} style={styles.filterInput} placeholder="Tên, Mã NV..." />
                            </div>
                            <div style={styles.filterItem}>
                                <label style={styles.filterLabel}>Phòng ban</label>
                                <select value={departmentId} onChange={(e) => setDepartmentId(e.target.value)} style={styles.filterSelect}>
                                    <option value="">Tất cả phòng ban</option>
                                    {departments.map(dept => <option key={dept.DepartmentID} value={dept.DepartmentID}>{dept.DepartmentName}</option>)}
                                </select>
                            </div>
                            <div style={{ ...styles.filterItem, alignSelf: 'flex-end' }}>
                                <button onClick={handleClearFilters} style={styles.btnOutline}>Xóa bộ lọc</button>
                            </div>
                        </div>

                        {/* TABLE */}
                        <div style={styles.tableContainer}>
                            <table style={styles.resultsTable}>
                                <thead>
                                    <tr style={styles.header}>
                                        <th style={styles.thTd}>Mã NV</th>
                                        <th style={styles.thTd}>Họ tên</th>
                                        <th style={styles.thTd}>Phòng ban</th>
                                        <th style={styles.thTd}>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {loadingSearch ? Array.from({ length: 5 }).map((_, i) => <SkeletonSearchRow key={i} />) : 
                                    searchResults.length > 0 ? searchResults.map(emp => (
                                        <tr key={emp.EmployeeID}>
                                            <td style={styles.thTd}>{emp.EmployeeID}</td>
                                            <td style={styles.thTd}>
                                                <strong>{emp.FullName}</strong><br/>
                                                <small style={{color:'var(--text-color-secondary)'}}>{emp.Email}</small>
                                            </td>
                                            <td style={styles.thTd}>{emp.department?.DepartmentName || '-'}</td>
                                            <td style={styles.thTd}>
                                                <button onClick={() => fetchEmployeeProfile(emp.EmployeeID)} className="action-button view-button">
                                                    👁️ Xem Chi tiết
                                                </button>
                                            </td>
                                        </tr>
                                    )) : <tr><td colSpan={4} style={styles.emptyCell}>Không tìm thấy nhân viên.</td></tr>}
                                </tbody>
                            </table>
                        </div>
                    </motion.div>
                )}
            </AnimatePresence>

            {loadingProfile && <SkeletonProfile />}
            
            {!loadingProfile && selectedProfile && (
                <motion.div style={styles.profileSection} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}>
                    <button style={styles.backLink} onClick={handleBackToList}>{"<"} Quay lại danh sách</button>
                    
                    <div style={styles.profileHeader}>
                        <h3 style={{ margin:0, color: 'var(--text-color)' }}>{selectedProfile.FullName}</h3>
                        <span style={{background:'#e2e8f0', padding:'4px 12px', borderRadius:'15px', fontSize:'0.9em', color:'#333'}}>
                            {selectedProfile.department?.DepartmentName} - {selectedProfile.Status}
                        </span>
                    </div>
                    
                    {/* SALARY TABLE */}
                    <h4 style={{ color: 'var(--text-color)', marginTop: '20px', borderBottom:'1px solid #eee', paddingBottom:'5px' }}>
                        💰 Lịch sử Lương ({selectedMonth === 'all' ? 'Tất cả' : `Tháng ${selectedMonth}`}/{selectedYear})
                    </h4>
                    <div style={styles.tableContainer}>
                        <table style={styles.salaryTable}>
                            <thead>
                                <tr style={styles.header}>
                                    <th style={styles.thTd}>Tháng</th>
                                    <th style={styles.thTd}>Lương CB</th>
                                    <th style={styles.thTd}>Thưởng</th>
                                    <th style={styles.thTd}>Khấu trừ</th>
                                    {/* [THÊM] Cột Cổ tức */}
                                    <th style={styles.thTd}>Cổ tức</th>
                                    {/* [THÊM] Cột Thực nhận */}
                                    <th style={{...styles.thTd, background:'#e6f7ff', color:'#0050b3'}}>Thực nhận</th> 
                                    <th style={styles.thTd}>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                {getFilteredSalaries().length > 0 ? getFilteredSalaries().map(s => (
                                    <tr key={s.SalaryID}>
                                        <td style={styles.thTd}><strong>{s.SalaryMonth}</strong></td>
                                        <td style={styles.thTd}>{fmt(s.BaseSalary)}</td>
                                        <td style={{...styles.thTd, color:'green'}}>{fmt(s.Bonus)}</td>
                                        <td style={{...styles.thTd, color:'red'}}>{fmt(s.Deductions)}</td>
                                        
                                        {/* [HIỂN THỊ] Cổ tức (Nếu có) */}
                                        <td style={{...styles.thTd, color:'#6f42c1'}}>
                                            {shareholderInfo ? fmt(shareholderInfo.UnpaidDividend) : '-'}
                                        </td>

                                        {/* [HIỂN THỊ] Thực nhận (Có cộng thêm cổ tức nếu muốn, ở đây hiển thị NetSalary từ DB) */}
                                        <td style={{...styles.thTd, fontWeight:'bold', color:'#0d6efd', fontSize:'1.1em', background:'#f0f5ff'}}>
                                            {fmt(s.NetSalary)}
                                        </td>

                                        <td style={styles.thTd}>
                                            <button onClick={() => handleOpenModal(s)} className="action-button edit-button" title="Chỉnh sửa" style={{marginRight:'5px'}}>
                                                📝
                                            </button>
                                            <button onClick={() => handleSendPayslip(s.SalaryID)} className="action-button" style={{background:'#6c757d', color:'white', border:'1px solid #6c757d'}} title="Gửi phiếu lương qua Email">
                                                📧
                                            </button>
                                        </td>
                                    </tr>
                                )) : <tr><td colSpan={7} style={styles.emptyCell}>Không có dữ liệu lương cho thời gian này.</td></tr>}
                            </tbody>
                        </table>
                    </div>

                    {/* ATTENDANCE TABLE */}
                    <h4 style={{ color: 'var(--text-color)', marginTop: '30px', borderBottom:'1px solid #eee', paddingBottom:'5px' }}>
                        📅 Dữ liệu Chấm công
                    </h4>
                    <div style={styles.tableContainer}>
                        <table style={styles.salaryTable}>
                            <thead>
                                <tr style={styles.header}>
                                    <th style={styles.thTd}>Tháng</th>
                                    <th style={styles.thTd}>Ngày làm việc</th>
                                    <th style={styles.thTd}>Vắng mặt</th>
                                    <th style={styles.thTd}>Nghỉ phép</th>
                                    <th style={styles.thTd}>Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                {selectedProfile.attendances.length > 0 ? selectedProfile.attendances.map(a => (
                                    <tr key={a.AttendanceID}>
                                        <td style={styles.thTd}>{a.AttendanceMonth}</td>
                                        <td style={styles.thTd}>{a.WorkDays}</td>
                                        <td style={{...styles.thTd, color: a.AbsentDays > 0 ? 'red' : 'inherit'}}>{a.AbsentDays}</td>
                                        <td style={styles.thTd}>{a.LeaveDays}</td>
                                        <td style={styles.thTd}>
                                            {a.WorkDays >= 22 ? <span style={{color:'green'}}>Đủ công</span> : <span style={{color:'orange'}}>Thiếu công</span>}
                                        </td>
                                    </tr>
                                )) : <tr><td colSpan={5} style={styles.emptyCell}>Không có dữ liệu chấm công.</td></tr>}
                            </tbody>
                        </table>
                    </div>
                </motion.div>
            )}

            <AnimatePresence>
                {isModalOpen && <EditSalaryModal isOpen={isModalOpen} onClose={handleCloseModal} onSuccess={handleUpdateSuccess} salaryData={salaryToEdit} />}
            </AnimatePresence>
        </motion.div>
    );
}

const styles = {
    searchSection: { marginBottom: '20px', padding: '20px', border: '1px solid var(--border-color)', borderRadius: '8px', background: 'var(--card-bg)', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' },
    actionHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px', borderBottom: '1px solid var(--border-color)', paddingBottom: '15px', flexWrap: 'wrap', gap:'10px' },
    dateSelect: { padding: '8px', borderRadius: '4px', border: '1px solid var(--input-border-color)', marginLeft: '5px', background: 'var(--input-bg)', color: 'var(--text-color)' },
    filterGrid: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', marginBottom: '20px', alignItems: 'flex-end' },
    filterItem: { display: 'flex', flexDirection: 'column' },
    filterLabel: { marginBottom: '5px', fontSize: '0.85em', fontWeight: 'bold', color: 'var(--text-color-secondary)' },
    filterInput: { padding: '10px', border: '1px solid var(--input-border-color)', borderRadius: '6px', width: '100%', boxSizing: 'border-box', backgroundColor: 'var(--input-bg)', color: 'var(--text-color)' },
    filterSelect: { padding: '10px', border: '1px solid var(--input-border-color)', borderRadius: '6px', width: '100%', boxSizing: 'border-box', background: 'var(--input-bg)', color: 'var(--text-color)' },
    btnOutline: { padding: '8px 15px', border: '1px solid var(--border-color)', background: 'transparent', borderRadius: '6px', cursor: 'pointer', color: 'var(--text-color)' },
    tableContainer: { overflowX: 'auto', borderRadius: '6px', border: '1px solid var(--border-color)' },
    resultsTable: { width: '100%', borderCollapse: 'collapse', color: 'var(--text-color)' },
    profileSection: { marginTop: '20px', padding: '25px', border: '1px solid var(--border-color)', borderRadius: '8px', backgroundColor: 'var(--card-bg)', color: 'var(--text-color)', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' },
    profileHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' },
    salaryTable: { width: '100%', borderCollapse: 'collapse', color: 'var(--text-color)' },
    thTd: { borderBottom: '1px solid var(--border-color)', padding: '12px 15px', textAlign: 'left', verticalAlign: 'middle' },
    header: { backgroundColor: 'var(--table-header-bg)', color: 'var(--text-color)', fontWeight: 'bold' },
    emptyCell: { textAlign: 'center', padding: '20px', color: 'var(--text-color-secondary)' },
    backLink: { display: 'inline-block', marginBottom: '15px', color: 'var(--primary-color)', textDecoration: 'none', fontWeight: 'bold', cursor: 'pointer', background: 'none', border: 'none', fontSize: '1rem' },
    skeletonCell: { height: '20px', backgroundColor: '#e0e0e0', borderRadius: '4px', animation: 'pulse 1.5s infinite ease-in-out' },
};

export default PayrollManagement;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\Positions.js
================================================================================
// frontend/src/pages/Positions.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';

// Component Modal dùng chung cho Thêm/Sửa
const PositionModal = ({ isOpen, onClose, onSuccess, positionData }) => {
  const [name, setName] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const isEditMode = !!positionData;

  useEffect(() => {
    setName(isEditMode ? positionData.PositionName : '');
    setError('');
  }, [isOpen, positionData, isEditMode]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!name.trim()) { setError('Tên chức vụ không được để trống.'); return; }
    setLoading(true); setError('');
    try {
      if (isEditMode) {
        await api.put(`/positions/${positionData.PositionID}`, { PositionName: name });
      } else {
        await api.post('/positions/', { PositionName: name });
      }
      onSuccess();
    } catch (err) {
      setError(err.response?.data?.detail || 'Lưu thất bại.');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div style={styles.overlay}>
      <div style={styles.modal}>
        <h2>{isEditMode ? 'Sửa Chức vụ' : 'Thêm Chức vụ mới'}</h2>
        {error && <p style={{ color: 'red' }}>{error}</p>}
        <form onSubmit={handleSubmit}>
          <div style={styles.formGroup}>
            <label>Tên Chức vụ:</label>
            <input type="text" value={name} onChange={(e) => setName(e.target.value)} disabled={loading} style={{ width: '95%', padding: '8px' }} required />
          </div>
          <div style={styles.buttonGroup}>
            <button type="submit" disabled={loading}>{loading ? 'Đang lưu...' : (isEditMode ? 'Lưu thay đổi' : 'Thêm mới')}</button>
            <button type="button" onClick={onClose} disabled={loading} style={{ marginLeft: '10px' }}>Hủy</button>
          </div>
        </form>
      </div>
    </div>
  );
};

// Component trang chính
function Positions() {
  const [positions, setPositions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const { user } = useAuth();
  const isAdmin = user?.role === 'Admin';

  const [isModalOpen, setIsModalOpen] = useState(false);
  const [currentItem, setCurrentItem] = useState(null);

  const fetchData = async () => {
    setLoading(true); setError('');
    try {
      const response = await api.get('/positions/');
      setPositions(response.data);
    } catch (err) {
      setError('Không thể tải danh sách chức vụ.');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => { fetchData(); }, []);

  const handleOpenModal = (pos = null) => { setCurrentItem(pos); setIsModalOpen(true); };
  const handleCloseModal = () => { setIsModalOpen(false); setCurrentItem(null); };
  const handleSuccess = () => { handleCloseModal(); fetchData(); };

  const handleDelete = async (posId, posName) => {
    if (window.confirm(`Bạn có chắc muốn xóa chức vụ "${posName}" không?`)) {
      setError('');
      try {
        await api.delete(`/positions/${posId}`);
        fetchData();
      } catch (err) {
        setError(err.response?.data?.detail || 'Xóa thất bại. Chức vụ có thể đang được gán cho nhân viên.');
      }
    }
  };

  if (loading && positions.length === 0) return <p>Đang tải...</p>;

  return (
    <div>
      <h2>Quản lý Chức vụ</h2>
      {error && <p style={{ color: 'red', border: '1px solid red', padding: '10px' }}>{error}</p>}
      {isAdmin && <button onClick={() => handleOpenModal(null)} style={{ margin: '10px 0' }}>Thêm Chức vụ mới</button>}
      <table border="1" cellPadding="10" style={{ width: '100%', borderCollapse: 'collapse' }}>
        <thead>
          <tr>
            <th>ID</th>
            <th>Tên Chức vụ</th>
            {isAdmin && <th>Hành động</th>}
          </tr>
        </thead>
        <tbody>
          {positions.map(pos => (
            <tr key={pos.PositionID}>
              <td>{pos.PositionID}</td>
              <td>{pos.PositionName}</td>
              {isAdmin && (
                <td>
                  <button onClick={() => handleOpenModal(pos)} style={{ marginRight: '5px' }}>Sửa</button>
                  <button onClick={() => handleDelete(pos.PositionID, pos.PositionName)} style={{ color: 'red' }}>Xóa</button>
                </td>
              )}
            </tr>
          ))}
          {positions.length === 0 && !loading && (
             <tr><td colSpan={isAdmin ? 3 : 2} style={{textAlign: 'center'}}>Không có chức vụ nào.</td></tr>
          )}
        </tbody>
      </table>
      <PositionModal isOpen={isModalOpen} onClose={handleCloseModal} onSuccess={handleSuccess} positionData={currentItem} />
    </div>
  );
}

const styles = {
  overlay: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 1000 },
  modal: { backgroundColor: '#fff', padding: '25px', borderRadius: '8px', minWidth: '400px', boxShadow: '0 4px 10px rgba(0,0,0,0.1)' },
  formGroup: { marginBottom: '15px' },
  buttonGroup: { marginTop: '20px', textAlign: 'right' }
};

export default Positions;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\Reports.js
================================================================================
// frontend/src/pages/Reports.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { toast } from 'react-toastify';
import { motion } from 'framer-motion';

// Import Charts
import EmployeeDeptChart from '../components/charts/EmployeeDeptChart';
import CostStructureChart from '../components/charts/CostStructureChart';

// --- Icons ---
const FilterIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>;
const ExportIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
const ChartIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>;

function Reports() {
    const { user } = useAuth();
    const [data, setData] = useState(null);
    const [loading, setLoading] = useState(true);
    
    // Filter States
    const [deptFilter, setDeptFilter] = useState('');
    const [posFilter, setPosFilter] = useState('');
    const [dateFilter, setDateFilter] = useState(new Date().toISOString().slice(0, 7)); // YYYY-MM
    const [departments, setDepartments] = useState([]);
    const [positions, setPositions] = useState([]);

    useEffect(() => {
        const init = async () => {
            setLoading(true);
            try {
                const [summaryRes, deptRes, posRes] = await Promise.all([
                    api.get('/reports/dashboard-summary'),
                    api.get('/departments/'),
                    api.get('/positions/')
                ]);
                setData(summaryRes.data);
                setDepartments(deptRes.data);
                setPositions(posRes.data);
            } catch (error) {
                console.error(error);
                toast.error("Lỗi tải dữ liệu báo cáo.");
            } finally {
                setLoading(false);
            }
        };
        init();
    }, []);

    const handleFilter = () => {
        toast.info("Đang lọc dữ liệu... (Tính năng Demo)");
        // Trong thực tế sẽ gọi API với query params
    };

    const handleExport = () => {
        toast.success("Đang xuất báo cáo PDF...");
    };

    if (loading) return <div style={{padding:'40px', textAlign:'center', color:'var(--text-color)'}}>Đang tải báo cáo phân tích...</div>;
    if (!data) return <div style={{padding:'20px'}}>Không có dữ liệu.</div>;

    const { payroll_metrics, financial_metrics } = data;

    return (
        <motion.div 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }}
            style={{ padding: '20px', color: 'var(--text-color)' }}
        >
            {/* HEADER */}
            <div style={{marginBottom: '30px'}}>
                <h1 style={{margin: 0, fontSize:'2rem'}}>Báo cáo Phân tích</h1>
                <p style={{color:'var(--text-color-secondary)', marginTop:'5px'}}>Xin chào, {user?.role}!</p>
            </div>

            {/* MAIN CONTAINER */}
            <div style={styles.reportContainer}>
                {/* TITLE BAR */}
                <div style={styles.titleBar}>
                    <div style={{display:'flex', alignItems:'center', gap:'10px'}}>
                        <ChartIcon />
                        <h3 style={{margin:0}}>Báo cáo Phân tích Lương & Nhân sự</h3>
                    </div>
                    <button onClick={handleExport} style={styles.btnExport}>
                        <ExportIcon /> Xuất Báo cáo
                    </button>
                </div>

                {/* FILTER BAR */}
                <div style={styles.filterBar}>
                    <div style={styles.filterItem}>
                        <label style={styles.label}>Phòng ban</label>
                        <select value={deptFilter} onChange={e=>setDeptFilter(e.target.value)} style={styles.select}>
                            <option value="">Tất cả phòng ban</option>
                            {departments.map(d => <option key={d.DepartmentID} value={d.DepartmentID}>{d.DepartmentName}</option>)}
                        </select>
                    </div>
                    <div style={styles.filterItem}>
                        <label style={styles.label}>Chức vụ</label>
                        <select value={posFilter} onChange={e=>setPosFilter(e.target.value)} style={styles.select}>
                            <option value="">Tất cả chức vụ</option>
                            {positions.map(p => <option key={p.PositionID} value={p.PositionID}>{p.PositionName}</option>)}
                        </select>
                    </div>
                    <div style={styles.filterItem}>
                        <label style={styles.label}>Khoảng thời gian</label>
                        <input type="month" value={dateFilter} onChange={e=>setDateFilter(e.target.value)} style={styles.input} />
                    </div>
                    <div style={{alignSelf:'flex-end'}}>
                        <button onClick={handleFilter} style={styles.btnFilter}>
                            <FilterIcon /> Lọc dữ liệu
                        </button>
                    </div>
                </div>

                {/* CHARTS GRID */}
                <div style={styles.chartGrid}>
                    {/* Left Chart */}
                    <div style={styles.chartBox}>
                        <h4 style={{marginTop:0, marginBottom:'20px', color:'var(--text-color)'}}>Phân phối Lương theo Phòng ban</h4>
                        <EmployeeDeptChart 
                            data={payroll_metrics.salary_by_dept.reduce((acc, cur) => ({...acc, [cur.name]: cur.value}), {})}
                            barColor="#00C49F" // Teal color like image
                            textColor="var(--text-color-secondary)"
                        />
                    </div>

                    {/* Right Chart */}
                    <div style={styles.chartBox}>
                        <CostStructureChart 
                            salary={payroll_metrics.total_base_salary}
                            bonus={payroll_metrics.total_bonus}
                            dividend={financial_metrics.total_dividends}
                        />
                    </div>
                </div>
            </div>
        </motion.div>
    );
}

const styles = {
    reportContainer: {
        backgroundColor: 'var(--card-bg)', // Dark/Light background based on theme
        borderRadius: '12px',
        border: '1px solid var(--border-color)',
        padding: '25px',
        boxShadow: '0 4px 20px rgba(0,0,0,0.1)',
    },
    titleBar: {
        display: 'flex', justifyContent: 'space-between', alignItems: 'center',
        marginBottom: '25px', borderBottom: '1px solid var(--border-color)', paddingBottom: '15px'
    },
    btnExport: {
        display: 'flex', alignItems: 'center', gap: '8px',
        background: '#3b82f6', color: 'white', border: 'none', borderRadius: '6px',
        padding: '8px 16px', cursor: 'pointer', fontWeight: '600',
        boxShadow: '0 2px 4px rgba(59, 130, 246, 0.3)'
    },
    filterBar: {
        display: 'flex', gap: '20px', flexWrap: 'wrap', marginBottom: '30px',
        background: 'var(--bg-color)', padding: '15px', borderRadius: '8px' // Lighter background for filter
    },
    filterItem: { display: 'flex', flexDirection: 'column', flex: 1, minWidth: '200px' },
    label: { fontSize: '0.85em', color: 'var(--text-color-secondary)', marginBottom: '5px', fontWeight: 'bold' },
    select: { padding: '10px', borderRadius: '6px', border: '1px solid var(--input-border-color)', background: 'var(--card-bg)', color: 'var(--text-color)' },
    input: { padding: '9px', borderRadius: '6px', border: '1px solid var(--input-border-color)', background: 'var(--card-bg)', color: 'var(--text-color)' },
    btnFilter: {
        display: 'flex', alignItems: 'center', gap: '8px',
        background: '#4b5563', color: 'white', border: 'none', borderRadius: '6px',
        padding: '10px 20px', cursor: 'pointer', fontWeight: '600', height: '38px'
    },
    chartGrid: {
        display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(450px, 1fr))', gap: '30px'
    },
    chartBox: {
        background: 'var(--card-bg)', // Same as container or slightly different
        padding: '10px', borderRadius: '8px'
    }
};

export default Reports;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\ShareholderManagement.js
================================================================================
// frontend/src/pages/ShareholderManagement.js
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { toast } from 'react-toastify';
// [FIX] Đảm bảo các component này được sử dụng trong giao diện Admin/HR bên dưới
import { BarChart, Bar, Tooltip, ResponsiveContainer, Cell } from 'recharts';

// --- Helper format tiền tệ ---
const fmt = (val) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(val);

function ShareholderManagement() {
    const { user } = useAuth();
    const isPayroll = user?.role === 'Payroll Manager';
    
    const [shareholders, setShareholders] = useState([]);
    const [reportData, setReportData] = useState({ 
        total_dividend_amount: 0, 
        employee_shareholders: 0, // Dùng key này từ API fix
        top_shareholders: [] 
    });

    // --- STATE CHO MODAL CHI TRẢ (Payroll) ---
    const [isPayoutModalOpen, setIsPayoutModalOpen] = useState(false);
    const [payoutStep, setPayoutStep] = useState(1);
    const [payoutForm, setPayoutForm] = useState({ title: '', date: '', totalProfit: '' });
    const [previewData, setPreviewData] = useState(null);
    const [processing, setProcessing] = useState(false);

    useEffect(() => {
        fetchData();
        fetchReport();
    }, []);

    const fetchData = async () => {
        try {
            const res = await api.get('/shareholders/');
            setShareholders(res.data);
        } catch (err) { console.error(err); }
    };

    const fetchReport = async () => {
        try {
            const res = await api.get('/reports/dividend_summary');
            setReportData(res.data);
        } catch (err) { console.error(err); }
    };

    // --- HANDLERS ---
    const handleCalculate = async () => {
        if (!payoutForm.totalProfit || !payoutForm.title || !payoutForm.date) {
            toast.warn("Vui lòng nhập đầy đủ thông tin.");
            return;
        }
        setProcessing(true);
        try {
            const res = await api.post('/shareholders/preview-payout', {
                total_profit: parseFloat(payoutForm.totalProfit)
            });
            setPreviewData(res.data);
            setPayoutStep(2);
        } catch (err) {
            toast.error(err.response?.data?.detail || "Lỗi tính toán.");
        } finally {
            setProcessing(false);
        }
    };

    const handleConfirmPayout = async () => {
        if (!previewData) return;
        setProcessing(true);
        try {
            await api.post('/shareholders/confirm-payout', {
                title: payoutForm.title,
                payment_date: payoutForm.date,
                payout_list: previewData.payout_list
            });
            toast.success("Đã chi trả cổ tức thành công!");
            setIsPayoutModalOpen(false);
            setPayoutStep(1);
            setPayoutForm({ title: '', date: '', totalProfit: '' });
            setPreviewData(null);
            fetchData();
            fetchReport();
        } catch (err) {
            toast.error("Lỗi khi lưu dữ liệu.");
        } finally {
            setProcessing(false);
        }
    };

    // --- GIAO DIỆN RIÊNG CHO PAYROLL MANAGER (Theme tối/tím) ---
    if (isPayroll) {
        return (
            <div style={{ padding: '20px', color: 'var(--text-color)' }}>
                <div style={{marginBottom: '30px'}}>
                    <h2 style={{margin:0, fontSize:'1.8rem'}}>Quản lý Cổ tức</h2>
                    <p style={{color:'var(--text-color-secondary)', marginTop:'5px'}}>Xin chào, Payroll Manager!</p>
                </div>

                <div style={styles.payrollCard}>
                    <div style={styles.cardHeader}>
                        <div style={{display:'flex', alignItems:'center', gap:'10px'}}>
                            <span style={{fontSize:'1.5rem'}}>💰</span>
                            <h3 style={{margin:0, color:'var(--text-color)'}}>Quản lý Chi trả Cổ tức 2025</h3>
                        </div>
                        <button onClick={() => setIsPayoutModalOpen(true)} style={styles.btnPurple}>
                            + Tạo đợt chi trả
                        </button>
                    </div>

                    <div style={styles.profitBox}>
                        <div style={{fontSize:'0.9em', color:'#a0aec0', marginBottom:'5px'}}>Tổng lợi nhuận phân phối (Đã chi)</div>
                        <div style={{fontSize:'2rem', fontWeight:'bold', color:'#a78bfa'}}>
                            {fmt(reportData.total_dividend_amount)}
                        </div>
                    </div>

                    <div style={styles.tableContainer}>
                        <table style={styles.table}>
                            <thead>
                                <tr style={{borderBottom:'1px solid var(--border-color)'}}>
                                    <th style={styles.th}>CỔ ĐÔNG</th>
                                    <th style={styles.th}>SỐ CỔ PHẦN</th>
                                    <th style={styles.th}>TỶ LỆ</th>
                                    <th style={styles.th}>TỔNG NHẬN</th>
                                    <th style={styles.th}>TRẠNG THÁI</th>
                                </tr>
                            </thead>
                            <tbody>
                                {shareholders.map(sh => (
                                    <tr key={sh.ShareholderID} style={{ borderBottom: '1px solid var(--border-color)' }}>
                                        <td style={styles.td}>
                                            <div style={{fontWeight:'bold'}}>{sh.FullName}</div>
                                            <div style={{fontSize:'0.85em', color:'var(--text-color-secondary)'}}>NV{sh.EmployeeID}</div>
                                        </td>
                                        <td style={styles.td}>{sh.Shares.toLocaleString()}</td>
                                        <td style={styles.td}>{sh.SharePercentage}%</td>
                                        <td style={{...styles.td, fontWeight:'bold', color:'#a78bfa'}}>
                                            {fmt(sh.UnpaidDividend)}
                                        </td>
                                        <td style={styles.td}>
                                            {sh.UnpaidDividend > 0 ? (
                                                <span style={styles.badgeSuccess}>Đã chuyển</span>
                                            ) : (
                                                <span style={styles.badgeWarning}>Chờ xử lý</span>
                                            )}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>

                {/* Modal Chi trả (Payroll) */}
                {isPayoutModalOpen && (
                    <div style={styles.overlay}>
                        <div style={{...styles.modal, maxWidth: payoutStep === 2 ? '800px' : '500px'}}>
                            <h2 style={{marginTop:0, borderBottom:'1px solid #eee', paddingBottom:'15px', color:'#333'}}>
                                {payoutStep === 1 ? 'Thiết lập đợt Chi trả' : 'Xác nhận Chi trả'}
                            </h2>
                             {payoutStep === 1 ? (
                                <div style={styles.formGrid}>
                                    <div style={styles.formGroup}>
                                        <label style={styles.label}>Tên đợt chi trả</label>
                                        <input type="text" style={styles.input} placeholder="VD: Cổ tức Quý 3/2025" 
                                            value={payoutForm.title} onChange={e=>setPayoutForm({...payoutForm, title: e.target.value})} />
                                    </div>
                                    <div style={styles.formGroup}>
                                        <label style={styles.label}>Ngày chi trả</label>
                                        <input type="date" style={styles.input} 
                                            value={payoutForm.date} onChange={e=>setPayoutForm({...payoutForm, date: e.target.value})} />
                                    </div>
                                    <div style={styles.formGroup}>
                                        <label style={styles.label}>Tổng lợi nhuận phân phối (VNĐ)</label>
                                        <input type="number" style={styles.input} placeholder="VD: 1000000000" 
                                            value={payoutForm.totalProfit} onChange={e=>setPayoutForm({...payoutForm, totalProfit: e.target.value})} />
                                    </div>
                                </div>
                            ) : (
                                <div>
                                    <div style={styles.summaryBox}>
                                        <div><strong>Tổng quỹ:</strong> {fmt(parseFloat(payoutForm.totalProfit))}</div>
                                        <div><strong>Tổng cổ phần:</strong> {previewData?.total_shares.toLocaleString()}</div>
                                        <div><strong>Cổ tức/CP:</strong> {fmt(previewData?.dividend_per_share)}</div>
                                    </div>
                                    <div style={{maxHeight:'300px', overflowY:'auto', marginTop:'15px', border:'1px solid #eee'}}>
                                        <table style={{width:'100%', borderCollapse:'collapse', fontSize:'0.9em'}}>
                                            <thead style={{background:'#f8f9fa', position:'sticky', top:0}}>
                                                <tr>
                                                    <th style={styles.thSmall}>NV</th>
                                                    <th style={styles.thSmall}>CP</th>
                                                    <th style={styles.thSmall}>Thực nhận</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {previewData?.payout_list.map(item => (
                                                    <tr key={item.employee_id} style={{borderBottom:'1px solid #eee'}}>
                                                        <td style={styles.tdSmall}>{item.full_name}</td>
                                                        <td style={styles.tdSmall}>{item.shares.toLocaleString()}</td>
                                                        <td style={{...styles.tdSmall, fontWeight:'bold', color:'#198754'}}>{fmt(item.dividend_amount)}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            <div style={styles.modalActions}>
                                <button onClick={() => {setIsPayoutModalOpen(false); setPayoutStep(1);}} style={styles.btnCancel}>Hủy</button>
                                {payoutStep === 1 ? (
                                    <button onClick={handleCalculate} style={styles.btnPrimary}>Tiếp tục</button>
                                ) : (
                                    <>
                                        <button onClick={() => setPayoutStep(1)} style={styles.btnOutline}>Quay lại</button>
                                        <button onClick={handleConfirmPayout} style={styles.btnSuccess}>{processing ? 'Đang lưu...' : 'Xác nhận'}</button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                )}
            </div>
        );
    }

    // --- GIAO DIỆN CHO ADMIN / HR (View chuẩn) ---
    return (
        <div style={{ padding: '20px', color: 'var(--text-color)' }}>
            <h2 style={{marginBottom:'20px'}}>Quản lý Cổ đông & Cổ tức</h2>
            
            <div style={styles.reportGrid}>
                <div style={styles.card}>
                    <h4 style={{margin:'0 0 10px 0', color:'var(--text-color-secondary)'}}>Tổng Cổ tức đã chi</h4>
                    <div style={{fontSize:'1.8rem', fontWeight:'bold', color:'#0d6efd'}}>{fmt(reportData.total_dividend_amount)}</div>
                    <small style={{color:'#888'}}>Dữ liệu tổng hợp từ HUMAN_2025</small>
                </div>
                <div style={styles.card}>
                    <h4 style={{margin:'0 0 10px 0', color:'var(--text-color-secondary)'}}>Nhân viên là Cổ đông</h4>
                    <div style={{fontSize:'1.8rem', fontWeight:'bold', color:'#198754'}}>
                        {reportData.employee_shareholders} <span style={{fontSize:'1rem', fontWeight:'normal'}}>nhân viên</span>
                    </div>
                    <small style={{color:'#888'}}>Đang sở hữu cổ phần công ty</small>
                </div>
                
                {/* [FIX: SỬ DỤNG BIỂU ĐỒ ĐỂ KHÔNG BỊ LỖI UNUSED VARS] */}
                <div style={styles.card}>
                    <h4 style={{margin:'0 0 10px 0', color:'var(--text-color-secondary)'}}>
                        {reportData.total_dividend_amount > 0 ? "Top nhận Cổ tức" : "Top sở hữu Cổ phần"}
                    </h4>
                    <div style={{height: '100px'}}>
                        {reportData.top_shareholders && reportData.top_shareholders.length > 0 ? (
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={reportData.top_shareholders}>
                                    <Tooltip 
                                        contentStyle={{backgroundColor:'var(--card-bg)', borderColor:'var(--border-color)', color:'var(--text-color)'}}
                                        formatter={(value) => reportData.total_dividend_amount > 0 ? fmt(value) : value.toLocaleString()}
                                    />
                                    <Bar dataKey="total" fill="#8884d8">
                                        {reportData.top_shareholders.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={index % 2 === 0 ? '#8884d8' : '#82ca9d'} />
                                        ))}
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        ) : (
                            <div style={{display:'flex', alignItems:'center', justifyContent:'center', height:'100%', color:'#888', fontStyle:'italic'}}>
                                Chưa có dữ liệu
                            </div>
                        )}
                    </div>
                </div>
            </div>

            <div style={styles.tableContainer}>
                <div style={{padding:'15px', borderBottom:'1px solid var(--border-color)', display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                     <h3 style={{margin:0}}>Danh sách Chi tiết</h3>
                     <span style={{fontSize:'0.9em', color:'#666'}}>Tổng: {shareholders.length} bản ghi</span>
                </div>
                <table style={styles.table}>
                    <thead>
                        <tr style={{ background: 'var(--table-header-bg)', textAlign: 'left' }}>
                            <th style={styles.th}>Mã NV</th>
                            <th style={styles.th}>Nhân viên</th>
                            <th style={styles.th}>Phòng ban</th>
                            <th style={styles.th}>Số cổ phần</th>
                            <th style={styles.th}>Tổng đã nhận</th>
                            <th style={styles.th}>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        {shareholders.length > 0 ? shareholders.map(sh => (
                            <tr key={sh.ShareholderID} style={{ borderBottom: '1px solid var(--border-color)' }}>
                                <td style={styles.td}>{sh.EmployeeID}</td>
                                <td style={styles.td}><strong>{sh.FullName}</strong></td>
                                <td style={styles.td}>{sh.DepartmentName}</td>
                                <td style={styles.td}>{sh.Shares.toLocaleString()}</td>
                                <td style={{...styles.td, color:'#0d6efd', fontWeight:'bold'}}>
                                    {fmt(sh.UnpaidDividend)}
                                </td>
                                <td style={styles.td}>
                                    <span style={sh.Status === 'Active' || sh.Status === 'Đang làm việc' ? styles.badgeSuccess : styles.badgeWarning}>
                                        {sh.Status}
                                    </span>
                                </td>
                            </tr>
                        )) : (
                            <tr><td colSpan={6} style={{padding:'30px', textAlign:'center', color:'#888'}}>Chưa có dữ liệu cổ đông.</td></tr>
                        )}
                    </tbody>
                </table>
            </div>
        </div>
    );
}

const styles = {
    // Styles Payroll
    payrollCard: { backgroundColor: 'var(--card-bg)', borderRadius: '16px', padding: '30px', boxShadow: '0 4px 20px rgba(0,0,0,0.1)', border: '1px solid var(--border-color)' },
    cardHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '25px' },
    btnPurple: { padding: '10px 20px', background: '#8b5cf6', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '600', boxShadow: '0 4px 10px rgba(139, 92, 246, 0.3)' },
    profitBox: { background: 'linear-gradient(145deg, #2d2b42, #1f1d2b)', border: '1px solid #4c4b5e', borderRadius: '12px', padding: '20px', marginBottom: '30px', width: 'fit-content', minWidth: '300px' },
    
    // Styles Common
    tableContainer: { overflowX: 'auto', background: 'var(--card-bg)', borderRadius: '8px', border: '1px solid var(--border-color)' },
    table: { width: '100%', borderCollapse: 'collapse', fontSize: '0.95rem' },
    th: { padding: '15px 10px', textAlign: 'left', color: 'var(--text-color-secondary)', textTransform: 'uppercase', fontSize: '0.75rem', fontWeight: 'bold' },
    td: { padding: '15px 10px', color: 'var(--text-color)', verticalAlign: 'middle' },
    badgeSuccess: { background: 'rgba(16, 185, 129, 0.2)', color: '#10b981', padding: '5px 12px', borderRadius: '20px', fontSize: '0.8rem', fontWeight: 'bold' },
    badgeWarning: { background: 'rgba(245, 158, 11, 0.2)', color: '#f59e0b', padding: '5px 12px', borderRadius: '20px', fontSize: '0.8rem', fontWeight: 'bold' },

    // Report Grid
    reportGrid: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '20px', marginBottom: '30px' },
    card: { background: 'var(--card-bg)', padding: '20px', borderRadius: '8px', border: '1px solid var(--border-color)', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' },

    // Modal
    overlay: { position:'fixed', top:0, left:0, right:0, bottom:0, background:'rgba(0,0,0,0.6)', display:'flex', justifyContent:'center', alignItems:'center', zIndex:1000 },
    modal: { background:'white', padding:'30px', borderRadius:'12px', width:'90%', color:'#333' },
    formGrid: { display:'flex', flexDirection:'column', gap:'20px' },
    formGroup: { display:'flex', flexDirection:'column' },
    label: { marginBottom:'8px', fontWeight:'bold', fontSize:'0.9em' },
    input: { padding:'12px', border:'1px solid #ccc', borderRadius:'6px', fontSize:'1rem' },
    modalActions: { display:'flex', justifyContent:'flex-end', marginTop:'30px', gap:'10px' },
    btnPrimary: { padding:'10px 20px', background:'#0d6efd', color:'white', border:'none', borderRadius:'6px', cursor:'pointer' },
    btnSuccess: { padding:'10px 20px', background:'#198754', color:'white', border:'none', borderRadius:'6px', cursor:'pointer' },
    btnCancel: { padding:'10px 20px', background:'#6c757d', color:'white', border:'none', borderRadius:'6px', cursor:'pointer', marginRight:'auto' },
    btnOutline: { padding:'10px 20px', background:'transparent', border:'1px solid #6c757d', color:'#6c757d', borderRadius:'6px', cursor:'pointer' },
    summaryBox: { background:'#f8f9fa', padding:'15px', borderRadius:'8px', border:'1px solid #eee' },
    thSmall: { padding:'10px', textAlign:'left', background:'#f1f1f1' },
    tdSmall: { padding:'10px', borderBottom:'1px solid #eee' }
};

export default ShareholderManagement;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\SystemAdmin.js
================================================================================
import React, { useState, useEffect } from 'react';
import api from '../services/api';
import { toast } from 'react-toastify';

// Helper format thời gian
const formatDate = (isoString) => {
    if (!isoString) return '';
    return new Date(isoString).toLocaleString('vi-VN');
};

function SystemAdmin() {
    // State cho Logs
    const [logs, setLogs] = useState([]);
    const [loadingLogs, setLoadingLogs] = useState(false);

    // State cho Config
    const [configs, setConfigs] = useState({
        leave_warning_threshold: '',
        salary_discrepancy_threshold: ''
    });
    const [loadingConfig, setLoadingConfig] = useState(false);

    // --- FETCH DATA ---
    const fetchLogs = async () => {
        setLoadingLogs(true);
        try {
            const res = await api.get('/system/logs?limit=20');
            setLogs(res.data);
        } catch (error) {
            console.error("Failed to fetch logs", error);
            toast.error("Không thể tải nhật ký hoạt động.");
        } finally {
            setLoadingLogs(false);
        }
    };

    const fetchConfigs = async () => {
        try {
            const res = await api.get('/system/config');
            // Chuyển mảng config [{key, value}, ...] thành object {key: value}
            const configMap = {};
            res.data.forEach(item => {
                configMap[item.key] = item.value;
            });
            setConfigs(prev => ({ ...prev, ...configMap }));
        } catch (error) {
            console.error("Failed to fetch configs", error);
        }
    };

    useEffect(() => {
        fetchLogs();
        fetchConfigs();
    }, []);

    // --- HANDLERS ---
    const handleConfigChange = (e) => {
        const { name, value } = e.target;
        setConfigs(prev => ({ ...prev, [name]: value }));
    };

    const handleSaveConfig = async () => {
        setLoadingConfig(true);
        try {
            // Lưu từng config (hoặc backend có thể hỗ trợ bulk update)
            await Promise.all([
                api.put('/system/config/leave_warning_threshold', { value: configs.leave_warning_threshold }),
                api.put('/system/config/salary_discrepancy_threshold', { value: configs.salary_discrepancy_threshold })
            ]);
            toast.success("Đã lưu cấu hình thành công!");
            // Refresh logs để thấy hành động update
            fetchLogs();
        } catch (error) {
            toast.error("Lưu cấu hình thất bại.");
        } finally {
            setLoadingConfig(false);
        }
    };

    return (
        <div style={{ padding: '20px', color: 'var(--text-color)' }}>
            <h2 style={{ color: 'var(--text-color)' }}>Quản trị Hệ thống</h2>
            
            {/* Status Cards (Giả lập trạng thái kết nối - Thực tế cần API check health) */}
            <div style={{ display: 'flex', gap: '20px', marginBottom: '30px', flexWrap: 'wrap' }}>
                <div style={styles.statusCard}>
                    <div style={{fontSize: '2em'}}>🛢️</div>
                    <div>
                        <h4>SQL Server (Human)</h4>
                        <span style={{color: '#00e676', fontWeight: 'bold'}}>Connected</span>
                        <div style={{fontSize: '0.8em', opacity: 0.7}}>Latency: 24ms</div>
                    </div>
                </div>
                <div style={styles.statusCard}>
                    <div style={{fontSize: '2em'}}>🐬</div>
                    <div>
                        <h4>MySQL (Payroll)</h4>
                        <span style={{color: '#00e676', fontWeight: 'bold'}}>Connected</span>
                        <div style={{fontSize: '0.8em', opacity: 0.7}}>Latency: 35ms</div>
                    </div>
                </div>
                <div style={styles.statusCard}>
                    <div style={{fontSize: '2em'}}>🔄</div>
                    <div>
                        <h4>Đồng bộ lần cuối</h4>
                        <span style={{fontWeight: 'bold'}}>Vừa xong</span>
                        <div style={{fontSize: '0.8em', opacity: 0.7}}>Tự động</div>
                    </div>
                </div>
            </div>

            <div style={{ display: 'flex', gap: '20px', flexWrap: 'wrap' }}>
                
                {/* --- AUDIT LOGS SECTION --- */}
                <div style={{ flex: 2, minWidth: '400px', background: 'var(--card-bg)', padding: '20px', borderRadius: '8px', border: '1px solid var(--border-color)', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
                    <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                        <h3 style={{margin:0, color: 'var(--text-color)'}}>Nhật ký Hoạt động (Audit Logs)</h3>
                        <button onClick={fetchLogs} style={styles.refreshButton}>🔄 Làm mới</button>
                    </div>
                    
                    <div style={{overflowX: 'auto'}}>
                        <table style={{width: '100%', marginTop: '15px', borderCollapse:'collapse', fontSize: '0.9em'}}>
                            <thead>
                                <tr style={{textAlign: 'left', color: 'var(--text-color-secondary)', borderBottom:'1px solid var(--border-color)'}}>
                                    <th style={{padding:'10px'}}>Thời gian</th>
                                    <th style={{padding:'10px'}}>Hành động</th>
                                    <th style={{padding:'10px'}}>Đối tượng</th>
                                    <th style={{padding:'10px'}}>Chi tiết</th>
                                    <th style={{padding:'10px'}}>User</th>
                                </tr>
                            </thead>
                            <tbody>
                                {loadingLogs ? (
                                    <tr><td colSpan="5" style={{padding:'20px', textAlign:'center'}}>Đang tải...</td></tr>
                                ) : logs.length > 0 ? (
                                    logs.map(log => (
                                        <tr key={log.id} style={{borderBottom:'1px solid var(--border-color)', color: 'var(--text-color)'}}>
                                            <td style={{padding:'10px'}}>{formatDate(log.timestamp)}</td>
                                            <td style={{padding:'10px'}}>
                                                <span style={getActionStyle(log.action)}>{log.action}</span>
                                            </td>
                                            <td style={{padding:'10px'}}>{log.target || '-'}</td>
                                            <td style={{padding:'10px'}}>{log.details}</td>
                                            <td style={{padding:'10px', fontSize:'0.85em', color:'var(--text-color-secondary)'}}>{log.user_email}</td>
                                        </tr>
                                    ))
                                ) : (
                                    <tr><td colSpan="5" style={{padding:'20px', textAlign:'center'}}>Chưa có nhật ký nào.</td></tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                {/* --- CONFIG SECTION --- */}
                <div style={{ flex: 1, minWidth: '300px', background: 'var(--card-bg)', padding: '20px', borderRadius: '8px', border: '1px solid var(--border-color)', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>
                    <h3 style={{marginTop:0, color: 'var(--text-color)'}}>⚙️ Cấu hình Hệ thống</h3>
                    
                    <div style={{marginBottom: '15px'}}>
                        <label style={{fontWeight:'bold', display:'block', marginBottom:'5px', color: 'var(--text-color)'}}>Cảnh báo nghỉ phép</label>
                        <p style={{fontSize:'0.8em', color:'var(--text-color-secondary)', margin:'0 0 5px 0'}}>Ngưỡng cảnh báo (ngày/năm)</p>
                        <input 
                            type="number" 
                            name="leave_warning_threshold"
                            value={configs.leave_warning_threshold}
                            onChange={handleConfigChange}
                            placeholder="VD: 12"
                            style={styles.input} 
                        />
                    </div>

                    <div style={{marginBottom: '20px'}}>
                        <label style={{fontWeight:'bold', display:'block', marginBottom:'5px', color: 'var(--text-color)'}}>Sai lệch lương</label>
                        <p style={{fontSize:'0.8em', color:'var(--text-color-secondary)', margin:'0 0 5px 0'}}>Ngưỡng cảnh báo (%)</p>
                        <input 
                            type="number" 
                            name="salary_discrepancy_threshold"
                            value={configs.salary_discrepancy_threshold}
                            onChange={handleConfigChange}
                            placeholder="VD: 20"
                            style={styles.input} 
                        />
                    </div>

                    <button 
                        onClick={handleSaveConfig} 
                        disabled={loadingConfig}
                        style={styles.saveButton}
                    >
                        {loadingConfig ? 'Đang lưu...' : 'Lưu Cấu hình'}
                    </button>
                </div>
            </div>
        </div>
    );
}

// Helper style cho badge hành động
const getActionStyle = (action) => {
    const base = { padding: '2px 8px', borderRadius: '4px', fontSize: '0.8em', fontWeight: 'bold' };
    if (action === 'LOGIN') return { ...base, background: '#cfe2ff', color: '#084298' };
    if (action.includes('CREATE')) return { ...base, background: '#d1e7dd', color: '#0f5132' };
    if (action.includes('UPDATE')) return { ...base, background: '#fff3cd', color: '#856404' };
    if (action.includes('DELETE')) return { ...base, background: '#f8d7da', color: '#842029' };
    return { ...base, background: '#e2e3e5', color: '#41464b' };
};

const styles = {
    statusCard: {
        flex: 1, minWidth: '250px', background: '#1e2a38', color: 'white', 
        padding: '20px', borderRadius: '10px', display: 'flex', alignItems: 'center', gap: '15px'
    },
    input: {
        width: '100%', padding: '8px', border:'1px solid var(--input-border-color)', 
        borderRadius:'4px', background: 'var(--input-bg)', color: 'var(--text-color)', boxSizing: 'border-box'
    },
    saveButton: {
        width: '100%', padding: '10px', background: '#0d6efd', color: 'white', 
        border: 'none', borderRadius: '4px', cursor:'pointer', fontWeight: 'bold'
    },
    refreshButton: {
        padding: '5px 10px', background: 'transparent', border: '1px solid var(--border-color)', 
        borderRadius: '4px', cursor: 'pointer', color: 'var(--text-color)'
    }
};

export default SystemAdmin;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\pages\UserManagement.js
================================================================================
// frontend/src/pages/UserManagement.js
import React, { useState, useEffect, useCallback, useRef } from 'react'; // Thêm useRef
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { motion, AnimatePresence } from 'framer-motion';
import { toast } from 'react-toastify';
import SetRoleModal from '../components/SetRoleModal';
import ResetPasswordModal from '../components/ResetPasswordModal';

// --- Thêm danh sách vai trò để lọc ---
const ROLES_OPTIONS = ["Admin", "HR Manager", "Payroll Manager", "Employee"];

// --- Skeleton Row Component ---
const SkeletonRow = ({ columns }) => (
    <tr>
        {Array.from({ length: columns }).map((_, index) => (
            <td key={index} style={styles.tableCell}>
                <div style={styles.skeletonCell} className="skeletonCell"></div>
            </td>
        ))}
    </tr>
);

function UserManagement() {
    const [users, setUsers] = useState([]);
    const [loading, setLoading] = useState(true);
    const { user: currentUser } = useAuth();

    // --- Thêm state cho tìm kiếm và lọc ---
    const [searchTerm, setSearchTerm] = useState('');
    const [selectedRoleFilter, setSelectedRoleFilter] = useState(''); // State cho dropdown lọc
    const [debouncedSearchTerm, setDebouncedSearchTerm] = useState(searchTerm); // State cho debounce

    const [isRoleModalOpen, setIsRoleModalOpen] = useState(false);
    const [isPasswordModalOpen, setIsPasswordModalOpen] = useState(false);
    const [selectedUser, setSelectedUser] = useState(null);

    // --- Sửa fetchUsers để nhận tham số ---
    const fetchUsers = useCallback(async (search = '', role = '') => {
        setLoading(true);
        try {
            const params = {
                search: search || undefined, // Gửi undefined nếu rỗng
                role: role || undefined,     // Gửi undefined nếu rỗng
                limit: 200 // Lấy nhiều hơn để demo, có thể thêm phân trang sau
            };
            const response = await api.get('/users/', { params });
            setUsers(response.data);
             if (response.data.length === 0 && (search || role)) {
                toast.info("Không tìm thấy tài khoản nào khớp.");
            }
        } catch (error) {
            console.error("Failed to fetch users", error);
            toast.error("Không thể tải danh sách tài khoản.");
        }
        setLoading(false);
    }, []);

    // --- useEffect để debounce searchTerm ---
    useEffect(() => {
        const handler = setTimeout(() => {
            setDebouncedSearchTerm(searchTerm);
        }, 500); // Đợi 500ms

        return () => { clearTimeout(handler); };
    }, [searchTerm]);

     // --- useEffect để fetch khi filter thay đổi ---
    const isFirstRun = useRef(true);
    useEffect(() => {
        // Bỏ qua lần chạy đầu tiên (vì fetchUsers() ban đầu đã chạy)
        if (isFirstRun.current) {
            isFirstRun.current = false;
            fetchUsers(); // Fetch lần đầu không cần filter
            return;
        }
        // Chỉ fetch khi debouncedSearchTerm hoặc selectedRoleFilter thay đổi
        fetchUsers(debouncedSearchTerm, selectedRoleFilter);
    }, [debouncedSearchTerm, selectedRoleFilter, fetchUsers]);


    // --- Handlers cho filter ---
    const handleSearchChange = (e) => setSearchTerm(e.target.value);
    const handleRoleFilterChange = (e) => setSelectedRoleFilter(e.target.value);
    const handleClearFilters = () => {
        setSearchTerm('');
        setSelectedRoleFilter('');
        // Không cần gọi fetchUsers() ở đây, vì useEffect sẽ tự động chạy khi state thay đổi
    };

    // --- Modal Handlers (Giữ nguyên) ---
    const handleOpenRoleModal = (user) => {
        setSelectedUser(user);
        setIsRoleModalOpen(true);
    };
    const handleCloseRoleModal = () => {
        setSelectedUser(null);
        setIsRoleModalOpen(false);
    };
    const handleRoleUpdateSuccess = () => {
        handleCloseRoleModal();
        toast.success("Cập nhật vai trò thành công!");
        // Fetch lại với filter hiện tại
        fetchUsers(debouncedSearchTerm, selectedRoleFilter); 
    };
    const handleOpenPasswordModal = (user) => {
        setSelectedUser(user);
        setIsPasswordModalOpen(true);
    };
    const handleClosePasswordModal = () => {
        setSelectedUser(null);
        setIsPasswordModalOpen(false);
    };
    const handlePasswordResetSuccess = () => {
        handleClosePasswordModal();
        toast.success(`Đã đặt lại mật khẩu cho ${selectedUser?.email}.`);
    };

    return (
        <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.3 }}
            style={{ padding: '20px', color: 'var(--text-color)' }} // Sửa padding
        >
            <h2 style={{ color: 'var(--text-color)' }}>Quản lý Tài khoản (Auth DB)</h2>
            <p style={{ color: 'var(--text-color-secondary)' }}>Quản lý vai trò và mật khẩu truy cập hệ thống.</p>

            {/* --- Thêm Filter UI --- */}
            <div style={styles.filterContainer}>
                <div style={styles.filterItem}>
                    <label style={styles.filterLabel}>Tìm kiếm (ID, Tên, Email)</label>
                    <input
                        type="text"
                        placeholder="Nhập từ khóa..."
                        value={searchTerm}
                        onChange={handleSearchChange}
                        style={styles.filterInput}
                        className="filter-input"
                    />
                </div>
                <div style={styles.filterItem}>
                    <label style={styles.filterLabel}>Lọc theo Vai trò</label>
                    <select
                        value={selectedRoleFilter}
                        onChange={handleRoleFilterChange}
                        style={styles.filterSelect}
                        className="filter-select"
                    >
                        <option value="">Tất cả vai trò</option>
                        {ROLES_OPTIONS.map(role => (
                            <option key={role} value={role}>{role}</option>
                        ))}
                    </select>
                </div>
                 <div style={{ ...styles.filterItem, alignSelf: 'flex-end' }}>
                    <button
                        type="button"
                        onClick={handleClearFilters}
                        disabled={loading}
                        style={{ ...styles.filterButtonClear }}
                        className="filterButtonClear"
                    >
                        Xóa bộ lọc
                    </button>
                </div>
            </div>
            {/* --- Kết thúc Filter UI --- */}


            <div style={styles.tableContainer}>
                <table style={styles.table}>
                    <thead>
                        <tr>
                            <th style={styles.th}>ID (Auth)</th>
                            <th style={styles.th}>Họ tên</th>
                            <th style={styles.th}>Email (Tên đăng nhập)</th>
                            <th style={styles.th}>Vai trò</th>
                            <th style={styles.th}>Employee ID (Link)</th>
                            <th style={styles.th}>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        {loading ? (
                            Array.from({ length: 8 }).map((_, i) => <SkeletonRow key={i} columns={6} />)
                        ) : users.length > 0 ? (
                            users.map(user => {
                                const isCurrentUser = user.email === currentUser.email;

                                return (
                                    <tr key={user.id}>
                                        <td style={styles.tableCell}>{user.id}</td>
                                        <td style={styles.tableCell}>{user.full_name}</td>
                                        <td style={styles.tableCell}>{user.email}</td>
                                        <td style={styles.tableCell}>
                                            <span style={styles.roleBadge}>{user.role}</span>
                                        </td>
                                        <td style={styles.tableCell}>{user.employee_id_link || 'N/A'}</td>
                                        <td style={styles.tableCell}>
                                            {isCurrentUser ? (
                                                <span style={styles.annotation}>(Tài khoản của bạn)</span>
                                            ) : (
                                                <>
                                                    <button
                                                        onClick={() => handleOpenRoleModal(user)}
                                                        className="action-button role-button"
                                                        disabled={isCurrentUser}
                                                    >
                                                        Đặt vai trò
                                                    </button>
                                                    <button
                                                        onClick={() => handleOpenPasswordModal(user)}
                                                        className="action-button password-button"
                                                    >
                                                        Đặt lại MK
                                                    </button>
                                                </>
                                            )}
                                        </td>
                                    </tr>
                                );
                            })
                        ) : (
                            <tr><td colSpan={6} style={styles.emptyCell}>Không tìm thấy tài khoản nào.</td></tr>
                        )}
                    </tbody>
                </table>
            </div>

            {/* Modals */}
            <AnimatePresence>
                {isRoleModalOpen && selectedUser && (
                    <SetRoleModal
                        isOpen={isRoleModalOpen}
                        onClose={handleCloseRoleModal}
                        onSuccess={handleRoleUpdateSuccess}
                        userData={selectedUser}
                    />
                )}
                {isPasswordModalOpen && selectedUser && (
                    <ResetPasswordModal
                        isOpen={isPasswordModalOpen}
                        onClose={handleClosePasswordModal}
                        onSuccess={handlePasswordResetSuccess}
                        userData={selectedUser}
                    />
                )}
            </AnimatePresence>
        </motion.div>
    );
}

// --- STYLES (Thêm style cho Filter) ---
const styles = {
    // --- Thêm Filter Styles ---
    filterContainer: {
        marginBottom: '20px', padding: '15px',
        border: '1px solid var(--border-color)', borderRadius: '8px',
        background: 'var(--card-bg)', display: 'grid',
        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', // Responsive grid
        gap: '15px', alignItems: 'flex-end',
    },
    filterItem: { display: 'flex', flexDirection: 'column' },
    filterLabel: { marginBottom: '5px', fontSize: '0.85em', fontWeight: 'bold', color: 'var(--text-color-secondary)' },
    filterInput: { padding: '8px 10px', border: '1px solid var(--input-border-color)', borderRadius: '4px', width: '100%', boxSizing: 'border-box', backgroundColor: 'var(--input-bg)', color: 'var(--text-color)' },
    filterSelect: { padding: '8px 10px', border: '1px solid var(--input-border-color)', borderRadius: '4px', width: '100%', boxSizing: 'border-box', background: 'var(--input-bg)', color: 'var(--text-color)' },
    filterButtonClear: {
        padding: '8px 15px', cursor: 'pointer', border: '1px solid var(--border-color)',
        backgroundColor: 'var(--button-bg)', color: 'var(--button-text)',
        borderRadius: '4px', transition: 'background-color 0.2s', whiteSpace: 'nowrap',
        height: '34px' // Căn chỉnh chiều cao với input/select
    },
    
    // --- Styles cũ ---
    tableContainer: {
        overflowX: 'auto',
        marginTop: '15px',
        backgroundColor: 'var(--card-bg)', 
        border: '1px solid var(--table-border-color)', 
        borderRadius: '8px',
        boxShadow: '0 2px 4px rgba(0,0,0,0.05)',
    },
    table: {
        width: '100%',
        borderCollapse: 'collapse',
        fontSize: '0.9em',
    },
    th: {
        padding: '10px 12px',
        textAlign: 'left',
        backgroundColor: 'var(--table-header-bg)', 
        borderBottom: '2px solid var(--table-border-color)', 
        whiteSpace: 'nowrap',
        color: 'var(--text-color)', 
    },
    tableCell: {
        padding: '10px 12px',
        borderBottom: '1px solid var(--table-row-border-color)', 
        verticalAlign: 'middle',
        whiteSpace: 'nowrap',
        color: 'var(--text-color)', 
    },
    emptyCell: {
        textAlign: 'center',
        padding: '20px',
        color: 'var(--text-color-secondary)' 
    },
    skeletonCell: {
        height: '20px',
        backgroundColor: '#e0e0e0', // Màu cơ bản
        borderRadius: '4px',
        animation: 'pulse 1.5s infinite ease-in-out'
    },
    annotation: {
        fontSize: '0.9em',
        color: 'var(--text-color-secondary)', 
        fontStyle: 'italic',
    },
    roleBadge: { 
        padding: '2px 8px',
        borderRadius: '10px',
        fontWeight: 'bold',
        fontSize: '0.9em',
        backgroundColor: '#e6f7ff',
        border: '1px solid #91d5ff',
        color: '#096dd9',
    }
};

// --- CSS ĐỘNG (Thêm focus style cho filter) ---
(function() {
    const styleId = 'user-management-styles';
    if (document.getElementById(styleId)) {
        // Cập nhật thay vì xóa và thêm lại để tránh nhấp nháy
        // (Trong ví dụ này, chúng ta xóa và thêm lại cho đơn giản)
        document.getElementById(styleId).remove();
    }
    const styleSheet = document.createElement("style");
    styleSheet.id = styleId;
    styleSheet.type = "text/css";
    styleSheet.innerText = `
        @keyframes pulse {
            0% { background-color: #e0e0e0; }
            50% { background-color: #f0f0f0; }
            100% { background-color: #e0e0e0; }
        }
        body.theme-dark .skeletonCell {
            background-color: #333;
            opacity: 0.5;
            animation-name: pulse-dark;
        }
        @keyframes pulse-dark {
            0%{background-color:#333;opacity:.5}
            50%{background-color:#444;opacity:.7}
            100%{background-color:#333;opacity:.5}
        }
        
        .action-button {
            padding: 3px 6px; margin-right: 4px; border-radius: 3px;
            border: 1px solid var(--border-color); 
            background-color: var(--button-bg); 
            color: var(--button-text); 
            cursor: pointer; font-size: 0.9em;
            transition: background-color 0.2s, border-color 0.2s;
            white-space: nowrap;
        }
        .action-button:hover:not(:disabled) {
            border-color: #aaa;
            background-color: var(--border-color) !important; 
        }
        .action-button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .role-button:hover { background-color: #f6ffed !important; border-color: #b7eb8f !important; }
        .password-button:hover { background-color: #fffbe6 !important; border-color: #ffe58f !important; }

        /* Thêm focus styles cho filter inputs/selects */
        .filter-input:focus, .filter-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
            outline: none;
        }
        /* Hover cho nút clear */
        .filterButtonClear:hover {
            background-color: var(--border-color) !important;
        }
        /* Table border fix */
        thead th:last-child, tbody tr td:last-child {
            border-right: none;
        }
    `;
    document.head.appendChild(styleSheet);
})();

export default UserManagement;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\services\api.js
================================================================================
import axios from 'axios';
console.log('API Base URL:', process.env.REACT_APP_API_BASE_URL);
const api = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL,
});

// Interceptor: Tự động đính kèm JWT token vào mỗi request
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Interceptor: Xử lý lỗi 401 (Unauthorized)
// Nếu token hết hạn, tự động logout và đá về trang login
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response && error.response.status === 401) {
      localStorage.removeItem('access_token');
      // Chuyển hướng về trang login
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;

================================================================================
FILE: E:\Tai Lieu Hoc Tap\SE 445 O\Group_Project\HR_Dashboard_Project\frontend\src\services\authService.js
================================================================================
// frontend/src/services/authService.js
import api from './api';
import { jwtDecode } from 'jwt-decode';

export const login = async (email, password) => {
  const params = new URLSearchParams();
  params.append('username', email);
  params.append('password', password);

  try {
    const response = await api.post('/login', params, {
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    });
    const { access_token } = response.data;
    
    localStorage.setItem('access_token', access_token);
    
    // Sửa: Giải mã token để lấy thông tin user
    const decoded = jwtDecode(access_token);
    const user = { 
      email: decoded.sub, 
      role: decoded.role,
      emp_id: decoded.emp_id // <-- LƯU EMP_ID
    };
    return user;

  } catch (error) {
    console.error('Login failed:', error);
    throw error;
  }
};

export const logout = () => {
  localStorage.removeItem('access_token');
};

export const getCurrentUser = () => {
  const token = localStorage.getItem('access_token');
  if (!token) return null;

  try {
    const decoded = jwtDecode(token);
    if (decoded.exp * 1000 < Date.now()) {
      logout();
      return null;
    }
    // Sửa: Trả về đầy đủ thông tin user
    return { 
      email: decoded.sub, 
      role: decoded.role,
      emp_id: decoded.emp_id // <-- TRẢ VỀ EMP_ID
    };
  } catch (error) {
    console.error('Invalid token:', error);
    logout();
    return null;
  }
};
